/*! For license information please see main-d6792fae.2beed86d5003edf3ad55.js.LICENSE.txt */
"use strict";(self.webpackChunkpto_request_app=self.webpackChunkpto_request_app||[]).push([[357],{922:(e,n,r)=>{r.d(n,{A:()=>O});var t=r(6540),a=r(2307),s=r(7235),i=r(7623),c=r(2492),o=r(8686),l=r(2321),u=r(1098),d=r(7892),m=r(2898),f=r(5143),p=r(9681),v=r(3029),h=r(883),g=r(2890),b=r(4848);function y(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||T(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(){var e,n,r="function"==typeof Symbol?Symbol:{},t=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function s(r,t,a,s){var o=t&&t.prototype instanceof c?t:c,l=Object.create(o.prototype);return j(l,"_invoke",function(r,t,a){var s,c,o,l=0,u=a||[],d=!1,m={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(n,r){return s=n,c=0,o=e,m.n=r,i}};function f(r,t){for(c=r,o=t,n=0;!d&&l&&!a&&n<u.length;n++){var a,s=u[n],f=m.p,p=s[2];r>3?(a=p===t)&&(o=s[(c=s[4])?5:(c=3,3)],s[4]=s[5]=e):s[0]<=f&&((a=r<2&&f<s[1])?(c=0,m.v=t,m.n=s[1]):f<p&&(a=r<3||s[0]>t||t>p)&&(s[4]=r,s[5]=t,m.n=p,c=0))}if(a||r>1)return i;throw d=!0,t}return function(a,u,p){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,p),c=u,o=p;(n=c<2?e:o)||!d;){s||(c?c<3?(c>1&&(m.n=-1),f(c,o)):m.n=o:m.v=o);try{if(l=2,s){if(c||(a="next"),n=s[a]){if(!(n=n.call(s,o)))throw TypeError("iterator result is not an object");if(!n.done)return n;o=n.value,c<2&&(c=0)}else 1===c&&(n=s.return)&&n.call(s),c<2&&(o=TypeError("The iterator does not provide a '"+a+"' method"),c=1);s=e}else if((n=(d=m.n<0)?o:r.call(t,m))!==i)break}catch(n){s=e,c=1,o=n}finally{l=1}}return{value:n,done:d}}}(r,a,s),!0),l}var i={};function c(){}function o(){}function l(){}n=Object.getPrototypeOf;var u=[][t]?n(n([][t]())):(j(n={},t,(function(){return this})),n),d=l.prototype=c.prototype=Object.create(u);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,j(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return o.prototype=l,j(d,"constructor",l),j(l,"constructor",o),o.displayName="GeneratorFunction",j(l,a,"GeneratorFunction"),j(d),j(d,a,"Generator"),j(d,t,(function(){return this})),j(d,"toString",(function(){return"[object Generator]"})),(x=function(){return{w:s,m}})()}function j(e,n,r,t){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}j=function(e,n,r,t){if(n)a?a(e,n,{value:r,enumerable:!t,configurable:!t,writable:!t}):e[n]=r;else{var s=function(n,r){j(e,n,(function(e){return this._invoke(n,r,e)}))};s("next",0),s("throw",1),s("return",2)}},j(e,n,r,t)}function w(e,n,r,t,a,s,i){try{var c=e[s](i),o=c.value}catch(e){return void r(e)}c.done?n(o):Promise.resolve(o).then(t,a)}function A(e){return function(){var n=this,r=arguments;return new Promise((function(t,a){var s=e.apply(n,r);function i(e){w(s,t,a,i,c,"next",e)}function c(e){w(s,t,a,i,c,"throw",e)}i(void 0)}))}}function N(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,a,s,i,c=[],o=!0,l=!1;try{if(s=(r=r.call(e)).next,0===n){if(Object(r)!==r)return;o=!1}else for(;!(o=(t=s.call(r)).done)&&(c.push(t.value),c.length!==n);o=!0);}catch(e){l=!0,a=e}finally{try{if(!o&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw a}}return c}}(e,n)||T(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,n){if(e){if("string"==typeof e)return k(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(e,n):void 0}}function k(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=Array(n);r<n;r++)t[r]=e[r];return t}const O=function(){var e,n=N((0,t.useState)("calendar"),2),r=n[0],j=n[1],w=N((0,t.useState)([]),2),T=w[0],k=w[1],O=N((0,t.useState)(null),2),S=O[0],q=O[1],P=N((0,t.useState)(!0),2),_=P[0],I=P[1],z=N((0,t.useState)([]),2),E=(z[0],z[1]),D=N((0,t.useState)([]),2),U=D[0],F=D[1],R=N((0,t.useState)([]),2),M=R[0],C=R[1],L=N((0,t.useState)(!1),2),G=L[0],V=L[1],W=N((0,t.useState)(null),2),B=W[0],Y=W[1],$=N((0,t.useState)(!1),2),H=$[0],J=$[1],K=(0,h.A)(),Q=K.currentUser,X=K.loading,Z=K.error,ee=K.isAdmin,ne=(0,g.A)(Q),re=ne.requests,te=ne.loading,ae=(ne.error,ne.submitRequest),se=(ne.updateRequestStatus,ne.cancelRequest),ie=(ne.fetchRequests,ne.getUserRequests),ce=ne.getPendingRequests,oe=N((0,t.useState)(!1),2),le=oe[0],ue=oe[1];(0,t.useEffect)((function(){var e=function(){var e=A(x().m((function e(){var n,r,t,a,s,i,c,o,u;return x().w((function(e){for(;;)switch(e.n){case 0:if(Q){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,(0,l.invoke)("getUserTeams",{userId:G?B.jira_account_id:Q.accountId});case 2:return(n=e.v).success&&E(n.data||[]),e.n=3,Promise.all([(0,l.invoke)("getUsers"),(0,l.invoke)("getTeams")]);case 3:r=e.v,t=N(r,2),a=t[0],s=t[1],a.success&&F(a.data||[]),s.success&&(i=s.data||[],C(i),c=G?B.jira_account_id||B.id:Q.jira_account_id||Q.id,o=i.filter((function(e){var n,r;return(null===(n=e.manager)||void 0===n?void 0:n.jira_account_id)===c||(null===(r=e.manager)||void 0===r?void 0:r.id)===c})),ue(o.length>0||ee&&!G)),e.n=5;break;case 4:e.p=4,u=e.v,console.error("Error loading additional data:",u);case 5:return e.a(2)}}),e,null,[[1,4]])})));return function(){return e.apply(this,arguments)}}();e()}),[Q,ee,G,B]),(0,t.useEffect)((function(){var e=function(){var e=A(x().m((function e(){var n,r,t,a,s;return x().w((function(e){for(;;)switch(e.n){case 0:I(!0),n=5,r=1e3;case 1:if(!(n>0)){e.n=13;break}if(e.p=2,console.log("ðŸ”§ Initializing PTO App (attempt ".concat(6-n,"/5)...")),void 0!==l.invoke){e.n=3;break}throw new Error("Forge bridge not available");case 3:return e.n=4,(0,l.invoke)("initializePTODatabaseWithTeamManagement");case 4:if((t=e.v).success){e.n=7;break}return console.warn("Admin setup failed, trying regular init:",t.message),e.n=5,(0,l.invoke)("initializePTODatabase");case 5:if((a=e.v).success){e.n=6;break}throw new Error(a.message);case 6:e.n=8;break;case 7:console.log("âœ… PTO App and Admin initialized:",t.data);case 8:return console.log("âœ… PTO App initialization complete"),e.a(3,13);case 9:if(e.p=9,s=e.v,n--,!((s.message.includes("window is not defined")||s.message.includes("Forge bridge not available"))&&n>0)){e.n=11;break}return console.warn("âš ï¸ Forge not ready, retrying in ".concat(r/1e3," second(s)... (").concat(n," attempts left)")),e.n=10,new Promise((function(e){return setTimeout(e,r)}));case 10:r=Math.min(1.5*r,5e3),e.n=12;break;case 11:return console.error("âŒ App initialization failed:",s),"function"==typeof de&&de("Failed to initialize app: "+s.message,"error"),e.a(3,13);case 12:e.n=1;break;case 13:I(!1);case 14:return e.a(2)}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),n=setTimeout(e,2e3);return function(){return clearTimeout(n)}}),[]);var de=function(e){q({message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"}),setTimeout((function(){return q(null)}),5e3)},me=function(){var e=A(x().m((function e(n){var r,t,a,s,i,c,o;return x().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,t=U.find((function(e){return e.jira_account_id===(null==Q?void 0:Q.accountId)||e.email_address===(null==Q?void 0:Q.emailAddress)})),a=null,null!=t&&t.team_id&&null!=(s=M.find((function(e){return e.id===t.team_id})))&&s.manager&&(a=s.manager),i={reporter:n.targetUser||Q,manager:n.manager||a||{accountId:"manager-default",displayName:"Manager",emailAddress:"manager@company.com"},startDate:n.startDate||T[0],endDate:n.endDate||T[T.length-1],leaveType:n.leaveType||(null===(r=n.dailySchedules)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.leaveType)||"vacation",reason:n.reason||"",dailySchedules:n.dailySchedules||T.map((function(e){return{date:e,type:"FULL_DAY",leaveType:"vacation"}}))},e.n=1,ae(i);case 1:if(!(c=e.v).success){e.n=2;break}return k([]),de("PTO request submitted successfully!"),e.a(2,{success:!0});case 2:return de(c.message||"Failed to submit PTO request","error"),e.a(2,{success:!1});case 3:e.n=5;break;case 4:return e.p=4,o=e.v,console.error("Error submitting PTO request:",o),de("Failed to submit PTO request","error"),e.a(2,{success:!1});case 5:return e.a(2)}}),e,null,[[0,4]])})));return function(n){return e.apply(this,arguments)}}(),fe=function(){var e=A(x().m((function e(n){var r,t;return x().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,(0,l.invoke)("editPTORequest",{requestId:n.id,editedBy:Q.accountId,updatedData:{startDate:n.startDate,endDate:n.endDate,leaveType:n.leaveType,reason:n.reason,dailySchedules:n.dailySchedules}});case 1:(r=e.v).success?(de("PTO request updated successfully and resubmitted for approval"),G?loadUserRequests(B):loadAllRequests()):de(r.message||"Failed to update PTO request","error"),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Error updating PTO request:",t),de("Failed to update PTO request","error");case 3:return e.a(2)}}),e,null,[[0,2]])})));return function(n){return e.apply(this,arguments)}}(),pe=function(){var e=A(x().m((function e(n){var r,t;return x().w((function(e){for(;;)switch(e.n){case 0:if(window.confirm("Are you sure you want to cancel this PTO request?")){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,se(n.id);case 2:(r=e.v).success?de("PTO request cancelled successfully!"):de(r.message||"Failed to cancel PTO request","error"),e.n=4;break;case 3:e.p=3,t=e.v,console.error("Error cancelling PTO request:",t),de("Failed to cancel PTO request","error");case 4:return e.a(2)}}),e,null,[[1,3]])})));return function(n){return e.apply(this,arguments)}}(),ve=function(){var e=A(x().m((function e(n){var r,t,a;return x().w((function(e){for(;;)switch(e.n){case 0:if(n){e.n=1;break}return V(!1),Y(null),J(!1),e.a(2);case 1:return e.p=1,e.n=2,(0,l.invoke)("getUserTeams",{userId:n.jira_account_id||n.id});case 2:if(!(r=e.v).success){e.n=4;break}return Y(n),E(r.data||[]),V(!0),e.n=3,(0,l.invoke)("checkUserAdminStatus",{accountId:n.jira_account_id||n.accountId||n.id});case 3:t=e.v,J(!!t.success&&t.data.isAdmin);case 4:e.n=6;break;case 5:e.p=5,a=e.v,console.error("Error setting view as user:",a),J(!1);case 6:return e.a(2)}}),e,null,[[1,5]])})));return function(n){return e.apply(this,arguments)}}(),he=[{id:"calendar",label:"Calendar",icon:a.A,description:"View and create PTO requests"},{id:"requests",label:"My Requests",icon:s.A,description:"View your PTO request history"}].concat(y(le?[{id:"manager",label:"Manager",icon:i.A,description:"Manage team PTO requests"}]:[]),y((G?H:ee)?[{id:"admin",label:"Admin",icon:c.A,description:"Administrative functions"}]:[])),ge=G?null==B?void 0:B.accountId:null==Q?void 0:Q.accountId,be=ie(ge),ye=ce().filter((function(e){return e.requester_id!==ge}));return _||X?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Initializing PTO Management"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Setting up database and admin users..."})]})}):Z?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center p-8 bg-white rounded-lg shadow-md",children:[(0,b.jsx)("div",{className:"text-red-500 mb-4",children:(0,b.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Authentication Error"}),(0,b.jsxs)("p",{className:"text-gray-600 mb-4",children:["Failed to load user information: ",Z]}),(0,b.jsx)("button",{onClick:function(){return window.location.reload()},className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Retry"})]})}):Q?(0,b.jsxs)("div",{className:"pto-management-app",children:[Q&&(0,b.jsxs)("div",{className:"app-header",children:[(0,b.jsx)("div",{className:"app-header-left",children:(0,b.jsx)("h1",{children:"PTO Management"})}),(0,b.jsxs)("div",{className:"app-header-right",children:[ee&&!G&&(0,b.jsx)("div",{className:"view-as-controls",children:(0,b.jsx)(f.A,{selectedUser:B,onSelect:ve,placeholder:"View as user...",useBackendSearch:!0})}),G&&(0,b.jsxs)("div",{className:"view-as-banner",children:[(0,b.jsxs)("span",{children:["Viewing as: ",(null==B?void 0:B.display_name)||(null==B?void 0:B.displayName)]}),(0,b.jsx)("button",{className:"btn btn-secondary btn-sm",onClick:function(){V(!1),Y(null),J(!1),loadAllData()},children:"Exit View As"})]}),(0,b.jsxs)("div",{className:"user-info",children:[(0,b.jsx)("span",{children:Q.displayName}),ee&&!G&&(0,b.jsx)("span",{className:"badge badge-admin",children:"Admin"}),le&&!G&&(0,b.jsx)("span",{className:"badge badge-manager",children:"Manager"})]})]})]}),(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsxs)("div",{className:"app-topbar",children:[(0,b.jsxs)("div",{className:"app-logo",children:[(0,b.jsx)("div",{className:"app-logo-icon",children:(0,b.jsx)(a.A,{size:20})}),(0,b.jsx)("span",{style:{fontWeight:600,fontSize:"1.125rem",color:"#1f2937"},children:"PTO Request"})]}),(0,b.jsx)("div",{className:"nav-tabs condensed",children:he.map((function(e){var n=e.icon,t=r===e.id;return(0,b.jsxs)("button",{onClick:A(x().m((function n(){var r;return x().w((function(n){for(;;)switch(n.n){case 0:return n.p=0,n.n=1,(0,l.invoke)("clearImportValidationData");case 1:n.n=3;break;case 2:n.p=2,r=n.v,console.warn("âš ï¸ Could not clear validation data:",r);case 3:j(e.id);case 4:return n.a(2)}}),n,null,[[0,2]])}))),className:"nav-tab".concat(t?" active":"").concat("admin"===e.id?" admin":"").concat("manager"!==e.id||ee?"":" manager"),title:e.description,children:[(0,b.jsx)(n,{size:18}),(0,b.jsx)("span",{children:e.label}),"manager"===e.id&&ye.length>0&&(0,b.jsx)("span",{className:"nav-tab-badge",children:ye.length}),"admin"===e.id&&(0,b.jsx)("span",{className:"nav-tab-label admin",children:"Admin"}),"manager"===e.id&&!ee&&(0,b.jsx)("span",{className:"nav-tab-label manager",children:"Manager"})]},e.id)}))}),(0,b.jsxs)("div",{className:"app-user-profile",children:[(0,b.jsxs)("div",{className:"user-avatar-header",children:[(null===(e=Q.displayName)||void 0===e?void 0:e.charAt(0))||(0,b.jsx)(o.A,{size:16}),ee&&(0,b.jsx)("span",{className:"user-badge admin",children:(0,b.jsx)(c.A,{size:8})}),le&&!ee&&(0,b.jsx)("span",{className:"user-badge manager",children:(0,b.jsx)(i.A,{size:8})})]}),(0,b.jsxs)("div",{className:"user-info-header",children:[(0,b.jsxs)("div",{className:"user-name-header",children:[(0,b.jsx)("span",{children:Q.displayName}),ee&&(0,b.jsx)(c.A,{size:12,style:{color:"#8b5cf6"}}),le&&!ee&&(0,b.jsx)(i.A,{size:12,style:{color:"#f97316"}})]}),(0,b.jsx)("div",{className:"user-email-header",children:Q.emailAddress})]})]})]}),(0,b.jsxs)("main",{style:{maxWidth:"80rem",margin:"0 auto",padding:"2rem 1rem"},children:["calendar"===r&&(0,b.jsx)(p.A,{events:re,onDateSelect:function(e){var n=e.toISOString().split("T")[0];k((function(e){return e.includes(n)?e.filter((function(e){return e!==n})):[].concat(y(e),[n]).sort()}))},selectedDates:T,onSubmitPTO:me,currentUser:G?B:Q,allUsers:U,allTeams:M,isAdmin:G?H:ee}),"requests"===r&&(0,b.jsx)(v.A,{requests:be,currentUser:G?B:Q,onEditRequest:fe,onCancelRequest:pe}),"manager"===r&&le&&(0,b.jsx)(m.A,{currentUser:Q,isAdmin:ee,showNotification:de}),"admin"===r&&ee&&(0,b.jsx)(d.A,{currentUser:Q,showNotification:de})]}),(te||_)&&(0,b.jsx)("div",{className:"modal-overlay",children:(0,b.jsxs)("div",{className:"modal-content",style:{maxWidth:320,padding:24,textAlign:"center"},children:[(0,b.jsx)("div",{className:"loading-spinner",style:{margin:"0 auto 1rem"}}),(0,b.jsx)("span",{children:"Processing..."})]})}),S&&(0,b.jsx)(u.A,{message:S.message,type:S.type,onClose:function(){return q(null)}})]})]}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading user information..."})]})})}}}]);