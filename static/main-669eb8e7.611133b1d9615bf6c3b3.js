"use strict";(self.webpackChunkpto_request_app=self.webpackChunkpto_request_app||[]).push([[865],{99:(e,a,t)=>{t.d(a,{A:()=>n});var r=t(6540);const l=[{value:"all",label:"All Time"},{value:"current_year",label:"Current Year"},{value:"last_90_days",label:"Last 90 Days"},{value:"last_30_days",label:"Last 30 Days"},{value:"custom",label:"Custom Range"}],n=e=>{let{value:a={preset:"all",from:"",to:""},onChange:t}=e;const[n,s]=(0,r.useState)(a.preset||"all"),[c,i]=(0,r.useState)(a.from||""),[m,o]=(0,r.useState)(a.to||"");return(0,r.useEffect)((()=>{t("custom"!==n?{preset:n,from:"",to:""}:{preset:n,from:c,to:m})}),[n,c,m]),r.createElement("div",{className:"date-range-filter"},r.createElement("select",{className:"form-control",value:n,onChange:e=>s(e.target.value)},l.map((e=>r.createElement("option",{key:e.value,value:e.value},e.label)))),"custom"===n&&r.createElement("div",{className:"custom-range-fields",style:{display:"flex",gap:8,marginTop:8}},r.createElement("input",{type:"date",className:"form-control",value:c,onChange:e=>i(e.target.value),max:m||void 0,placeholder:"From"}),r.createElement("span",{style:{alignSelf:"center"}},"to"),r.createElement("input",{type:"date",className:"form-control",value:m,onChange:e=>o(e.target.value),min:c||void 0,placeholder:"To"})))}},808:(e,a,t)=>{t.d(a,{S0:()=>l});const r={vacation:{id:"vacation",label:"🏖️ Vacation",emoji:"🏖️",color:"bg-blue-100 text-blue-800"},sick:{id:"sick",label:"🤒 Sick Leave",emoji:"🤒",color:"bg-red-100 text-red-800"},personal:{id:"personal",label:"👤 Personal Day",emoji:"👤",color:"bg-purple-100 text-purple-800"},holiday:{id:"holiday",label:"🎉 Holiday",emoji:"🎉",color:"bg-green-100 text-green-800"},"other leave type":{id:"other leave type",label:"📝 Other Leave Type",emoji:"📝",color:"bg-gray-100 text-gray-800"}},l=e=>{var a;return(null===(a=r[null==e?void 0:e.toLowerCase()])||void 0===a?void 0:a.emoji)||"📅"}},2435:(e,a,t)=>{t.d(a,{A:()=>d});var r=t(6540),l=t(2321),n=t(8697),s=t(4471),c=t(418);function i(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function m(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?i(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function o(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const d=e=>{var a,t,i,o,d,u,p;let{isOpen:v,onClose:g,currentUser:y,showNotification:E,onImportSuccess:f}=e;const[b,h]=(0,r.useState)(null),[N,D]=(0,r.useState)([]),[w,k]=(0,r.useState)(null),[S,T]=(0,r.useState)(!1),[O,A]=(0,r.useState)(!1),[_,P]=(0,r.useState)(null),C=async()=>{var e,a;if(null!=w&&w.success&&null!=w&&null!==(e=w.data)&&void 0!==e&&e.validationComplete){A(!0),P({success:!0,inProgress:!0,message:"Starting import process...",data:{importedRecords:0,totalRecords:(null===(a=w.data.validation)||void 0===a||null===(a=a.validRecords)||void 0===a?void 0:a.length)||0}});try{E("Starting import process...");const e=await(0,l.invoke)("importPTODailySchedules",{adminId:y.accountId,useStoredValidation:!0});if(P(m(m({},e),{},{inProgress:!1})),e.success){var t,r,n;const a="Successfully imported ".concat((null===(t=e.data)||void 0===t?void 0:t.importedRecords)||0," PTO records");E(a),f&&f(),(null===(r=e.data)||void 0===r?void 0:r.importedRecords)===(null===(n=e.data)||void 0===n?void 0:n.totalRecords)&&setTimeout((()=>{g(),j()}),3e3)}else E(e.message||"Import failed","error")}catch(e){console.error("Import error:",e);const a="Import failed: "+e.message;E(a,"error"),P({success:!1,inProgress:!1,message:a})}finally{A(!1)}}else E("Please complete validation before importing","error")},j=async()=>{h(null),D([]),k(null),P(null),T(!1),A(!1);try{if(y&&y.accountId){const e=await(0,l.invoke)("clearImportValidationData",{adminId:y.accountId});console.log("✅ Backend validation data cleared:",e)}else console.warn("⚠️ No current user available for cleanup"),await(0,l.invoke)("clearImportValidationData",{})}catch(e){console.error("❌ Error clearing validation data:",e)}};return(0,r.useEffect)((()=>{v||j()}),[v]),v?r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content"},r.createElement("div",{className:"modal-header"},r.createElement("h3",{className:"modal-title"},"Import PTO Requests"),r.createElement("button",{className:"modal-close",onClick:async()=>{try{w&&w.success&&null!=y&&y.accountId&&(console.log("🧹 Cleaning up validation data from modal close"),await(0,l.invoke)("clearImportValidationData",{adminId:y.accountId}))}catch(e){console.error("❌ Error clearing data on close:",e)}g(),await j()}},r.createElement(n.A,{size:20}))),r.createElement("div",{className:"modal-body"},r.createElement("div",{className:"import-pto-content"},r.createElement("p",null,"Import PTO daily schedules from a CSV file. The CSV should have the following columns:"),r.createElement("ul",{className:"csv-columns-list"},r.createElement("li",null,r.createElement("strong",null,"requester_email")," - Email address of the employee"),r.createElement("li",null,r.createElement("strong",null,"manager_email")," - Email address of the manager"),r.createElement("li",null,r.createElement("strong",null,"leave_type")," - Type of leave (vacation, sick, personal, etc.)"),r.createElement("li",null,r.createElement("strong",null,"date")," - Date of PTO in YYYY-MM-DD format"),r.createElement("li",null,r.createElement("strong",null,"status")," - Status of the PTO (approved, pending, declined, cancelled)"),r.createElement("li",null,"schedule_type - Optional: FULL_DAY or HALF_DAY (defaults to FULL_DAY)"),r.createElement("li",null,"hours - Optional: Number of hours (defaults to 8 for FULL_DAY, 4 for HALF_DAY)"),r.createElement("li",null,"created_at - Optional: Creation timestamp (defaults to current time)")),r.createElement("div",{className:"alert alert-info"},r.createElement("p",null,r.createElement("strong",null,"Note:")," The system will look up user account IDs from your existing user database based on email addresses."),r.createElement("p",null,"Valid leave types: vacation, sick, personal, holiday, other leave type"),r.createElement("p",null,r.createElement("strong",null,"Make sure the email addresses in your CSV match the emails in your user database!"))),r.createElement("div",{className:"import-step"},r.createElement("h4",null,"Step 1: Select CSV File"),r.createElement("div",{className:"form-group"},r.createElement("input",{type:"file",accept:".csv",onChange:async e=>{const a=e.target.files[0];if(console.log("🔍 DEBUG: File selected:",a),!a)return console.log("🔍 DEBUG: No file selected, resetting state"),h(null),D([]),void k(null);h(a),k(null);try{const e=new FileReader;e.onload=async e=>{try{const a=e.target.result;if(console.log("🔍 DEBUG: CSV data type:",typeof a),console.log("🔍 DEBUG: CSV data length:",a?a.length:"undefined"),!a)throw new Error("No data read from file");const t=a.split("\n");if(console.log("🔍 DEBUG: Rows after split:",t),console.log("🔍 DEBUG: Rows length:",t?t.length:"undefined"),!t||0===t.length)throw new Error("No rows found in CSV");const r=t[0]?t[0].split(",").map((e=>e?e.trim():"")):[];if(console.log("🔍 DEBUG: Headers:",r),console.log("🔍 DEBUG: Headers length:",r?r.length:"undefined"),!r||0===r.length)throw new Error("No headers found in CSV");let l=[];if(t.length>1){const e=t.slice(1);console.log("🔍 DEBUG: Data rows:",e),console.log("🔍 DEBUG: Data rows length:",e?e.length:"undefined");for(let a=0;a<e.length;a++){const t=e[a];if(console.log("🔍 DEBUG: Processing row ".concat(a,":"),t),t&&0!==t.trim().length)try{const e=t.split(",").map((e=>e?e.trim().replace(/^"|"$/g,""):""));console.log("🔍 DEBUG: Values for row ".concat(a,":"),e);const n={};r.forEach(((a,t)=>{n[a]=t<e.length?e[t]:""})),console.log("🔍 DEBUG: Record for row ".concat(a,":"),n),l.push(n)}catch(e){console.warn("🔍 DEBUG: Error parsing row ".concat(a+2,":"),e)}else console.log("🔍 DEBUG: Skipping empty row ".concat(a))}}if(console.log("🔍 DEBUG: Final parsed data:",l),console.log("🔍 DEBUG: Final parsed data length:",l?l.length:"undefined"),!l||0===l.length)return E("No valid data found in CSV file","error"),void D([]);D(l),E("CSV file loaded with ".concat(l.length,' records. Click "Validate Data" to proceed.'))}catch(e){console.error("🔍 DEBUG: CSV parsing error:",e),E("Failed to parse CSV file: "+e.message,"error"),D([])}},e.onerror=e=>{console.error("🔍 DEBUG: FileReader error:",e),E("Failed to read file","error"),h(null),D([])},e.readAsText(a)}catch(e){console.error("🔍 DEBUG: File reading error:",e),E("Failed to read file: "+e.message,"error"),h(null),D([])}},className:"form-control",disabled:S||O}),b&&r.createElement("div",{className:"file-info"},r.createElement("p",null,"Selected file: ",b.name),r.createElement("p",null,"Records found: ",N&&Array.isArray(N)?N.length:0)))),r.createElement("div",{className:"import-step"},r.createElement("h4",null,"Step 2: Validate Data"),r.createElement("button",{onClick:async()=>{if(N&&Array.isArray(N)&&0!==N.length){console.log("🔍 Starting database validation process..."),T(!0),k({success:!0,data:{isComplete:!1,validationInProgress:!0},message:"Validating data format and looking up users in database..."});try{var e;const r=await(0,l.invoke)("validatePTOImportData",{importData:N,adminId:y.accountId,checkJiraUsers:!0,batchIndex:0,batchSize:50});if(k(r),T(!1),r.success&&null!==(e=r.data)&&void 0!==e&&e.validationComplete){var a,t;const e=(null===(a=r.data.validation)||void 0===a||null===(a=a.validRecords)||void 0===a?void 0:a.length)||0,l=(null===(t=r.data.validation)||void 0===t?void 0:t.invalidRecords)||0;E("Database validation complete! ".concat(e," records ready for import. ").concat(l>0?"".concat(l," records have errors."):""))}else E(r.message||"Validation failed","error")}catch(e){console.error("Validation error:",e),k({success:!1,message:"Validation failed: "+e.message}),T(!1),E("Validation failed: "+e.message,"error")}}else E("No data to validate","error")},className:"btn btn-secondary",disabled:!N||!Array.isArray(N)||0===N.length||S||O},S?"Validating...":"Validate Data"),S&&r.createElement("div",{className:"validation-progress"},r.createElement("div",{className:"validation-spinner-container"},r.createElement("div",{className:"validation-spinner"}),r.createElement("div",{className:"validation-message"},r.createElement("h5",null,"Validating Import Data"),r.createElement("p",null,"Checking format and user database..."),r.createElement("div",{className:"validation-stats"},r.createElement("span",null,"📄 ",N.length," records to process"))))),w&&!S&&r.createElement("div",{className:"validation-result ".concat(w.success?"success":"error")},r.createElement("div",{className:"validation-header"},w.success?r.createElement(s.A,{size:20,className:"success-icon"}):r.createElement(c.A,{size:20,className:"error-icon"}),r.createElement("span",null,w.message)),(null===(a=w.data)||void 0===a?void 0:a.validation)&&r.createElement("div",{className:"validation-summary"},r.createElement("div",{className:"summary-grid"},r.createElement("div",{className:"summary-item"},r.createElement("span",{className:"summary-label"},"Total:"),r.createElement("span",{className:"summary-value"},w.data.validation.totalRecords)),r.createElement("div",{className:"summary-item"},r.createElement("span",{className:"summary-label"},"Ready:"),r.createElement("span",{className:"summary-value success"},(null===(t=w.data.validation.validRecords)||void 0===t?void 0:t.length)||0)),r.createElement("div",{className:"summary-item"},r.createElement("span",{className:"summary-label"},"Errors:"),r.createElement("span",{className:"summary-value error"},w.data.validation.invalidRecords||0))),(null===(i=w.data.validation.errors)||void 0===i?void 0:i.length)>0&&r.createElement("div",{className:"validation-errors"},r.createElement("h5",null,"Issues Found (",w.data.validation.errors.length,"):"),r.createElement("div",{className:"error-list"},w.data.validation.errors.slice(0,5).map(((e,a)=>{var t;return r.createElement("div",{key:a,className:"error-item"},r.createElement("span",{className:"error-record"},"Row ",e.record,":"),r.createElement("span",{className:"error-message"},e.errors.join(", ")),(null===(t=e.data)||void 0===t?void 0:t.requester_email)&&r.createElement("span",{className:"error-email"},"(",e.data.requester_email,")"))})),w.data.validation.errors.length>5&&r.createElement("div",{className:"error-more"},"+",w.data.validation.errors.length-5," more errors")))))),r.createElement("div",{className:"import-step"},r.createElement("h4",null,"Step 3: Import Data"),r.createElement("button",{onClick:C,className:"btn btn-primary",disabled:!(null!=w&&w.success)||O},O?"IMPORTING...":"Import Data"),O&&(null==_?void 0:_.inProgress)&&r.createElement("div",{className:"import-progress"},r.createElement("div",{className:"progress-bar"},r.createElement("div",{className:"progress-fill",style:{width:"".concat(Math.round(((null==_?void 0:_.recordsProcessed)||0)/((null==_?void 0:_.totalRecords)||1)*100),"%")}})),r.createElement("div",{className:"progress-stats"},r.createElement("span",null,"Processing batch ",(null==_?void 0:_.batchNumber)||1," of ",(null==_?void 0:_.totalBatches)||1),r.createElement("span",null,(null==_?void 0:_.recordsProcessed)||0," of ",(null==_?void 0:_.totalRecords)||0," records processed"),r.createElement("span",null,(null==_?void 0:_.importedRecords)||0," imported, ",(null==_?void 0:_.failedRecords)||0," failed"))),_&&!_.inProgress&&r.createElement("div",{className:"import-result ".concat(_.success?"success":"error")},r.createElement("div",{className:"import-result-header"},_.success?r.createElement(s.A,{size:20,className:"success-icon"}):r.createElement(c.A,{size:20,className:"error-icon"}),r.createElement("span",null,_.message)),_.data&&r.createElement("div",{className:"import-result-details"},r.createElement("div",{className:"import-stats"},r.createElement("div",{className:"stat-item"},r.createElement("span",{className:"stat-label"},"Total Records:"),r.createElement("span",{className:"stat-value"},(null==_||null===(o=_.data)||void 0===o?void 0:o.totalRecords)||0)),r.createElement("div",{className:"stat-item"},r.createElement("span",{className:"stat-label"},"Imported:"),r.createElement("span",{className:"stat-value success"},(null==_||null===(d=_.data)||void 0===d?void 0:d.importedRecords)||0)),r.createElement("div",{className:"stat-item"},r.createElement("span",{className:"stat-label"},"Failed:"),r.createElement("span",{className:"stat-value error"},(null==_||null===(u=_.data)||void 0===u?void 0:u.failedRecords)||0))),_.data.errors&&_.data.errors.length>0&&r.createElement("div",{className:"import-errors"},r.createElement("h5",null,"Failed Records:"),r.createElement("div",{className:"error-table-container"},r.createElement("table",{className:"error-table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Record #"),r.createElement("th",null,"Error"),r.createElement("th",null,"Email"))),r.createElement("tbody",null,_.data.errors.slice(0,10).map(((e,a)=>r.createElement("tr",{key:a,className:"error-row"},r.createElement("td",null,e.record),r.createElement("td",{className:"error-message"},e.batch?"Batch ".concat(e.batch,": ").concat(e.error):e.error||e.errors&&e.errors.join(", ")),r.createElement("td",null,e.data&&r.createElement("div",{className:"error-data"},e.data.requester_email&&r.createElement("div",null,"Requester: ",e.data.requester_email),e.data.manager_email&&r.createElement("div",null,"Manager: ",e.data.manager_email)))))))),_.data.errors.length>10&&r.createElement("div",{className:"more-errors"},"...and ",_.data.errors.length-10," more errors")))),_.success&&(null===(p=_.data)||void 0===p?void 0:p.importedRecords)>0&&r.createElement("div",{className:"import-success-message"},r.createElement("p",null,"✅ PTO records have been successfully imported."),r.createElement("p",null,"The modal will close automatically in a few seconds, or you can close it manually."))),r.createElement("div",{className:"form-actions"},r.createElement("button",{onClick:()=>{g(),j()},className:"btn btn-secondary",disabled:O},_&&_.success?"Close":"Cancel"),r.createElement("button",{onClick:C,className:"btn btn-primary",disabled:!w||!w.success||O||_&&_.success},O?r.createElement(r.Fragment,null,r.createElement("span",{className:"spinner"}),"Importing..."):_&&_.success?"Imported Successfully":"Import Data"))))))):null}},2605:(e,a,t)=>{var r=t(6540),l=t(5338),n=t(2307),s=t(7235),c=t(7623),i=t(2492),m=t(8686),o=t(2321);const d=e=>{let{message:a,type:t,onClose:l}=e;return r.createElement("div",{className:"fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ".concat("success"===t?"bg-green-500 text-white":"bg-red-500 text-white")},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("span",null,a),r.createElement("button",{onClick:l,className:"ml-4 text-white hover:text-gray-200"},"×")))};var u=t(7892),p=t(2898),v=t(5143),g=t(9681),y=t(3029);function E(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?E(Object(t),!0).forEach((function(a){b(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function b(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const h=()=>{const[e,a]=(0,r.useState)(null),[t,l]=(0,r.useState)(!0),[n,s]=(0,r.useState)(null),[c,i]=(0,r.useState)(0);(0,r.useEffect)((()=>{m()}),[]);const m=async function(){l(!0),s(null);try{var e;console.log("🔍 Fetching current user...");let t=await(0,o.invoke)("getCurrentUser");if(t.success||"NETWORK_ERROR"!==(null===(e=t.error)||void 0===e?void 0:e.type)||(console.log("🔄 Main method failed, trying fallback..."),t=await(0,o.invoke)("getCurrentUserFallback")),!t.success)throw new Error(t.message||"Failed to fetch current user");{console.log("👤 User data received:",t.data);let e=!1;try{const a=await(0,o.invoke)("checkUserAdminStatus",{accountId:t.data.accountId});e=!!a.success&&a.data.isAdmin}catch(e){console.warn("⚠️ Could not check admin status:",e)}const r=f(f({},t.data),{},{isAdmin:e});console.log("✅ Current user loaded:",r.displayName,"isAdmin:",r.isAdmin),a(r),i(0)}}catch(e){if(console.error("❌ Error fetching current user:",e),s(e.message),e.message.includes("timeout")||e.message.includes("fetch failed")){if(c<3)return console.log("🔄 Auto-retrying in 5 seconds... (attempt ".concat(c+1,"/3)")),void setTimeout((()=>{i((e=>e+1)),m(!0)}),5e3);s("Network connection failed after multiple attempts. Please check your internet connection and refresh the page.")}}finally{l(!1)}};return{currentUser:e,loading:t,error:n,refreshUser:async()=>{i(0),await m()},testConnectivity:async()=>{try{return await(0,o.invoke)("testConnectivity")}catch(e){return{success:!1,message:"Connectivity test failed: "+e.message}}},isAdmin:(null==e?void 0:e.isAdmin)||!1,retryCount:c}};function N(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function D(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?N(Object(t),!0).forEach((function(a){w(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):N(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function w(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const k=e=>{const[a,t]=(0,r.useState)([]),[l,n]=(0,r.useState)(!0),[s,c]=(0,r.useState)(null),i=(0,r.useCallback)((async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e){n(!0),c(null);try{console.log("📋 Fetching PTO requests with filters:",a);const e=await(0,o.invoke)("getPTORequests",a);if(!e.success)throw new Error(e.message||"Failed to fetch PTO requests");var r;t(e.data||[]),console.log("✅ Loaded ".concat((null===(r=e.data)||void 0===r?void 0:r.length)||0," PTO requests"))}catch(e){c(e.message),console.error("❌ Error fetching PTO requests:",e)}finally{n(!1)}}}),[e]),m=(0,r.useCallback)((async e=>{n(!0),c(null);try{console.log("📝 Submitting PTO request:",e);const a=await(0,o.invoke)("storePTORequest",e);if(a.success)return await i(),{success:!0,data:a.data};throw new Error(a.message||"Failed to submit PTO request")}catch(e){return c(e.message),console.error("❌ Error submitting PTO request:",e),{success:!1,message:e.message}}finally{n(!1)}}),[i]),d=(0,r.useCallback)((async function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";n(!0),c(null);try{console.log("✅ Updating PTO request ".concat(e," to ").concat(a));const l=await(0,o.invoke)("updatePTORequest",{requestId:e,status:a,comment:r});if(l.success)return t((t=>t.map((t=>t.id===e?D(D({},t),{},{status:a,reviewer_comments:r,reviewed_at:(new Date).toISOString()}):t)))),{success:!0};throw new Error(l.message||"Failed to update PTO request")}catch(e){return c(e.message),console.error("❌ Error updating PTO request:",e),{success:!1,message:e.message}}finally{n(!1)}}),[]),u=(0,r.useCallback)((async e=>{n(!0),c(null);try{console.log("🗑️ Cancelling PTO request ".concat(e));const a=await(0,o.invoke)("updatePTORequest",{requestId:e,status:"cancelled",comment:"Cancelled by user"});if(a.success)return t((a=>a.filter((a=>a.id!==e)))),{success:!0};throw new Error(a.message||"Failed to cancel PTO request")}catch(e){return c(e.message),console.error("❌ Error cancelling PTO request:",e),{success:!1,message:e.message}}finally{n(!1)}}),[]),p=(0,r.useCallback)((e=>a.filter((a=>a.requester_id===e))),[a]),v=(0,r.useCallback)((()=>a.filter((e=>"pending"===e.status))),[a]),g=(0,r.useCallback)((e=>a.filter((a=>a.status===e))),[a]),y=(0,r.useCallback)(((e,t)=>a.filter((a=>{const r=new Date(a.start_date),l=new Date(a.end_date),n=new Date(e),s=new Date(t);return r>=n&&r<=s||l>=n&&l<=s||r<=n&&l>=s}))),[a]),E=(0,r.useCallback)((async()=>{if(null==e||!e.emailAddress)return[];try{console.log("📋 Fetching pending requests for manager:",e.emailAddress);const a=await(0,o.invoke)("getPendingRequests",{managerEmail:e.emailAddress});return a.success?a.data||[]:(console.error("Failed to fetch pending requests:",a.message),[])}catch(e){return console.error("❌ Error fetching pending requests for manager:",e),[]}}),[e]);return(0,r.useEffect)((()=>{e&&i()}),[e,i]),{requests:a,loading:l,error:s,fetchRequests:i,submitRequest:m,updateRequestStatus:d,cancelRequest:u,getUserRequests:p,getPendingRequests:v,getRequestsByStatus:g,getRequestsByDateRange:y,getPendingRequestsForManager:E}},S=()=>{var e;const[a,t]=(0,r.useState)("calendar"),[l,E]=(0,r.useState)([]),[f,b]=(0,r.useState)(null),[N,D]=(0,r.useState)(!0),[w,S]=(0,r.useState)([]),[T,O]=(0,r.useState)([]),[A,_]=(0,r.useState)([]),[P,C]=(0,r.useState)(!1),[j,U]=(0,r.useState)(null),[q,I]=(0,r.useState)(!1),{currentUser:R,loading:x,error:F,isAdmin:L}=h(),{requests:M,loading:z,error:B,submitRequest:W,updateRequestStatus:V,cancelRequest:Y,fetchRequests:G,getUserRequests:H,getPendingRequests:J}=k(R),[K,$]=(0,r.useState)(!1);(0,r.useEffect)((()=>{(async()=>{if(R)try{const e=await(0,o.invoke)("getUserTeams",{userId:P?j.jira_account_id:R.accountId});e.success&&S(e.data||[]);const[a,t]=await Promise.all([(0,o.invoke)("getUsers"),(0,o.invoke)("getTeams")]);if(a.success&&O(a.data||[]),t.success){const e=t.data||[];_(e);const a=P?j.jira_account_id||j.id:R.jira_account_id||R.id,r=e.filter((e=>{var t,r;return(null===(t=e.manager)||void 0===t?void 0:t.jira_account_id)===a||(null===(r=e.manager)||void 0===r?void 0:r.id)===a}));$(r.length>0||L&&!P)}}catch(e){console.error("Error loading additional data:",e)}})()}),[R,L,P,j]),(0,r.useEffect)((()=>{(async()=>{D(!0);try{console.log("🔧 Initializing PTO App with Admin Setup...");const e=await(0,o.invoke)("initializePTODatabaseWithTeamManagement");if(e.success)console.log("✅ PTO App and Admin initialized:",e.data);else{console.warn("Admin setup failed, trying regular init:",e.message);const a=await(0,o.invoke)("initializePTODatabase");if(!a.success)throw new Error(a.message)}try{await(0,o.invoke)("clearImportValidationData"),console.log("✅ Cleared any stale import validation data on app start")}catch(e){console.warn("⚠️ Could not clear import validation data:",e)}console.log("✅ PTO App initialization complete")}catch(e){console.error("❌ App initialization failed:",e),Q("Failed to initialize app: "+e.message,"error")}finally{D(!1)}})()}),[]);const Q=function(e){b({message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"}),setTimeout((()=>b(null)),5e3)},X=[{id:"calendar",label:"Calendar",icon:n.A,description:"View and create PTO requests"},{id:"requests",label:"My Requests",icon:s.A,description:"View your PTO request history"},...K?[{id:"manager",label:"Manager",icon:c.A,description:"Manage team PTO requests"}]:[],...(P?q:L)?[{id:"admin",label:"Admin",icon:i.A,description:"Administrative functions"}]:[]],Z=P?null==j?void 0:j.accountId:null==R?void 0:R.accountId,ee=H(Z),ae=J().filter((e=>e.requester_id!==Z));return N||x?r.createElement("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center"},r.createElement("div",{className:"text-center"},r.createElement("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),r.createElement("h2",{className:"text-xl font-semibold text-gray-900 mb-2"},"Initializing PTO Management"),r.createElement("p",{className:"text-gray-600"},"Setting up database and admin users..."))):F?r.createElement("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center"},r.createElement("div",{className:"text-center p-8 bg-white rounded-lg shadow-md"},r.createElement("div",{className:"text-red-500 mb-4"},r.createElement("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"}))),r.createElement("h2",{className:"text-xl font-semibold text-gray-900 mb-2"},"Authentication Error"),r.createElement("p",{className:"text-gray-600 mb-4"},"Failed to load user information: ",F),r.createElement("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600"},"Retry"))):R?r.createElement("div",{className:"pto-management-app"},R&&r.createElement("div",{className:"app-header"},r.createElement("div",{className:"app-header-left"},r.createElement("h1",null,"PTO Management")),r.createElement("div",{className:"app-header-right"},L&&!P&&r.createElement("div",{className:"view-as-controls"},r.createElement(v.A,{selectedUser:j,onSelect:async e=>{if(!e)return C(!1),U(null),void I(!1);try{const a=await(0,o.invoke)("getUserTeams",{userId:e.jira_account_id||e.id});if(a.success){U(e),S(a.data||[]),C(!0);const t=await(0,o.invoke)("checkUserAdminStatus",{accountId:e.jira_account_id||e.accountId||e.id});I(!!t.success&&t.data.isAdmin)}}catch(e){console.error("Error setting view as user:",e),I(!1)}},placeholder:"View as user...",useBackendSearch:!0})),P&&r.createElement("div",{className:"view-as-banner"},r.createElement("span",null,"Viewing as: ",(null==j?void 0:j.display_name)||(null==j?void 0:j.displayName)),r.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>{C(!1),U(null),I(!1),loadAllData()}},"Exit View As")),r.createElement("div",{className:"user-info"},r.createElement("span",null,R.displayName),L&&!P&&r.createElement("span",{className:"badge badge-admin"},"Admin"),K&&!P&&r.createElement("span",{className:"badge badge-manager"},"Manager")))),r.createElement("div",{className:"min-h-screen bg-gray-50"},r.createElement("div",{className:"app-topbar"},r.createElement("div",{className:"app-logo"},r.createElement("div",{className:"app-logo-icon"},r.createElement(n.A,{size:20})),r.createElement("span",{style:{fontWeight:600,fontSize:"1.125rem",color:"#1f2937"}},"PTO Request")),r.createElement("div",{className:"nav-tabs condensed"},X.map((e=>{const l=e.icon,n=a===e.id;return r.createElement("button",{key:e.id,onClick:async()=>{try{await(0,o.invoke)("clearImportValidationData")}catch(e){console.warn("⚠️ Could not clear validation data:",e)}t(e.id)},className:"nav-tab".concat(n?" active":"").concat("admin"===e.id?" admin":"").concat("manager"!==e.id||L?"":" manager"),title:e.description},r.createElement(l,{size:18}),r.createElement("span",null,e.label),"manager"===e.id&&ae.length>0&&r.createElement("span",{className:"nav-tab-badge"},ae.length),"admin"===e.id&&r.createElement("span",{className:"nav-tab-label admin"},"Admin"),"manager"===e.id&&!L&&r.createElement("span",{className:"nav-tab-label manager"},"Manager"))}))),r.createElement("div",{className:"app-user-profile"},r.createElement("div",{className:"user-avatar-header"},(null===(e=R.displayName)||void 0===e?void 0:e.charAt(0))||r.createElement(m.A,{size:16}),L&&r.createElement("span",{className:"user-badge admin"},r.createElement(i.A,{size:8})),K&&!L&&r.createElement("span",{className:"user-badge manager"},r.createElement(c.A,{size:8}))),r.createElement("div",{className:"user-info-header"},r.createElement("div",{className:"user-name-header"},r.createElement("span",null,R.displayName),L&&r.createElement(i.A,{size:12,style:{color:"#8b5cf6"}}),K&&!L&&r.createElement(c.A,{size:12,style:{color:"#f97316"}})),r.createElement("div",{className:"user-email-header"},R.emailAddress)))),r.createElement("main",{style:{maxWidth:"80rem",margin:"0 auto",padding:"2rem 1rem"}},"calendar"===a&&r.createElement(g.A,{events:M,onDateSelect:e=>{const a=e.toISOString().split("T")[0];E((e=>e.includes(a)?e.filter((e=>e!==a)):[...e,a].sort()))},selectedDates:l,onSubmitPTO:async e=>{try{var a;const t=T.find((e=>e.jira_account_id===(null==R?void 0:R.accountId)||e.email_address===(null==R?void 0:R.emailAddress)));let r=null;if(null!=t&&t.team_id){const e=A.find((e=>e.id===t.team_id));null!=e&&e.manager&&(r=e.manager)}const n={reporter:e.targetUser||R,manager:e.manager||r||{accountId:"manager-default",displayName:"Manager",emailAddress:"manager@company.com"},startDate:e.startDate||l[0],endDate:e.endDate||l[l.length-1],leaveType:e.leaveType||(null===(a=e.dailySchedules)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.leaveType)||"vacation",reason:e.reason||"",dailySchedules:e.dailySchedules||l.map((e=>({date:e,type:"FULL_DAY",leaveType:"vacation"})))},s=await W(n);return s.success?(E([]),Q("PTO request submitted successfully!"),{success:!0}):(Q(s.message||"Failed to submit PTO request","error"),{success:!1})}catch(e){return console.error("Error submitting PTO request:",e),Q("Failed to submit PTO request","error"),{success:!1}}},currentUser:P?j:R,allUsers:T,allTeams:A,isAdmin:P?q:L}),"requests"===a&&r.createElement(y.A,{requests:ee,currentUser:P?j:R,onEditRequest:async e=>{try{const a=await(0,o.invoke)("editPTORequest",{requestId:e.id,editedBy:R.accountId,updatedData:{startDate:e.startDate,endDate:e.endDate,leaveType:e.leaveType,reason:e.reason,dailySchedules:e.dailySchedules}});a.success?(Q("PTO request updated successfully and resubmitted for approval"),P?loadUserRequests(j):loadAllRequests()):Q(a.message||"Failed to update PTO request","error")}catch(e){console.error("Error updating PTO request:",e),Q("Failed to update PTO request","error")}},onCancelRequest:async e=>{if(window.confirm("Are you sure you want to cancel this PTO request?"))try{const a=await Y(e.id);a.success?Q("PTO request cancelled successfully!"):Q(a.message||"Failed to cancel PTO request","error")}catch(e){console.error("Error cancelling PTO request:",e),Q("Failed to cancel PTO request","error")}}}),"manager"===a&&K&&r.createElement(p.A,{currentUser:R,isAdmin:L,showNotification:Q}),"admin"===a&&L&&r.createElement(u.A,{currentUser:R,showNotification:Q})),(z||N)&&r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content",style:{maxWidth:320,padding:24,textAlign:"center"}},r.createElement("div",{className:"loading-spinner",style:{margin:"0 auto 1rem"}}),r.createElement("span",null,"Processing..."))),f&&r.createElement(d,{message:f.message,type:f.type,onClose:()=>b(null)}))):r.createElement("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center"},r.createElement("div",{className:"text-center"},r.createElement("div",{className:"w-16 h-16 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),r.createElement("p",{className:"text-gray-600"},"Loading user information...")))};console.log("PTO app initializing...");const T=async()=>{const e=document.getElementById("root");if(!e)return void console.error('Root element not found! Make sure there is a div with id="root" in your HTML.');(0,l.H)(e).render(r.createElement(r.StrictMode,null,r.createElement(S,null))),console.log("App rendered successfully");try{await o.view.resize(),console.log("Forge iframe resized")}catch(e){console.warn("Unable to resize Forge iframe:",e)}};"complete"===document.readyState||"interactive"===document.readyState?T():document.addEventListener("DOMContentLoaded",T)},3245:(e,a,t)=>{t.d(a,{A:()=>c});var r=t(6540),l=t(7946),n=t(4471),s=t(180);const c=e=>{let{status:a}=e;const t=(e=>{const a={pending:{bg:"bg-yellow-100",text:"text-yellow-800",icon:l.A,label:"Pending"},approved:{bg:"bg-green-100",text:"text-green-800",icon:n.A,label:"Approved"},declined:{bg:"bg-red-100",text:"text-red-800",icon:s.A,label:"Declined"}};return a[e.toLowerCase()]||a.pending})(a),c=t.icon;return r.createElement("span",{className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ".concat(t.bg," ").concat(t.text)},r.createElement(c,{size:12}),r.createElement("span",null,t.label))}},4143:(e,a,t)=>{t.d(a,{A:()=>y});var r=t(6540),l=t(2307),n=t(4471),s=t(7235),c=t(4934),i=t(2708),m=t(7946),o=t(2321),d=t(5143),u=t(9618);function p(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?p(Object(t),!0).forEach((function(a){g(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function g(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const y=e=>{let{currentUser:a,showNotification:t,isAdmin:p}=e;const[g,y]=(0,r.useState)(null),[E,f]=(0,r.useState)({startDate:new Date((new Date).getFullYear(),0,1).toISOString().split("T")[0],endDate:new Date((new Date).getFullYear(),11,31).toISOString().split("T")[0]}),[b,h]=(0,r.useState)([]),[N,D]=(0,r.useState)(!1),[w,k]=(0,r.useState)(null);(0,r.useEffect)((()=>{g&&S()}),[g,E]);const S=async()=>{D(!0);try{const e=await(0,o.invoke)("getPTORequests",{requester_id:g.accountId,startDate:E.startDate,endDate:E.endDate});e.success&&h(e.data||[])}catch(e){t("Failed to load PTO requests","error")}finally{D(!1)}},T={totalDays:b.reduce(((e,a)=>e+(a.total_days||0)),0),approved:b.filter((e=>"approved"===e.status)).length,pending:b.filter((e=>"pending"===e.status)).length,declined:b.filter((e=>"declined"===e.status)).length};return r.createElement("div",{className:"user-pto-management"},r.createElement("div",{className:"user-pto-header"},r.createElement("h2",null,"User PTO Management"),r.createElement("div",{className:"user-pto-controls"},r.createElement(d.A,{selectedUser:g,onSelect:y,placeholder:"Search and select user",useBackendSearch:!0}),r.createElement("div",{className:"date-range-filter"},r.createElement("input",{type:"date",value:E.startDate,onChange:e=>f((a=>v(v({},a),{},{startDate:e.target.value}))),className:"form-control"}),r.createElement("span",null,"to"),r.createElement("input",{type:"date",value:E.endDate,onChange:e=>f((a=>v(v({},a),{},{endDate:e.target.value}))),className:"form-control"})))),g&&r.createElement(r.Fragment,null,r.createElement("div",{className:"summary-cards"},r.createElement("div",{className:"summary-card"},r.createElement("div",{className:"card-icon"},r.createElement(l.A,{size:24})),r.createElement("div",{className:"card-content"},r.createElement("div",{className:"card-value"},T.totalDays),r.createElement("div",{className:"card-label"},"Total PTO Days"))),r.createElement("div",{className:"summary-card approved"},r.createElement("div",{className:"card-icon"},r.createElement(n.A,{size:24})),r.createElement("div",{className:"card-content"},r.createElement("div",{className:"card-value"},T.approved),r.createElement("div",{className:"card-label"},"Approved"))),r.createElement("div",{className:"summary-card pending"},r.createElement("div",{className:"card-icon"},r.createElement(s.A,{size:24})),r.createElement("div",{className:"card-content"},r.createElement("div",{className:"card-value"},T.pending),r.createElement("div",{className:"card-label"},"Pending")))),r.createElement("div",{className:"requests-table-container"},r.createElement("table",{className:"requests-table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"PTO Date"),r.createElement("th",null,"Leave Type"),r.createElement("th",null,"Period"),r.createElement("th",null,"Days"),r.createElement("th",null,"Reason"),r.createElement("th",null,"Status"),p&&r.createElement("th",null,"Actions"))),r.createElement("tbody",null,b.map((e=>r.createElement("tr",{key:e.id},r.createElement("td",null,new Date(e.start_date).toLocaleDateString()),r.createElement("td",null,r.createElement("span",{className:"leave-type ".concat(e.leave_type)},e.leave_type)),r.createElement("td",null,e.start_date===e.end_date?new Date(e.start_date).toLocaleDateString():"".concat(new Date(e.start_date).toLocaleDateString()," - ").concat(new Date(e.end_date).toLocaleDateString())),r.createElement("td",null,e.total_days),r.createElement("td",null,e.reason),r.createElement("td",null,r.createElement("span",{className:"status-badge status-".concat(e.status)},e.status)),p&&r.createElement("td",{className:"actions"},r.createElement("button",{onClick:()=>(e=>{k(e)})(e),className:"action-btn edit",title:"Edit request"},r.createElement(c.A,{size:16})),r.createElement("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this PTO request?"))try{const r=await(0,o.invoke)("adminDeletePTORequest",{requestId:e.id,adminId:a.accountId,reason:"Admin deletion"});r.success?(t("PTO request deleted successfully"),S()):t(r.message||"Failed to delete request","error")}catch(e){t("Failed to delete PTO request","error")}})(e),className:"action-btn delete",title:"Delete request"},r.createElement(i.A,{size:16})))))),0===b.length&&r.createElement("tr",null,r.createElement("td",{colSpan:p?7:6,className:"empty-state"},r.createElement("div",{className:"empty-content"},r.createElement(l.A,{size:24}),r.createElement("p",null,"No PTO requests found for this period")))))))),!g&&r.createElement("div",{className:"empty-state"},r.createElement("div",{className:"empty-content"},r.createElement(m.A,{size:32}),r.createElement("p",null,"Select a user to view their PTO requests"))),w&&r.createElement(u.A,{request:w,onClose:()=>k(null),onSave:async e=>{t("PTO request updated successfully"),S()},currentUser:a}))}},4506:(e,a,t)=>{t.d(a,{A:()=>b});var r=t(6540),l=t(2307),n=t(8697),s=t(418),c=t(8686),i=t(3893),m=t(4471),o=t(2708),d=t(7235),u=t(6069),p=t(5143),v=t(808),g=t(2321);function y(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function E(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?y(Object(t),!0).forEach((function(a){f(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function f(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const b=e=>{var a,t,y,f,b;let{selectedDates:h=[],onClose:N,onSubmit:D,currentUser:w,currentUserData:k,userManager:S,allUsers:T=[],allTeams:O=[],allRequests:A=[],isAdmin:_=!1,isAdminMode:P=!1}=e;const[C,j]=(0,r.useState)({targetUser:w,manager:S,startDate:h[0]||"",endDate:h[h.length-1]||"",reason:"",dailySchedules:[]}),[U,q]=(0,r.useState)({}),[I,R]=(0,r.useState)(!1);(0,r.useEffect)((()=>{R(!_&&!k)}),[_,k]);const x=e=>{if(!e)return null;const a=T.find((a=>a.jira_account_id===e.accountId||a.email_address===e.emailAddress));if(null==a||!a.team_id)return null;const t=O.find((e=>e.id===a.team_id));return(null==t?void 0:t.manager)||null};(0,r.useEffect)((()=>{(()=>{let e=[];if(h.length>0)e=h;else if(C.startDate&&C.endDate){const a=new Date(C.startDate),t=new Date(C.endDate);e=[];for(let r=new Date(a);r<=t;r.setDate(r.getDate()+1))e.push(r.toISOString().split("T")[0])}const a=e.map((e=>({date:e,type:"FULL_DAY",leaveType:"vacation"})));j((t=>E(E({},t),{},{targetUser:_?t.targetUser:w,manager:x(_?t.targetUser:w)||S||t.manager,startDate:e[0]||"",endDate:e[e.length-1]||"",dailySchedules:a})))})()}),[h,w,S,_,T,O]),(0,r.useEffect)((()=>{if(C.startDate&&C.endDate){const e=new Date(C.startDate),a=new Date(C.endDate),t=[];for(let r=new Date(e);r<=a;r.setDate(r.getDate()+1))t.push(r.toISOString().split("T")[0]);const r=C.dailySchedules.filter((e=>t.includes(e.date))),l=t.filter((e=>!r.find((a=>a.date===e)))).map((e=>({date:e,type:"FULL_DAY",leaveType:"vacation"})));j((e=>E(E({},e),{},{dailySchedules:[...r,...l].sort(((e,a)=>new Date(e.date)-new Date(a.date)))})))}}),[C.startDate,C.endDate]);const F=(e,a,t)=>{j((r=>E(E({},r),{},{dailySchedules:r.dailySchedules.map(((r,l)=>l===e?E(E({},r),{},{[a]:t}):r))})))},L=[{value:"FULL_DAY",label:"Full Day (8h)"},{value:"HALF_DAY_MORNING",label:"Morning Half (4h)"},{value:"HALF_DAY_AFTERNOON",label:"Afternoon Half (4h)"}],M=[{value:"vacation",label:"🏖️ Vacation",emoji:"🏖️"},{value:"sick",label:"🤒 Sick Leave",emoji:"🤒"},{value:"personal",label:"👤 Personal Day",emoji:"👤"},{value:"holiday",label:"🎉 Holiday",emoji:"🎉"},{value:"other leave type",label:"📝 Other Leave Type",emoji:"📝"}],z={totalDays:C.dailySchedules.reduce(((e,a)=>e+("FULL_DAY"===a.type?1:.5)),0),totalHours:C.dailySchedules.reduce(((e,a)=>e+("FULL_DAY"===a.type?8:4)),0),leaveTypeBreakdown:C.dailySchedules.reduce(((e,a)=>(e[a.leaveType]=(e[a.leaveType]||0)+("FULL_DAY"===a.type?1:.5),e)),{}),workingDays:C.dailySchedules.length,dateRange:C.startDate&&C.endDate?"".concat(new Date(C.startDate).toLocaleDateString()," - ").concat(new Date(C.endDate).toLocaleDateString()):""};return r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content pto-submission-modal"},r.createElement("div",{className:"modal-header"},r.createElement("h3",{className:"modal-title"},r.createElement(l.A,{size:20}),_?"Create PTO Request (Admin)":"Submit PTO Request"),r.createElement("button",{onClick:N,className:"modal-close"},r.createElement(n.A,{size:20}))),r.createElement("div",{className:"modal-body"},I&&r.createElement("div",{className:"alert alert-warning"},r.createElement(s.A,{size:20}),r.createElement("div",null,r.createElement("strong",null,"User Not in System"),r.createElement("p",null,"Your user profile is not set up in the team management system. Please contact HR to complete your setup."))),r.createElement("div",{className:"form-section"},r.createElement("label",{className:"form-label"},"Employee ",_?"*":""),_?r.createElement(p.A,{selectedUser:C.targetUser,onSelect:async e=>{if(e)try{const a=await(0,g.invoke)("getUsers"),t=(a.success&&a.data||[]).find((a=>a.jira_account_id===e.accountId||a.email_address===e.emailAddress));j(t?e=>E(E({},e),{},{targetUser:t}):a=>E(E({},a),{},{targetUser:e}))}catch(a){console.error("Failed to get user details:",a),j((a=>E(E({},a),{},{targetUser:e})))}else j((e=>E(E({},e),{},{targetUser:null})))},placeholder:"Search and select employee",required:!0,error:U.targetUser,useBackendSearch:!0}):r.createElement("div",{className:"user-display-card"},r.createElement("div",{className:"user-avatar-large"},null!=w&&w.avatarUrl?r.createElement("img",{src:w.avatarUrl,alt:w.displayName}):r.createElement("div",{className:"avatar-placeholder-large"},(null==w||null===(a=w.displayName)||void 0===a?void 0:a.charAt(0))||r.createElement(c.A,{size:20}))),r.createElement("div",{className:"user-info-detailed"},r.createElement("div",{className:"user-name-large"},null==w?void 0:w.displayName),r.createElement("div",{className:"user-email-large"},null==w?void 0:w.emailAddress),(null==k?void 0:k.team_id)&&r.createElement("div",{className:"user-team"},r.createElement(i.A,{size:14}),(null===(t=O.find((e=>e.id===k.team_id)))||void 0===t?void 0:t.name)||"Team Member"))),U.targetUser&&r.createElement("div",{className:"error-text"},U.targetUser)),r.createElement("div",{className:"form-section"},r.createElement("label",{className:"form-label"},"Manager *"),C.manager?r.createElement("div",{className:"user-display-card manager-display"},r.createElement("div",{className:"user-avatar-large"},C.manager.avatarUrl?r.createElement("img",{src:C.manager.avatarUrl,alt:C.manager.displayName}):r.createElement("div",{className:"avatar-placeholder-large"},(null===(y=C.manager.displayName)||void 0===y?void 0:y.charAt(0))||r.createElement(c.A,{size:20}))),r.createElement("div",{className:"user-info-detailed"},r.createElement("div",{className:"user-name-large"},C.manager.displayName),r.createElement("div",{className:"user-email-large"},C.manager.emailAddress),r.createElement("div",{className:"manager-badge"},r.createElement(m.A,{size:14}),"Approving Manager")),_&&r.createElement("button",{type:"button",onClick:()=>j((e=>E(E({},e),{},{manager:null}))),className:"btn btn-sm btn-secondary",title:"Change Manager"},"Change")):r.createElement(p.A,{selectedUser:C.manager,onSelect:e=>j((a=>E(E({},a),{},{manager:e}))),placeholder:"Search and select approving manager",required:!0,error:U.manager,useBackendSearch:!0}),U.manager&&r.createElement("div",{className:"error-text"},U.manager)),r.createElement("div",{className:"form-section"},r.createElement("div",{className:"form-row"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"form-label"},"Start Date *"),r.createElement("input",{type:"date",value:C.startDate,onChange:e=>j((a=>E(E({},a),{},{startDate:e.target.value}))),className:"form-control ".concat(U.startDate?"error":""),min:(new Date).toISOString().split("T")[0]}),U.startDate&&r.createElement("div",{className:"error-text"},U.startDate)),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"form-label"},"End Date *"),r.createElement("input",{type:"date",value:C.endDate,onChange:e=>j((a=>E(E({},a),{},{endDate:e.target.value}))),className:"form-control ".concat(U.endDate?"error":""),min:C.startDate||(new Date).toISOString().split("T")[0]}),U.endDate&&r.createElement("div",{className:"error-text"},U.endDate)))),r.createElement("div",{className:"form-section"},r.createElement("label",{className:"form-label"},"Reason (Optional)"),r.createElement("textarea",{value:C.reason,onChange:e=>j((a=>E(E({},a),{},{reason:e.target.value}))),className:"form-control",rows:"3",placeholder:"Please provide additional details about your PTO request..."})),C.dailySchedules.length>0&&r.createElement("div",{className:"form-section"},r.createElement("div",{className:"schedule-header"},r.createElement("label",{className:"form-label"},"Schedule Details"),r.createElement("div",{className:"quick-actions"},r.createElement("span",{className:"quick-actions-label"},"Apply to all:"),M.map((e=>r.createElement("button",{key:e.value,type:"button",onClick:()=>{return a=e.value,void j((e=>E(E({},e),{},{dailySchedules:e.dailySchedules.map((e=>E(E({},e),{},{leaveType:a})))})));var a},className:"btn btn-sm btn-secondary quick-action-btn",title:"Mark all days as ".concat(e.label)},r.createElement("span",null,e.emoji),r.createElement("span",null,e.value)))))),r.createElement("div",{className:"schedule-list"},C.dailySchedules.map(((e,a)=>r.createElement("div",{key:e.date,className:"schedule-day-row"},r.createElement("div",{className:"schedule-day-info"},r.createElement("div",{className:"day-date"},new Date(e.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}))),r.createElement("div",{className:"schedule-controls"},r.createElement("select",{value:e.leaveType,onChange:e=>F(a,"leaveType",e.target.value),className:"form-control schedule-select"},M.map((e=>r.createElement("option",{key:e.value,value:e.value},e.label)))),r.createElement("select",{value:e.type,onChange:e=>F(a,"type",e.target.value),className:"form-control schedule-select"},L.map((e=>r.createElement("option",{key:e.value,value:e.value},e.label)))),r.createElement("button",{type:"button",onClick:()=>(e=>{j((a=>E(E({},a),{},{dailySchedules:a.dailySchedules.filter(((a,t)=>t!==e))})));const a=C.dailySchedules.filter(((a,t)=>t!==e));if(a.length>0){const e=a.map((e=>e.date)).sort();j((a=>E(E({},a),{},{startDate:e[0],endDate:e[e.length-1]})))}})(a),className:"btn btn-sm btn-danger",title:"Remove this day"},r.createElement(o.A,{size:14}))))))),U.dailySchedules&&r.createElement("div",{className:"error-text"},U.dailySchedules)),C.dailySchedules.length>0&&r.createElement("div",{className:"form-section"},r.createElement("div",{className:"request-summary-card"},r.createElement("div",{className:"summary-header"},r.createElement("h4",null,"Request Summary"),r.createElement("div",{className:"summary-status"},r.createElement(d.A,{size:16}),"Ready to Submit")),r.createElement("div",{className:"summary-content"},r.createElement("div",{className:"summary-metrics"},r.createElement("div",{className:"metric-item"},r.createElement("div",{className:"metric-value"},z.totalDays),r.createElement("div",{className:"metric-label"},"Days Off")),r.createElement("div",{className:"metric-item"},r.createElement("div",{className:"metric-value"},z.totalHours,"h"),r.createElement("div",{className:"metric-label"},"Total Hours")),r.createElement("div",{className:"metric-item"},r.createElement("div",{className:"metric-value"},z.workingDays),r.createElement("div",{className:"metric-label"},"Scheduled Days"))),r.createElement("div",{className:"summary-details"},r.createElement("div",{className:"detail-row"},r.createElement("span",{className:"detail-label"},r.createElement(u.A,{size:16}),"Date Range:"),r.createElement("span",{className:"detail-value"},z.dateRange)),r.createElement("div",{className:"detail-row"},r.createElement("span",{className:"detail-label"},r.createElement(c.A,{size:16}),_?"Employee:":"Approver:"),r.createElement("span",{className:"detail-value"},_?(null===(f=C.targetUser)||void 0===f?void 0:f.displayName)||"Not selected":(null===(b=C.manager)||void 0===b?void 0:b.displayName)||"Not selected")),Object.keys(z.leaveTypeBreakdown).length>0&&r.createElement("div",{className:"detail-row"},r.createElement("span",{className:"detail-label"},r.createElement(l.A,{size:16}),"Leave Types:"),r.createElement("div",{className:"leave-type-tags"},Object.entries(z.leaveTypeBreakdown).map((e=>{let[a,t]=e;return r.createElement("span",{key:a,className:"leave-type-tag"},(0,v.S0)(a)," ",a,": ",t," day",1!==t?"s":"")})))))))),U.duplicate&&r.createElement("div",{className:"alert alert-error"},r.createElement(s.A,{size:20}),r.createElement("div",null,r.createElement("strong",null,"Scheduling Conflict"),r.createElement("p",null,U.duplicate))),r.createElement("div",{className:"form-actions"},r.createElement("button",{type:"button",onClick:N,className:"btn btn-secondary"},"Cancel"),r.createElement("button",{type:"button",onClick:()=>{var e;if(!(()=>{var e,a;const t={};C.targetUser||(t.targetUser="User is required"),C.manager||(t.manager="Manager is required"),C.startDate||(t.startDate="Start date is required"),C.endDate||(t.endDate="End date is required"),C.startDate&&C.endDate&&new Date(C.startDate)>new Date(C.endDate)&&(t.endDate="End date must be after start date"),0===C.dailySchedules.length&&(t.dailySchedules="Please select at least one day");const r=(null===(e=C.targetUser)||void 0===e?void 0:e.accountId)||(null===(a=C.targetUser)||void 0===a?void 0:a.jira_account_id);if(r){const e=C.dailySchedules.filter((e=>A.some((a=>{var t;return(a.requester_id===r||a.requester_email===(null===(t=C.targetUser)||void 0===t?void 0:t.emailAddress))&&"declined"!==a.status&&a.start_date<=e.date&&a.end_date>=e.date}))));e.length>0&&(t.duplicate="This user already has PTO requests for: ".concat(e.map((e=>new Date(e.date).toLocaleDateString())).join(", ")))}return q(t),0===Object.keys(t).length})())return;const a=(t=C.targetUser)?E(E({},t),{},{accountId:t.accountId||t.jira_account_id||t.id,displayName:t.displayName||t.display_name||t.name,emailAddress:t.emailAddress||t.email_address,avatarUrl:t.avatarUrl||t.avatar_url}):null;var t;if(!(a&&a.accountId&&a.displayName&&a.emailAddress))return void q((e=>E(E({},e),{},{targetUser:"Please select a valid user."})));const r=C.dailySchedules.reduce(((e,a)=>e+("FULL_DAY"===a.type?1:.5)),0),l=C.dailySchedules.reduce(((e,a)=>e+("FULL_DAY"===a.type?8:4)),0),n=E({reporter:a,manager:(s=C.manager,s?E(E({},s),{},{accountId:s.accountId||s.jira_account_id||s.id,displayName:s.displayName||s.display_name||s.name,emailAddress:s.emailAddress||s.email_address,avatarUrl:s.avatarUrl||s.avatar_url}):null),startDate:C.startDate,endDate:C.endDate,leaveType:(null===(e=C.dailySchedules[0])||void 0===e?void 0:e.leaveType)||"vacation",reason:C.reason,dailySchedules:C.dailySchedules,totalDays:r,totalHours:l},_&&{targetUser:a});var s;D(n)},disabled:!C.targetUser||!C.manager||!C.startDate||!C.endDate||0===C.dailySchedules.length||!!U.duplicate||I,className:"btn btn-primary"},_?"Create PTO Request":"Submit Request")),_&&r.createElement("div",{className:"admin-notice"},r.createElement("strong",null,"Admin Mode:")," This PTO request will be created with admin privileges and may be automatically approved."),0===C.dailySchedules.length&&r.createElement("div",{className:"instructions"},r.createElement("strong",null,"Next Step:")," Select start and end dates to configure your PTO schedule, or return to the calendar to select specific dates."))))}},5143:(e,a,t)=>{t.d(a,{A:()=>i});var r=t(6540),l=t(8686),n=t(8697),s=t(8445);function c(e,a){let t;return function(){for(var r=arguments.length,l=new Array(r),n=0;n<r;n++)l[n]=arguments[n];clearTimeout(t),t=setTimeout((()=>{clearTimeout(t),e(...l)}),a)}}const i=e=>{var a;let{selectedUser:i,onSelect:m,placeholder:o="Search for a user",disabled:d=!1,required:u=!1,error:p=null,allUsers:v=[],filterBy:g="all",useBackendSearch:y=!1}=e;const[E,f]=(0,r.useState)(!1),[b,h]=(0,r.useState)(""),[N,D]=(0,r.useState)([]),[w,k]=(0,r.useState)(!1),[S,T]=(0,r.useState)(null),O=(0,r.useRef)(null),A=(0,r.useRef)(null),_=(0,r.useCallback)(c((async e=>{if(e.length<1)D([]);else{k(!0),T(null);try{const{invoke:a}=await Promise.resolve().then(t.t.bind(t,2321,23)),r=await a("searchDatabaseUsers",{query:e,filterBy:g,startAt:0,maxResults:50});if(!r.success||!r.data)throw new Error(r.message||"Failed to search users");D(r.data.users||[])}catch(e){console.error("❌ Error searching users:",e),T(e.message),D([])}finally{k(!1)}}}),300),[g]),P=(0,r.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=[...v];if("withTeam"===g?a=a.filter((e=>(e.team_ids||[]).length>0)):"withoutTeam"===g&&(a=a.filter((e=>!(e.team_ids&&e.team_ids.length>0)))),e.length>=1){const t=e.toLowerCase();a=a.filter((e=>{const a=(e.display_name||e.displayName||"").toLowerCase(),r=(e.email_address||e.emailAddress||"").toLowerCase(),l=(e.first_name||e.firstName||"").toLowerCase(),n=(e.last_name||e.lastName||"").toLowerCase();return a.includes(t)||r.includes(t)||l.includes(t)||n.includes(t)}))}a.sort(((e,a)=>{const t=(e.display_name||e.displayName||"").toLowerCase(),r=(a.display_name||a.displayName||"").toLowerCase();return t.localeCompare(r)})),D(a.slice(0,50))}),[v,g]);(0,r.useEffect)((()=>{y||P(b)}),[P,b,y]);(0,r.useEffect)((()=>{const e=e=>{O.current&&!O.current.contains(e.target)&&(f(!1),h(""),y||D([]))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[y]),(0,r.useEffect)((()=>{const e=e=>{"Escape"===e.key&&E&&(f(!1),h(""),y||D([]))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[E,y]);const C=e=>e.team_name||"",j=(0,r.useCallback)(c((async e=>{if(e)try{let a;a=y?await invoke("searchDatabaseUsers",{query:e,filterBy:g,startAt:0,maxResults:50}):await invoke("getInternalJiraUsers",{startAt:0,maxResults:50}),a.success?D(a.data.users||[]):D([])}catch(e){console.error("Error searching users:",e),D([])}else D([])}),300),[y,g]);return(0,r.useEffect)((()=>{b?j(b):D([])}),[b,j]),r.createElement("div",{className:"user-picker-container",ref:O},r.createElement("div",{onClick:()=>{d||(f(!0),setTimeout((()=>{var e;null===(e=A.current)||void 0===e||e.focus()}),100))},className:"user-picker-input ".concat(d?"user-picker-input-disabled":""," ").concat(E?"user-picker-input-focused":""," ").concat(p?"user-picker-input-error":"")},i?r.createElement("div",{className:"user-picker-selected"},r.createElement("div",{className:"user-picker-avatar"},i.avatarUrl||i.avatar_url?r.createElement("img",{src:i.avatarUrl||i.avatar_url,alt:i.displayName||i.display_name,className:"user-picker-avatar-img"}):r.createElement("span",{className:"user-picker-avatar-text"},(null===(a=i.displayName||i.display_name)||void 0===a?void 0:a.charAt(0))||r.createElement(l.A,{size:16}))),r.createElement("div",{className:"user-picker-user-info"},r.createElement("div",{className:"user-picker-user-name"},i.displayName||i.display_name),r.createElement("div",{className:"user-picker-user-email"},i.emailAddress||i.email_address)),!d&&r.createElement("button",{onClick:e=>{e.stopPropagation(),m(null)},className:"user-picker-clear-btn",type:"button"},r.createElement(n.A,{size:16}))):r.createElement("div",{className:"user-picker-placeholder"},r.createElement(s.A,{size:16}),r.createElement("span",null,o),u&&r.createElement("span",{className:"user-picker-required"},"*"))),p&&r.createElement("div",{className:"user-picker-error"},p),E&&r.createElement("div",{className:"user-picker-dropdown"},r.createElement("div",{className:"user-picker-search-container"},r.createElement("div",{className:"user-picker-search-input-wrapper"},r.createElement(s.A,{size:16,className:"user-picker-search-icon"}),r.createElement("input",{ref:A,type:"text",value:b,onChange:e=>{const a=e.target.value;h(a),y?_(a):P(a)},placeholder:"Type to search users...",className:"user-picker-search-input"}))),r.createElement("div",{className:"user-picker-results"},w?r.createElement("div",{className:"user-picker-loading"},r.createElement("div",{className:"user-picker-loading-spinner"}),r.createElement("div",{className:"user-picker-loading-text"},"Searching...")):S?r.createElement("div",{className:"user-picker-empty"},r.createElement("div",{className:"user-picker-empty-text"},"Error: ",S)):0!==v.length||y?b.length>=1&&0===N.length?r.createElement("div",{className:"user-picker-empty"},r.createElement("div",{className:"user-picker-empty-text"},"No users found")):b.length<1?r.createElement("div",{className:"user-picker-empty"},r.createElement("div",{className:"user-picker-empty-text"},"Type to search users...")):r.createElement("div",{className:"user-picker-user-list"},N.map((e=>{var a;return r.createElement("div",{key:e.id,onClick:()=>(e=>{m(e),f(!1),h(""),D([])})(e),className:"user-picker-user-option"},r.createElement("div",{className:"user-picker-avatar"},e.avatarUrl||e.avatar_url?r.createElement("img",{src:e.avatarUrl||e.avatar_url,alt:e.displayName||e.display_name,className:"user-picker-avatar-img"}):r.createElement("span",{className:"user-picker-avatar-text"},(null===(a=e.displayName||e.display_name)||void 0===a?void 0:a.charAt(0))||r.createElement(l.A,{size:16}))),r.createElement("div",{className:"user-picker-option-info"},r.createElement("div",{className:"user-picker-option-name"},e.displayName||e.display_name),r.createElement("div",{className:"user-picker-option-email"},e.emailAddress||e.email_address),C(e)&&r.createElement("div",{className:"user-picker-option-team"},"Team: ",C(e))))})),50===N.length&&r.createElement("div",{className:"user-picker-more-results"},"Showing first 50 results. Narrow your search for more specific results.")):r.createElement("div",{className:"user-picker-empty"},r.createElement("div",{className:"user-picker-empty-text"},"No users available")))))}},5839:(e,a,t)=>{t.d(a,{A:()=>y});var r=t(6540),l=t(2321),n=t(5143),s=t(8309),c=t(1999),i=t(5977),m=t(8686),o=t(7677),d=t(4809),u=t.n(d);function p(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?p(Object(t),!0).forEach((function(a){g(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function g(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const y=function(e){let{isOpen:a,onClose:t,teams:d,users:p,onSaveTeam:g,onDeleteTeam:y,onSaveUser:E,onDeleteUser:f,showNotification:b,onRefresh:h}=e;const[N,D]=(0,r.useState)("teams"),[w,k]=(0,r.useState)("list"),[S,T]=(0,r.useState)(null),[O,A]=(0,r.useState)(null),[_,P]=(0,r.useState)(!1),[C,j]=(0,r.useState)([]),[U,q]=(0,r.useState)(!1),[I,R]=(0,r.useState)({startAt:0,maxResults:50,total:0,isLast:!0}),[x,F]=(0,r.useState)([]),[L,M]=(0,r.useState)(!1),[z,B]=(0,r.useState)({name:"",description:"",manager:null,department:"",color:"#667eea"}),[W,V]=(0,r.useState)({firstName:"",lastName:"",displayName:"",emailAddress:"",jiraAccountId:"",employmentType:"full-time",hireDate:"",teamMemberships:[],capacity:40}),[Y,G]=(0,r.useState)([{dayOfWeek:1,dayName:"Monday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:2,dayName:"Tuesday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:3,dayName:"Wednesday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:4,dayName:"Thursday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:5,dayName:"Friday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:6,dayName:"Saturday",isWorkingDay:!1,startTime:"",endTime:"",hoursPerDay:0},{dayOfWeek:7,dayName:"Sunday",isWorkingDay:!1,startTime:"",endTime:"",hoursPerDay:0}]),[H,J]=(0,r.useState)({}),[K,$]=(0,r.useState)("Member");(0,r.useEffect)((()=>{"users"===N&&"import"===w&&Q(0)}),[N,w]);const Q=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;0===e&&(q(!0),j([]));try{const a=await(0,l.invoke)("getInternalJiraUsers",{startAt:e,maxResults:50});if(!a.success||!a.data)throw new Error(a.message||"Failed to load Jira users");{const{users:t,total:r,isLast:l}=a.data;if(j((e=>[...e,...t||[]])),R({startAt:e,maxResults:50,total:r||0,isLast:!1!==l}),!l){const a=e+50;await Q(a)}}}catch(a){0===e&&(b("Failed to load Jira users: "+a.message,"error"),j([]))}finally{(0===e||U)&&q(!1)}},X=()=>{B({name:"",description:"",manager:null,department:"",color:"#667eea"}),J({}),T(null)},Z=()=>{V({firstName:"",lastName:"",displayName:"",emailAddress:"",jiraAccountId:"",employmentType:"full-time",hireDate:"",teamMemberships:[],capacity:40}),G([{dayOfWeek:1,dayName:"Monday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:2,dayName:"Tuesday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:3,dayName:"Wednesday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:4,dayName:"Thursday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:5,dayName:"Friday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:6,dayName:"Saturday",isWorkingDay:!1,startTime:"",endTime:"",hoursPerDay:0},{dayOfWeek:7,dayName:"Sunday",isWorkingDay:!1,startTime:"",endTime:"",hoursPerDay:0}]),J({}),A(null)};(0,r.useEffect)((()=>{(W.firstName||W.lastName)&&V((e=>v(v({},e),{},{displayName:"".concat(W.firstName," ").concat(W.lastName).trim()})))}),[W.firstName,W.lastName]),(0,r.useEffect)((()=>{const e=Y.reduce(((e,a)=>e+(a.isWorkingDay?a.hoursPerDay:0)),0);V((a=>v(v({},a),{},{capacity:e})))}),[Y]);const ee=(e,a)=>{B((t=>v(v({},t),{},{[e]:a}))),H[e]&&J((a=>v(v({},a),{},{[e]:null})))},ae=(e,a)=>{V((t=>v(v({},t),{},{[e]:a}))),H[e]&&J((a=>v(v({},a),{},{[e]:null})))},te=(e,a,t)=>{G((r=>{const l=[...r];if(l[e]=v(v({},l[e]),{},{[a]:t}),"startTime"===a||"endTime"===a){const a=l[e];if(a.startTime&&a.endTime&&a.isWorkingDay){const t=new Date("2000-01-01T".concat(a.startTime)),r=(new Date("2000-01-01T".concat(a.endTime))-t)/36e5;l[e].hoursPerDay=Math.max(0,r)}}return"isWorkingDay"!==a||t||(l[e].startTime="",l[e].endTime="",l[e].hoursPerDay=0),l}))},[re,le]=(0,r.useState)([]),[ne,se]=(0,r.useState)(!1),[ce,ie]=(0,r.useState)(""),me=e=>p.some((a=>(a.team_memberships||[]).some((a=>a.team_id===e&&"Manager"===a.role)))),oe=["type","id","name","jira_account_id","first_name","last_name","display_name","email","employment_type","hire_date","team_memberships","capacity","department","description","color","manager","isAdmin"];if(!a)return null;const de=(()=>{const e=new Set;return p.forEach((a=>{a.jira_account_id&&e.add(a.jira_account_id),a.accountId&&e.add(a.accountId),a.email_address&&e.add(a.email_address.toLowerCase()),a.emailAddress&&e.add(a.emailAddress.toLowerCase())})),C.filter((a=>{var t;if(!1===a.active)return!1;const r=a.accountId,l=null===(t=a.emailAddress)||void 0===t?void 0:t.toLowerCase();return!(e.has(r)||l&&e.has(l))}))})();return r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content team-management-modal"},r.createElement("div",{className:"modal-header"},r.createElement("h3",null,"Team & User Management"),r.createElement("div",{className:"header-actions"},r.createElement("button",{className:"btn btn-secondary",onClick:()=>{const e=[...d.map((e=>({type:"team",id:e.id,name:e.name,jira_account_id:"",first_name:"",last_name:"",display_name:"",email:"",employment_type:"",hire_date:"",team_memberships:"",capacity:"",department:e.department||"",description:e.description||"",color:e.color||"",manager:e.manager||"",isAdmin:""}))),...p.map((e=>({type:"user",id:e.id,name:e.name||e.display_name||"",jira_account_id:e.jira_account_id||"",first_name:e.first_name||"",last_name:e.last_name||"",display_name:e.display_name||"",email:e.email_address||"",employment_type:e.employment_type||"",hire_date:e.hire_date||"",team_memberships:(e.team_memberships||[]).map((e=>{var a;return"".concat((null===(a=d.find((a=>a.id===e.team_id)))||void 0===a?void 0:a.name)||e.team_id,":").concat(e.role)})).join(","),capacity:e.capacity||"",department:e.department||"",description:"",color:"",manager:"",isAdmin:!0===e.isAdmin?"TRUE":"FALSE"})))],a=u().unparse(e,{columns:oe}),t=new Blob([a],{type:"text/csv"}),r=URL.createObjectURL(t),l=document.createElement("a");l.href=r,l.download="teams-and-users-".concat((new Date).toISOString().split("T")[0],".csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r)},disabled:_},r.createElement(s.A,{size:16})," Export CSV"),r.createElement("label",{className:"btn btn-secondary",style:{marginLeft:8}},r.createElement("input",{type:"file",accept:".csv",onChange:async e=>{const a=e.target.files[0];a&&u().parse(a,{header:!0,skipEmptyLines:!0,complete:async a=>{P(!0);try{const e=[],t=[];for(const r of a.data)if("team"===r.type)e.push({id:r.id||(window.crypto&&window.crypto.randomUUID?window.crypto.randomUUID():"team-"+Date.now()+"-"+Math.floor(1e4*Math.random())),name:r.name,department:r.department,description:r.description,color:r.color,manager:r.manager});else if("user"===r.type){let e=[];r.team_memberships&&(e=r.team_memberships.split(",").map((e=>{const[a,t]=e.split(":"),r=d.find((e=>e.name===a.trim()));return{team_id:r?r.id:a.trim(),role:(t||"Member").trim()}}))),t.push({id:r.id,name:r.name,jira_account_id:r.jira_account_id,displayName:r.display_name,first_name:r.first_name,last_name:r.last_name,emailAddress:r.email,department:r.department,hireDate:r.hire_date,employmentType:r.employment_type,team_memberships:e,capacity:r.capacity,isAdmin:"TRUE"===r.isAdmin||"true"===r.isAdmin})}const r=await(0,l.invoke)("getTeams"),n=r.success?r.data:[];for(const a of e){n.find((e=>e.id===a.id))?await(0,l.invoke)("updateTeam",a):await(0,l.invoke)("createTeam",a)}for(const e of t)await E(e);b("CSV import completed successfully"),h&&h()}catch(e){b("Failed to import CSV: "+e.message,"error")}finally{P(!1),e.target.value=""}}})},style:{display:"none"},disabled:_}),r.createElement(c.A,{size:16})," Import CSV"),r.createElement("button",{className:"modal-close",onClick:t},"×"))),r.createElement("div",{className:"modal-body"},r.createElement("div",{className:"team-management-main-tabs"},r.createElement("button",{className:"team-management-main-tab ".concat("teams"===N?"team-management-main-tab-active":""),onClick:()=>{D("teams"),k("list"),X(),Z()}},"👥 Teams (",d.length,")"),r.createElement("button",{className:"team-management-main-tab ".concat("users"===N?"team-management-main-tab-active":""),onClick:()=>{D("users"),k("list"),X(),Z()}},"👤 Users (",p.length,")")),"teams"===N&&r.createElement(r.Fragment,null,r.createElement("div",{className:"team-management-sub-tabs"},r.createElement("button",{className:"team-management-sub-tab ".concat("list"===w?"team-management-sub-tab-active":""),onClick:()=>k("list")},"Teams List"),r.createElement("button",{className:"team-management-sub-tab ".concat("form"===w?"team-management-sub-tab-active":""),onClick:()=>{k("form"),X()}},S?"Edit Team":"Add New Team")),"list"===w&&r.createElement("div",{className:"team-management-teams-section"},0===d.length?r.createElement("div",{className:"team-management-empty-state"},r.createElement("div",{className:"team-management-empty-icon"},"👥"),r.createElement("h4",null,"No Teams Created"),r.createElement("p",null,"Create your first team to organize your resources"),r.createElement("button",{className:"btn btn-primary",onClick:()=>{X(),k("form")}},"Create First Team")):r.createElement("div",{className:"team-management-teams-grid"},d.map((e=>{var a,t;const l=(n=e.id,p.filter((e=>(e.team_memberships||[]).some((e=>e.team_id===n)))));var n;return r.createElement("div",{key:e.id,className:"team-management-team-card",style:{borderLeftColor:e.color}},r.createElement("div",{className:"team-management-team-header"},r.createElement("h4",null,e.name),r.createElement("div",{className:"team-management-team-actions"},r.createElement("button",{className:"btn btn-sm btn-secondary",onClick:()=>(e=>{T(e);let a=null;e.manager&&("string"==typeof e.manager?a=p.find((a=>a.display_name===e.manager||a.displayName===e.manager||a.name===e.manager))||null:"object"==typeof e.manager&&(a=e.manager)),B({name:e.name||"",description:e.description||"",manager:a,department:e.department||"",color:e.color||"#667eea"}),k("form")})(e),disabled:_},"Edit"),r.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>(async(e,a)=>{if(window.confirm('Are you sure you want to delete the team "'.concat(a,'"? This action cannot be undone.'))){P(!0);try{await y(e),b("Team deleted successfully"),h&&h()}catch(e){b("Failed to delete team","error")}finally{P(!1)}}})(e.id,e.name),disabled:_},"Delete"))),e.description&&r.createElement("p",{className:"team-management-team-description"},e.description),r.createElement("div",{className:"team-management-team-meta"},e.department&&r.createElement("span",{className:"team-management-team-department"},"📁 ",e.department),(e.manager||(null===(a=e.manager)||void 0===a?void 0:a.displayName))&&r.createElement("span",{className:"team-management-team-lead"},"👤 ",null===(t=e.manager)||void 0===t?void 0:t.displayName),r.createElement("span",{className:"team-management-member-count"},l.length," members")),l.length>0&&r.createElement("div",{className:"team-management-team-members-preview"},r.createElement("h5",null,"Members:"),r.createElement("div",{className:"team-management-members-list"},l.slice(0,3).map((e=>{var a;return r.createElement("div",{key:e.id,className:"team-management-member-preview"},r.createElement("div",{className:"team-management-member-avatar-small"},e.avatar_url||e.avatarUrl?r.createElement("img",{src:e.avatar_url||e.avatarUrl,alt:e.display_name||e.displayName}):r.createElement("div",{className:"team-management-avatar-placeholder-small"},(null===(a=e.display_name||e.displayName||e.name)||void 0===a?void 0:a.charAt(0))||"?")),r.createElement("span",{className:"team-management-member-name-small"},e.display_name||e.displayName||e.name))})),l.length>3&&r.createElement("div",{className:"team-management-more-members"},"+",l.length-3," more"))))})))),"form"===w&&r.createElement("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return z.name.trim()||(e.name="Team name is required"),J(e),0===Object.keys(e).length})()){P(!0);try{const e={id:null==S?void 0:S.id,name:z.name,description:z.description,manager:z.manager,department:z.department,color:z.color,members:(null==S?void 0:S.members)||[]};console.log("Submitting team:",e),await g(e),b(S?"Team updated successfully":"Team created successfully"),X(),k("list"),h&&h()}catch(e){b("Failed to save team","error")}finally{P(!1)}}},className:"team-management-team-form"},r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"team-name"},"Team Name *"),r.createElement("input",{type:"text",id:"team-name",className:"form-control ".concat(H.name?"form-control-error":""),value:z.name,onChange:e=>ee("name",e.target.value),placeholder:"Enter team name",disabled:_}),H.name&&r.createElement("span",{className:"form-error-text"},H.name)),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"team-description"},"Description"),r.createElement("textarea",{id:"team-description",className:"form-control",value:z.description,onChange:e=>ee("description",e.target.value),placeholder:"Brief description of the team's purpose",rows:"3",disabled:_})),r.createElement("div",{className:"form-row"},r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"team-manager"},"Manager"),r.createElement(n.A,{selectedUser:z.manager,onSelect:async e=>{B((a=>v(v({},a),{},{manager:e})))},placeholder:"Search and select manager",disabled:_,error:H.manager,useBackendSearch:!0}),H.manager&&r.createElement("span",{className:"form-error-text"},H.manager)),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"department"},"Department"),r.createElement("select",{id:"department",className:"form-control",value:z.department,onChange:e=>ee("department",e.target.value),disabled:_},r.createElement("option",{value:""},"Select Department"),["Product","Devops","RebelCare","Strategy","Service Delivery","Client Services","Sales","Marketing","Operations","Finance","HR"].map((e=>r.createElement("option",{key:e,value:e},e)))))),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Team Color"),r.createElement("div",{className:"team-management-color-options"},["#667eea","#764ba2","#f093fb","#f5576c","#4facfe","#00f2fe","#43e97b","#38f9d7","#ffecd2","#fcb69f"].map((e=>r.createElement("div",{key:e,className:"team-management-color-option ".concat(z.color===e?"team-management-color-option-selected":""),style:{backgroundColor:e},onClick:()=>!_&&ee("color",e)}))))),r.createElement("div",{className:"form-actions"},r.createElement("button",{type:"submit",className:"btn btn-primary",disabled:_},_?"Saving...":S?"Update Team":"Create Team"),r.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>{X(),k("list")},disabled:_},"Cancel")))),"users"===N&&r.createElement(r.Fragment,null,r.createElement("div",{className:"team-management-sub-tabs"},r.createElement("button",{className:"team-management-sub-tab ".concat("list"===w?"team-management-sub-tab-active":""),onClick:()=>k("list")},"Users List"),r.createElement("button",{className:"team-management-sub-tab ".concat("form"===w?"team-management-sub-tab-active":""),onClick:()=>{k("form"),Z()}},O?"Edit User":"Add New User"),r.createElement("button",{className:"team-management-sub-tab ".concat("import"===w?"team-management-sub-tab-active":""),onClick:()=>k("import")},"Import from Jira (",de.length,")")),"list"===w&&r.createElement("div",{className:"team-management-users-section"},r.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}},r.createElement("h4",null,"Users"),r.createElement("button",{className:"btn btn-primary",disabled:re.length===p.length&&p.length>0,onClick:()=>se(!0)},"Bulk Add to Team")),re.length>0&&r.createElement("button",{className:"btn btn-danger",onClick:async()=>{if(window.confirm("Are you sure you want to delete ".concat(re.length," users? This action cannot be undone."))){P(!0);try{for(const e of re)await f(e);b("".concat(re.length," users deleted successfully")),le([]),h&&h()}catch(e){b("Failed to delete users: "+e.message,"error")}finally{P(!1)}}},disabled:_,style:{marginBottom:16}},"Delete Selected Users (",re.length,")"),r.createElement("table",{className:"user-table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,r.createElement("input",{type:"checkbox",checked:re.length===p.length&&p.length>0,onChange:e=>le(e.target.checked?p.map((e=>e.id)):[])})),r.createElement("th",null,"Name"),r.createElement("th",null,"Email"),r.createElement("th",null,"Teams"),r.createElement("th",null,"Actions"))),r.createElement("tbody",null,p.map((e=>r.createElement("tr",{key:e.id},r.createElement("td",null,r.createElement("input",{type:"checkbox",checked:re.includes(e.id),onChange:a=>le(a.target.checked?[...re,e.id]:re.filter((a=>a!==e.id)))})),r.createElement("td",null,e.display_name||e.displayName||e.name),r.createElement("td",null,e.email_address||e.emailAddress||"-"),r.createElement("td",null,(e.team_memberships||[]).map((e=>{const a=d.find((a=>a.id===e.team_id));return a?"".concat(a.name," (").concat(e.role,")"):e.team_id})).join(", ")),r.createElement("td",null,r.createElement("button",{className:"btn btn-sm btn-secondary",onClick:()=>(e=>{A(e),V({firstName:e.first_name||e.firstName||"",lastName:e.last_name||e.lastName||"",displayName:e.display_name||e.displayName||"",emailAddress:e.email_address||e.emailAddress||"",jiraAccountId:e.jira_account_id||e.accountId||"",employmentType:e.employment_type||e.employmentType||"full-time",hireDate:e.hire_date||e.hireDate||"",teamMemberships:e.team_memberships||[],capacity:e.capacity||40,isAdmin:!0===e.isAdmin}),e.availability&&Array.isArray(e.availability)&&G(e.availability),D("users"),k("form")})(e),disabled:_},"Edit"),r.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>(async(e,a)=>{if(window.confirm('Are you sure you want to delete the user "'.concat(a,'"? This action cannot be undone.'))){P(!0);try{await f(e),b("User deleted successfully"),h&&h()}catch(e){b("Failed to delete user","error")}finally{P(!1)}}})(e.id,e.display_name||e.displayName||e.name),disabled:_},"Delete"))))))),ne&&r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content",style:{maxWidth:400,margin:"auto",padding:24}},r.createElement("h4",null,"Add Selected Users to Team"),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Team"),r.createElement("select",{className:"form-control",value:ce,onChange:e=>{ie(e.target.value),me(e.target.value)&&$("Member")}},r.createElement("option",{value:""},"Select a team"),d.map((e=>r.createElement("option",{key:e.id,value:e.id},e.name))))),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Role"),r.createElement("select",{className:"form-control",value:K,onChange:e=>$(e.target.value),disabled:ce&&me(ce)},r.createElement("option",{value:"Member"},"Member"),r.createElement("option",{value:"Manager",disabled:ce&&me(ce)},"Manager ",ce&&me(ce)?"(Team already has a manager)":""))),r.createElement("div",{className:"form-actions",style:{marginTop:24}},r.createElement("button",{className:"btn btn-secondary",onClick:()=>se(!1)},"Cancel"),r.createElement("button",{className:"btn btn-primary",disabled:!ce,onClick:async()=>{P(!0);for(const e of re){const a=p.find((a=>a.id===e));a&&!(a.team_memberships||[]).some((e=>e.team_id===ce))&&await E(v(v({},a),{},{team_memberships:[...a.team_memberships||[],{team_id:ce,role:K}]}))}P(!1),se(!1),le([]),ie(""),$("Member"),h&&h()}},"Add to Team"))))),"form"===w&&r.createElement("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return W.firstName.trim()||(e.firstName="First name is required"),W.lastName.trim()||(e.lastName="Last name is required"),J(e),0===Object.keys(e).length})()){P(!0);try{const e=!0===(null==O?void 0:O.isAdmin),r=!0===W.isAdmin,n={id:null==O?void 0:O.id,first_name:W.firstName,last_name:W.lastName,display_name:W.displayName,email_address:W.emailAddress,jira_account_id:W.jiraAccountId,employment_type:W.employmentType,hire_date:W.hireDate,team_memberships:W.teamMemberships,capacity:W.capacity,availability:Y,isAdmin:r};var a;if(console.log("Submitting user:",n),await E(n),r&&!e)await(0,l.invoke)("addAdminUser",{accountId:n.jira_account_id||n.id||n.accountId,addedBy:null===(a=currentUser)||void 0===a?void 0:a.accountId});else if(!r&&e){var t;await(0,l.invoke)("removeAdminUser",{accountId:n.jira_account_id||n.id||n.accountId,removedBy:null===(t=currentUser)||void 0===t?void 0:t.accountId})}b(O?"User updated successfully":"User created successfully"),Z(),k("list"),h&&h()}catch(e){b("Failed to save user","error")}finally{P(!1)}}},className:"team-management-user-form"},r.createElement("div",{className:"form-row"},r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"firstName"},"First Name *"),r.createElement("input",{type:"text",id:"firstName",className:"form-control ".concat(H.firstName?"form-control-error":""),value:W.firstName,onChange:e=>ae("firstName",e.target.value),placeholder:"Enter first name",disabled:_}),H.firstName&&r.createElement("span",{className:"form-error-text"},H.firstName)),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"lastName"},"Last Name *"),r.createElement("input",{type:"text",id:"lastName",className:"form-control ".concat(H.lastName?"form-control-error":""),value:W.lastName,onChange:e=>ae("lastName",e.target.value),placeholder:"Enter last name",disabled:_}),H.lastName&&r.createElement("span",{className:"form-error-text"},H.lastName))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"emailAddress"},"Email Address"),r.createElement("input",{type:"email",id:"emailAddress",className:"form-control ".concat(H.emailAddress?"form-control-error":""),value:W.emailAddress,onChange:e=>ae("emailAddress",e.target.value),placeholder:"Enter email address",disabled:_}),H.emailAddress&&r.createElement("span",{className:"form-error-text"},H.emailAddress)),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"displayName"},"Display Name"),r.createElement("input",{type:"text",id:"displayName",className:"form-control",value:W.displayName,onChange:e=>ae("displayName",e.target.value),placeholder:"Display name (auto-generated from first/last name)",disabled:_})),r.createElement("div",{className:"form-row"},r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"employmentType"},"Employment Type"),r.createElement("select",{id:"employmentType",className:"form-control",value:W.employmentType,onChange:e=>ae("employmentType",e.target.value),disabled:_},r.createElement("option",{value:"full-time"},"Full-time"),r.createElement("option",{value:"part-time"},"Part-time"),r.createElement("option",{value:"contractor"},"Contractor"))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"hireDate"},"Hire Date"),r.createElement("input",{type:"date",id:"hireDate",className:"form-control",value:W.hireDate,onChange:e=>ae("hireDate",e.target.value),disabled:_}))),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Teams & Roles"),d.map((e=>{const a=W.teamMemberships.find((a=>a.team_id===e.id)),t=me(e.id);return r.createElement("div",{key:e.id,style:{display:"flex",alignItems:"center",marginBottom:8}},r.createElement("input",{type:"checkbox",checked:!!a,onChange:a=>{a.target.checked?V((a=>v(v({},a),{},{teamMemberships:[...a.teamMemberships,{team_id:e.id,role:t?"Member":"Manager"}]}))):V((a=>v(v({},a),{},{teamMemberships:a.teamMemberships.filter((a=>a.team_id!==e.id))})))},disabled:_}),r.createElement("span",{style:{marginLeft:8,marginRight:8}},e.name),a&&r.createElement("select",{value:a.role,onChange:a=>{"Manager"===a.target.value&&t?b("This team already has a manager","error"):V((t=>v(v({},t),{},{teamMemberships:t.teamMemberships.map((t=>t.team_id===e.id?v(v({},t),{},{role:a.target.value}):t))})))},style:{marginLeft:8},disabled:_||t&&"Manager"!==a.role},r.createElement("option",{value:"Member"},"Member"),r.createElement("option",{value:"Manager",disabled:t},"Manager ",t?"(Team already has a manager)":"")))}))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"jiraAccountId"},"Jira Account ID"),r.createElement("input",{type:"text",id:"jiraAccountId",className:"form-control",value:W.jiraAccountId,onChange:e=>ae("jiraAccountId",e.target.value),placeholder:"Optional: Link to Jira account",disabled:_})),r.createElement("div",{className:"form-group"},r.createElement("label",null,r.createElement("input",{type:"checkbox",checked:!0===W.isAdmin,onChange:e=>V((a=>v(v({},a),{},{isAdmin:e.target.checked}))),disabled:_})," ","Admin User")),r.createElement("div",{className:"team-management-availability-section"},r.createElement("h4",null,"Working Schedule"),r.createElement("p",{className:"team-management-help-text"},"Set the default working hours for this team member."),r.createElement("div",{className:"team-management-availability-grid"},Y.map(((e,a)=>r.createElement("div",{key:e.dayOfWeek,className:"team-management-availability-day"},r.createElement("div",{className:"team-management-day-header"},r.createElement("label",{className:"team-management-checkbox-label"},r.createElement("input",{type:"checkbox",checked:e.isWorkingDay,onChange:e=>te(a,"isWorkingDay",e.target.checked),disabled:_}),r.createElement("span",{className:"team-management-day-name"},e.dayName))),e.isWorkingDay&&r.createElement("div",{className:"team-management-day-details"},r.createElement("div",{className:"team-management-time-inputs"},r.createElement("input",{type:"time",value:e.startTime,onChange:e=>te(a,"startTime",e.target.value),className:"form-control team-management-input-small",disabled:_}),r.createElement("span",null,"to"),r.createElement("input",{type:"time",value:e.endTime,onChange:e=>te(a,"endTime",e.target.value),className:"form-control team-management-input-small",disabled:_})),r.createElement("div",{className:"team-management-hours-display"},e.hoursPerDay.toFixed(1)," hours")))))),r.createElement("div",{className:"team-management-availability-summary"},r.createElement("strong",null,"Total weekly capacity: "),Y.reduce(((e,a)=>e+(a.isWorkingDay?a.hoursPerDay:0)),0).toFixed(1)," hours")),r.createElement("div",{className:"form-actions"},r.createElement("button",{type:"submit",className:"btn btn-primary",disabled:_},_?"Saving...":O?"Update User":"Create User"),r.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>{Z(),k("list")},disabled:_},"Cancel"))),"import"===w&&r.createElement("div",{className:"team-management-import-section"},r.createElement("div",{className:"team-management-import-header"},r.createElement("div",{className:"team-management-import-title"},r.createElement("h4",null,"Import Users from Jira"),r.createElement("p",null,"Select Jira users to import into the PTO system. Users already in the system will not be shown.")),r.createElement("div",{className:"team-management-import-actions"},r.createElement("button",{onClick:()=>Q(0),disabled:U,className:"btn btn-secondary"},r.createElement(i.A,{size:16,className:U?"team-management-spin":""}),"Refresh"),x.length>0&&r.createElement("button",{onClick:async()=>{if(0!==x.length){M(!0);try{const e=p.map((e=>e.jira_account_id||e.email_address)).filter(Boolean),a=x.filter((a=>!e.includes(a.accountId)&&!e.includes(a.emailAddress))),t=await(0,l.invoke)("bulkImportUsersFromJira",{selectedUserIds:a.map((e=>e.accountId)),defaultTeamId:null,defaultDepartment:""});if(!t.success)throw new Error(t.message||"Failed to import users");{const{importedCount:e,skippedCount:a}=t.data;b("Successfully imported ".concat(e," users. ").concat(a>0?"".concat(a," users were already in the system."):""),"success"),F([]),h&&h(),Q(0)}}catch(e){b("Failed to import users: "+e.message,"error")}finally{M(!1)}}else b("Please select users to import","error")},disabled:L,className:"btn btn-primary"},r.createElement(c.A,{size:16}),"Import ",x.length," Selected",L&&" (Importing...)"))),U&&0===C.length?r.createElement("div",{className:"team-management-loading-state"},r.createElement("div",{className:"team-management-loading-spinner"}),r.createElement("p",null,"Loading Jira users...")):0===de.length?r.createElement("div",{className:"team-management-empty-state"},r.createElement("div",{className:"team-management-empty-icon"},"✅"),r.createElement("h4",null,"All Jira Users Imported"),r.createElement("p",null,"All available Jira users from your organization are already in the system.")):r.createElement(r.Fragment,null,r.createElement("div",{className:"team-management-import-stats"},r.createElement("div",{className:"team-management-import-stat"},r.createElement("span",{className:"team-management-import-stat-label"},"Total Jira Users:"),r.createElement("span",{className:"team-management-import-stat-value"},I.total)),r.createElement("div",{className:"team-management-import-stat"},r.createElement("span",{className:"team-management-import-stat-label"},"Available to Import:"),r.createElement("span",{className:"team-management-import-stat-value"},de.length)),r.createElement("div",{className:"team-management-import-stat"},r.createElement("span",{className:"team-management-import-stat-label"},"Selected:"),r.createElement("span",{className:"team-management-import-stat-value"},x.length))),r.createElement("div",{className:"team-management-jira-users-grid"},de.map((e=>{var a;const t=x.some((a=>a.accountId===e.accountId));return r.createElement("div",{key:e.accountId,className:"team-management-jira-user-card"},r.createElement("div",{className:"team-management-jira-user-header"},r.createElement("label",{className:"team-management-jira-user-checkbox"},r.createElement("input",{type:"checkbox",checked:t,onChange:a=>((e,a)=>{F((t=>a?[...t,e]:t.filter((a=>a.accountId!==e.accountId))))})(e,a.target.checked),disabled:L}),r.createElement("span",{className:"team-management-checkbox-custom"})),r.createElement("div",{className:"team-management-jira-user-avatar"},e.avatarUrl?r.createElement("img",{src:e.avatarUrl,alt:e.displayName}):r.createElement("div",{className:"team-management-avatar-placeholder"},(null===(a=e.displayName)||void 0===a?void 0:a.charAt(0))||"?"))),r.createElement("div",{className:"team-management-jira-user-info"},r.createElement("h5",{className:"team-management-jira-user-name"},e.displayName),r.createElement("div",{className:"team-management-jira-user-email"},e.emailAddress),r.createElement("div",{className:"team-management-jira-user-active"},e.active?"✅ Active":"❌ Inactive")),r.createElement("div",{className:"team-management-jira-user-actions"},r.createElement("button",{onClick:()=>(e=>{var a,t;V({firstName:(null===(a=e.displayName)||void 0===a?void 0:a.split(" ")[0])||"",lastName:(null===(t=e.displayName)||void 0===t?void 0:t.split(" ").slice(1).join(" "))||"",displayName:e.displayName||"",emailAddress:e.emailAddress||"",jiraAccountId:e.accountId||"",employmentType:"full-time",hireDate:"",teamMemberships:[],capacity:40}),A(null),k("form")})(e),className:"btn btn-sm btn-secondary",disabled:L},r.createElement(m.A,{size:14}),"Create User")))}))),!I.isLast&&r.createElement("div",{className:"team-management-pagination"},r.createElement("button",{onClick:()=>Q(I.startAt+I.maxResults),disabled:U,className:"btn btn-secondary"},r.createElement(o.A,{size:16}),"Load More Users",U&&" (Loading...)"),r.createElement("div",{className:"team-management-pagination-info"},"Showing ",C.length," of ",I.total," Jira users"))))))))}},9618:(e,a,t)=>{t.d(a,{A:()=>m});var r=t(6540),l=t(8697),n=t(2321);function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function c(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){i(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const m=e=>{let{request:a,onClose:t,onSave:s,currentUser:i}=e;const[m,o]=(0,r.useState)({startDate:"",endDate:"",leaveType:"",reason:"",dailySchedules:[]}),[d,u]=(0,r.useState)("");(0,r.useEffect)((()=>{a&&o({startDate:a.start_date,endDate:a.end_date,leaveType:a.leave_type,reason:a.reason||"",dailySchedules:a.daily_schedules||[]})}),[a]);return r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content"},r.createElement("div",{className:"modal-header"},r.createElement("h3",null,"Edit PTO Request"),r.createElement("button",{onClick:t,className:"modal-close"},r.createElement(l.A,{size:20}))),d&&r.createElement("div",{className:"alert alert-danger"},d),r.createElement("form",{onSubmit:async e=>{e.preventDefault(),u("");try{if("approved"===a.status){const e=new Date;e.setHours(0,0,0,0);if(new Date(a.start_date)<e)return void u("Cannot edit approved requests with past dates. Please contact an admin for assistance.")}const e=await(0,n.invoke)("editPTORequest",{requestId:a.id,editedBy:i.accountId,updatedData:{startDate:m.startDate,endDate:m.endDate,leaveType:m.leaveType,reason:m.reason,dailySchedules:m.dailySchedules}});e.success?(s(e.data),t()):u(e.message||"Failed to update PTO request")}catch(e){u("Failed to update PTO request: "+e.message)}}},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Start Date"),r.createElement("input",{type:"date",value:m.startDate,onChange:e=>o((a=>c(c({},a),{},{startDate:e.target.value}))),className:"form-control",required:!0})),r.createElement("div",{className:"form-group"},r.createElement("label",null,"End Date"),r.createElement("input",{type:"date",value:m.endDate,onChange:e=>o((a=>c(c({},a),{},{endDate:e.target.value}))),className:"form-control",required:!0})),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Leave Type"),r.createElement("select",{value:m.leaveType,onChange:e=>o((a=>c(c({},a),{},{leaveType:e.target.value}))),className:"form-control",required:!0},r.createElement("option",{value:"vacation"},"Vacation"),r.createElement("option",{value:"sick"},"Sick Leave"),r.createElement("option",{value:"personal"},"Personal Leave"),r.createElement("option",{value:"other"},"Other"))),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Reason"),r.createElement("textarea",{value:m.reason,onChange:e=>o((a=>c(c({},a),{},{reason:e.target.value}))),className:"form-control",rows:"3"})),r.createElement("div",{className:"modal-footer"},r.createElement("button",{type:"button",onClick:t,className:"btn btn-secondary"},"Cancel"),r.createElement("button",{type:"submit",className:"btn btn-primary"},"Save Changes")))))}}}]);