"use strict";(self.webpackChunkpto_request_app=self.webpackChunkpto_request_app||[]).push([[865],{99:(e,a,t)=>{t.d(a,{A:()=>s});var r=t(6540);const n=[{value:"all",label:"All Time"},{value:"current_year",label:"Current Year"},{value:"last_90_days",label:"Last 90 Days"},{value:"last_30_days",label:"Last 30 Days"},{value:"custom",label:"Custom Range"}],s=e=>{let{value:a={preset:"all",from:"",to:""},onChange:t}=e;const[s,l]=(0,r.useState)(a.preset||"all"),[c,m]=(0,r.useState)(a.from||""),[i,o]=(0,r.useState)(a.to||"");return(0,r.useEffect)((()=>{t("custom"!==s?{preset:s,from:"",to:""}:{preset:s,from:c,to:i})}),[s,c,i]),r.createElement("div",{className:"date-range-filter"},r.createElement("select",{className:"form-control",value:s,onChange:e=>l(e.target.value)},n.map((e=>r.createElement("option",{key:e.value,value:e.value},e.label)))),"custom"===s&&r.createElement("div",{className:"custom-range-fields",style:{display:"flex",gap:8,marginTop:8}},r.createElement("input",{type:"date",className:"form-control",value:c,onChange:e=>m(e.target.value),max:i||void 0,placeholder:"From"}),r.createElement("span",{style:{alignSelf:"center"}},"to"),r.createElement("input",{type:"date",className:"form-control",value:i,onChange:e=>o(e.target.value),min:c||void 0,placeholder:"To"})))}},808:(e,a,t)=>{t.d(a,{S0:()=>n});const r={vacation:{id:"vacation",label:"🏖️ Vacation",emoji:"🏖️",color:"bg-blue-100 text-blue-800"},sick:{id:"sick",label:"🤒 Sick Leave",emoji:"🤒",color:"bg-red-100 text-red-800"},personal:{id:"personal",label:"👤 Personal Day",emoji:"👤",color:"bg-purple-100 text-purple-800"},holiday:{id:"holiday",label:"🎉 Holiday",emoji:"🎉",color:"bg-green-100 text-green-800"},"other leave type":{id:"other leave type",label:"📝 Other Leave Type",emoji:"📝",color:"bg-gray-100 text-gray-800"}},n=e=>{var a;return(null===(a=r[null==e?void 0:e.toLowerCase()])||void 0===a?void 0:a.emoji)||"📅"}},2435:(e,a,t)=>{t.d(a,{A:()=>u});var r=t(6540),n=t(4796),s=t(8697),l=t(8309),c=t(827),m=t(4471),i=t(180),o=t(418),d=t(2321);const u=e=>{let{isOpen:a,onClose:t,currentUser:u,allUsers:p,allTeams:v,showNotification:g}=e;const[y,E]=(0,r.useState)("upload"),[f,b]=(0,r.useState)(null),[h,N]=(0,r.useState)([]),[w,k]=(0,r.useState)([]),[_,D]=(0,r.useState)([]),[S,T]=(0,r.useState)(!1),[A,O]=(0,r.useState)(0),[C,P]=(0,r.useState)(0),[j,x]=(0,r.useState)(0),[U,q]=(0,r.useState)(null),I=()=>{E("upload"),b(null),N([]),k([]),D([]),O(0),P(0),x(0),q(null),T(!1)},L=()=>{I(),t()};return a?r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content",style:{maxWidth:"900px",width:"95vw"}},r.createElement("div",{className:"modal-header"},r.createElement("h3",{className:"modal-title"},r.createElement(n.A,{size:22}),"Import PTO Records"),r.createElement("button",{onClick:L,className:"modal-close"},r.createElement(s.A,{size:24}))),r.createElement("div",{className:"modal-body"},r.createElement("div",{className:"import-progress-steps"},r.createElement("div",{className:"progress-step ".concat("upload"===y?"active":"upload"!==y?"completed":"")},r.createElement("div",{className:"step-number"},"1"),r.createElement("span",null,"Upload CSV")),r.createElement("div",{className:"progress-step ".concat("validate"===y?"active":["review","import"].includes(y)?"completed":"")},r.createElement("div",{className:"step-number"},"2"),r.createElement("span",null,"Validate Data")),r.createElement("div",{className:"progress-step ".concat("review"===y?"active":"import"===y?"completed":"")},r.createElement("div",{className:"step-number"},"3"),r.createElement("span",null,"Review Results")),r.createElement("div",{className:"progress-step ".concat("import"===y?"active":"")},r.createElement("div",{className:"step-number"},"4"),r.createElement("span",null,"Import"))),"upload"===y&&r.createElement("div",{className:"import-step"},r.createElement("div",{className:"upload-section"},r.createElement("div",{className:"upload-instructions"},r.createElement("h4",null,"Upload PTO Records CSV"),r.createElement("p",null,"Upload a CSV file containing PTO records to import. Make sure your CSV includes the required columns."),r.createElement("div",{className:"required-columns"},r.createElement("h5",null,"Required Columns:"),r.createElement("ul",null,r.createElement("li",null,r.createElement("code",null,"employee_email")," - Employee's email address"),r.createElement("li",null,r.createElement("code",null,"start_date")," - Start date (YYYY-MM-DD format)"),r.createElement("li",null,r.createElement("code",null,"end_date")," - End date (YYYY-MM-DD format)"),r.createElement("li",null,r.createElement("code",null,"leave_type")," - Type of leave (vacation, sick, personal, holiday)")),r.createElement("h5",null,"Optional Columns:"),r.createElement("ul",null,r.createElement("li",null,r.createElement("code",null,"reason")," - Reason for PTO"),r.createElement("li",null,r.createElement("code",null,"manager_email")," - Manager's email (if different from team manager)"))),r.createElement("button",{onClick:()=>{const e=["employee_email,start_date,end_date,leave_type,reason,manager_email","john.doe@company.com,2025-01-15,2025-01-19,vacation,Family vacation,manager@company.com","jane.smith@company.com,2025-02-10,2025-02-10,sick,Medical appointment,manager@company.com"].join("\n"),a=new Blob([e],{type:"text/csv"}),t=URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download="pto_import_template.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)},className:"btn btn-secondary"},r.createElement(l.A,{size:16}),"Download Template")),r.createElement("div",{className:"file-upload-area"},r.createElement("input",{type:"file",accept:".csv",onChange:async e=>{const a=e.target.files[0];if(a)if(a.name.endsWith(".csv")){b(a),T(!0);try{const e=(await a.text()).split("\n").filter((e=>e.trim()));if(e.length<2)throw new Error("CSV file must have at least a header row and one data row");const t=e[0].split(",").map((e=>e.trim().replace(/"/g,""))),r=e.slice(1).map(((e,a)=>{const r=e.split(",").map((e=>e.trim().replace(/"/g,""))),n={rowNumber:a+2};return t.forEach(((e,a)=>{n[e]=r[a]||""})),n}));N(r),E("validate"),g("Loaded ".concat(r.length," records from CSV"))}catch(e){g("Error reading CSV: ".concat(e.message),"error")}finally{T(!1)}}else g("Please upload a CSV file","error")},disabled:S,style:{display:"none"},id:"csv-upload"}),r.createElement("label",{htmlFor:"csv-upload",className:"upload-dropzone ".concat(S?"disabled":"")},r.createElement(c.A,{size:48}),r.createElement("h4",null,"Choose CSV File"),r.createElement("p",null,"Click to select a CSV file to upload"),f&&r.createElement("div",{className:"selected-file"},"Selected: ",f.name))))),"validate"===y&&r.createElement("div",{className:"import-step"},r.createElement("div",{className:"validation-section"},r.createElement("h4",null,"Validating Data..."),r.createElement("p",null,"Checking ",h.length," records for validity and matching with system users."),r.createElement("div",{className:"validation-progress"},r.createElement("div",{className:"progress-bar"},r.createElement("div",{className:"progress-fill",style:{width:"".concat(A,"%")}})),r.createElement("div",{className:"progress-text"},A,"% complete")),r.createElement("div",{className:"validation-stats"},r.createElement("div",{className:"stat-item stat-success"},r.createElement(m.A,{size:20}),r.createElement("span",null,C," Valid")),r.createElement("div",{className:"stat-item stat-error"},r.createElement(i.A,{size:20}),r.createElement("span",null,j," Invalid"))),r.createElement("button",{onClick:async()=>{if(0===h.length)return;T(!0),O(0),k([]),D([]);const e=[],a=[];let t=0,r=0;for(let g=0;g<h.length;g++){const y=h[g],E={rowNumber:y.rowNumber,original:y,validated:null,errors:[],warnings:[],status:"pending"};try{var n;const e=["employee_email","start_date","end_date","leave_type"].filter((e=>!y[e]));e.length>0&&E.errors.push("Missing required fields: ".concat(e.join(", ")));const g=new Date(y.start_date),f=new Date(y.end_date);isNaN(g.getTime())&&E.errors.push("Invalid start_date format"),isNaN(f.getTime())&&E.errors.push("Invalid end_date format"),g>f&&E.errors.push("Start date cannot be after end date");const b=["vacation","sick","personal","holiday"];b.includes(null===(n=y.leave_type)||void 0===n?void 0:n.toLowerCase())||E.errors.push("Invalid leave_type. Must be one of: ".concat(b.join(", ")));let h=null;if(y.employee_email&&(h=p.find((e=>{var a,t;return(null===(a=e.email_address)||void 0===a?void 0:a.toLowerCase())===y.employee_email.toLowerCase()||(null===(t=e.emailAddress)||void 0===t?void 0:t.toLowerCase())===y.employee_email.toLowerCase()})),!h))try{const e=await(0,d.invoke)("getJiraUsers",{query:y.employee_email});if(e.success&&e.data.length>0){const a=e.data.find((e=>{var a;return(null===(a=e.emailAddress)||void 0===a?void 0:a.toLowerCase())===y.employee_email.toLowerCase()}));a&&(h=a,E.warnings.push("User found in Jira but not in PTO system"))}}catch(e){console.warn("Error searching Jira user:",e)}h||E.errors.push("User not found: ".concat(y.employee_email));let N=null;if(h){const e=p.find((e=>{var a;return(null===(a=e.email_address)||void 0===a?void 0:a.toLowerCase())===y.employee_email.toLowerCase()}));if(null!=e&&e.team_id){const a=v.find((a=>a.id===e.team_id));null!=a&&a.manager&&(N=a.manager)}!N&&y.manager_email&&(N=p.find((e=>{var a;return(null===(a=e.email_address)||void 0===a?void 0:a.toLowerCase())===y.manager_email.toLowerCase()})),N||E.warnings.push("Manager not found: ".concat(y.manager_email,". Will use system default.")))}let w=1;if(!isNaN(g.getTime())&&!isNaN(f.getTime())){w=Math.ceil((f-g)/864e5)+1}var s,l,c,m,i,o;if(0===E.errors.length)E.validated={requester_id:h.accountId||h.jira_account_id,requester_name:h.displayName||h.display_name,requester_email:h.emailAddress||h.email_address,requester_avatar:h.avatarUrl||h.avatar_url,manager_id:(null===(s=N)||void 0===s?void 0:s.accountId)||(null===(l=N)||void 0===l?void 0:l.jira_account_id)||"admin",manager_name:(null===(c=N)||void 0===c?void 0:c.displayName)||(null===(m=N)||void 0===m?void 0:m.display_name)||"System Admin",manager_email:(null===(i=N)||void 0===i?void 0:i.emailAddress)||(null===(o=N)||void 0===o?void 0:o.email_address)||"admin@system.com",start_date:g.toISOString().split("T")[0],end_date:f.toISOString().split("T")[0],leave_type:y.leave_type.toLowerCase(),reason:y.reason||"Imported from CSV",total_days:w,total_hours:8*w,status:"approved",daily_schedules:[],import_source:"csv_import",imported_by:u.accountId},E.status="valid",t++,a.push(E.validated);else E.status="invalid",r++}catch(e){E.errors.push("Validation error: ".concat(e.message)),E.status="invalid",r++}e.push(E),O(Math.round((g+1)/h.length*100)),P(t),x(r),g%10!=0&&g!==h.length-1||(k([...e]),await new Promise((e=>setTimeout(e,10))))}k(e),D(a),T(!1),E("review"),g("Validation complete: ".concat(t," valid, ").concat(r," invalid records"),t>0?"success":"error")},disabled:S,className:"btn btn-primary"},S?"Validating...":"Start Validation"))),"review"===y&&r.createElement("div",{className:"import-step"},r.createElement("div",{className:"review-section"},r.createElement("h4",null,"Validation Results"),r.createElement("p",null,"Review the validation results before importing."),r.createElement("div",{className:"validation-summary"},r.createElement("div",{className:"summary-stats"},r.createElement("div",{className:"summary-stat stat-success"},r.createElement(m.A,{size:24}),r.createElement("div",null,r.createElement("div",{className:"stat-number"},C),r.createElement("div",{className:"stat-label"},"Valid Records"))),r.createElement("div",{className:"summary-stat stat-error"},r.createElement(i.A,{size:24}),r.createElement("div",null,r.createElement("div",{className:"stat-number"},j),r.createElement("div",{className:"stat-label"},"Invalid Records"))))),r.createElement("div",{className:"validation-results-list"},w.slice(0,10).map(((e,a)=>r.createElement("div",{key:a,className:"validation-result ".concat(e.status)},r.createElement("div",{className:"result-header"},r.createElement("div",{className:"result-status"},"valid"===e.status?r.createElement(m.A,{size:16,className:"text-green-600"}):r.createElement(i.A,{size:16,className:"text-red-600"}),r.createElement("span",null,"Row ",e.rowNumber)),r.createElement("div",{className:"result-user"},e.original.employee_email)),e.errors.length>0&&r.createElement("div",{className:"result-errors"},e.errors.map(((e,a)=>r.createElement("div",{key:a,className:"error-item"},r.createElement(i.A,{size:12}),e)))),e.warnings.length>0&&r.createElement("div",{className:"result-warnings"},e.warnings.map(((e,a)=>r.createElement("div",{key:a,className:"warning-item"},r.createElement(o.A,{size:12}),e))))))),w.length>10&&r.createElement("div",{className:"results-more"},"Showing 10 of ",w.length," results...")),r.createElement("div",{className:"review-actions"},r.createElement("button",{onClick:()=>E("validate"),className:"btn btn-secondary",disabled:S},"Back to Validation"),r.createElement("button",{onClick:async()=>{if(0===_.length)return void g("No valid records to import","error");T(!0),O(0),E("import");const e={total:_.length,successful:0,failed:0,errors:[]};for(let a=0;a<_.length;a++){const t=_[a];try{const r=await(0,d.invoke)("submitPTOForUser",{requestData:t,submittedBy:u.accountId});r.success?e.successful++:(e.failed++,e.errors.push("Row ".concat(a+1,": ").concat(r.message)))}catch(t){e.failed++,e.errors.push("Row ".concat(a+1,": ").concat(t.message))}O(Math.round((a+1)/_.length*100)),a%5!=0&&a!==_.length-1||await new Promise((e=>setTimeout(e,50)))}q(e),T(!1),g("Import complete: ".concat(e.successful," successful, ").concat(e.failed," failed"),e.successful>0?"success":"error")},disabled:S||0===C,className:"btn btn-primary"},"Import ",C," Valid Records")))),"import"===y&&r.createElement("div",{className:"import-step"},r.createElement("div",{className:"import-section"},r.createElement("h4",null,"Importing Records..."),r.createElement("p",null,"Creating PTO requests in the system."),r.createElement("div",{className:"import-progress"},r.createElement("div",{className:"progress-bar"},r.createElement("div",{className:"progress-fill",style:{width:"".concat(A,"%")}})),r.createElement("div",{className:"progress-text"},A,"% complete")),U&&r.createElement("div",{className:"import-results"},r.createElement("div",{className:"import-summary"},r.createElement("div",{className:"summary-stat stat-success"},r.createElement(m.A,{size:24}),r.createElement("div",null,r.createElement("div",{className:"stat-number"},U.successful),r.createElement("div",{className:"stat-label"},"Imported Successfully"))),r.createElement("div",{className:"summary-stat stat-error"},r.createElement(i.A,{size:24}),r.createElement("div",null,r.createElement("div",{className:"stat-number"},U.failed),r.createElement("div",{className:"stat-label"},"Failed to Import")))),U.errors.length>0&&r.createElement("div",{className:"import-errors"},r.createElement("h5",null,"Import Errors:"),r.createElement("div",{className:"error-list"},U.errors.slice(0,5).map(((e,a)=>r.createElement("div",{key:a,className:"error-item"},r.createElement(i.A,{size:12}),e))),U.errors.length>5&&r.createElement("div",{className:"error-item"},"And ",U.errors.length-5," more errors..."))),r.createElement("div",{className:"import-actions"},r.createElement("button",{onClick:L,className:"btn btn-primary"},"Done"),r.createElement("button",{onClick:I,className:"btn btn-secondary"},"Import Another File"))))))),r.createElement("style",{jsx:!0},"\n        .import-progress-steps {\n          display: flex;\n          justify-content: space-between;\n          margin-bottom: 2rem;\n          padding: 1rem;\n          background: #f9fafb;\n          border-radius: 8px;\n        }\n\n        .progress-step {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          gap: 0.5rem;\n          flex: 1;\n          position: relative;\n        }\n\n        .progress-step:not(:last-child)::after {\n          content: '';\n          position: absolute;\n          top: 15px;\n          right: -50%;\n          width: 100%;\n          height: 2px;\n          background: #e5e7eb;\n          z-index: 1;\n        }\n\n        .progress-step.completed:not(:last-child)::after {\n          background: #22c55e;\n        }\n\n        .step-number {\n          width: 30px;\n          height: 30px;\n          border-radius: 50%;\n          background: #e5e7eb;\n          color: #6b7280;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-weight: 600;\n          font-size: 0.875rem;\n          z-index: 2;\n          position: relative;\n        }\n\n        .progress-step.active .step-number {\n          background: #3b82f6;\n          color: white;\n        }\n\n        .progress-step.completed .step-number {\n          background: #22c55e;\n          color: white;\n        }\n\n        .progress-step span {\n          font-size: 0.875rem;\n          font-weight: 500;\n          color: #6b7280;\n        }\n\n        .progress-step.active span {\n          color: #3b82f6;\n        }\n\n        .progress-step.completed span {\n          color: #22c55e;\n        }\n\n        .import-step {\n          min-height: 400px;\n        }\n\n        .upload-instructions {\n          margin-bottom: 2rem;\n        }\n\n        .required-columns {\n          background: #f9fafb;\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 1rem;\n          margin: 1rem 0;\n        }\n\n        .required-columns h5 {\n          margin: 0 0 0.5rem 0;\n          color: #374151;\n          font-size: 0.875rem;\n          font-weight: 600;\n        }\n\n        .required-columns ul {\n          margin: 0 0 1rem 0;\n          padding-left: 1rem;\n        }\n\n        .required-columns li {\n          margin-bottom: 0.25rem;\n          font-size: 0.875rem;\n          color: #6b7280;\n        }\n\n        .required-columns code {\n          background: #e5e7eb;\n          padding: 0.125rem 0.25rem;\n          border-radius: 3px;\n          font-family: monospace;\n          font-size: 0.8rem;\n        }\n\n        .file-upload-area {\n          border: 2px dashed #d1d5db;\n          border-radius: 8px;\n          padding: 2rem;\n          text-align: center;\n        }\n\n        .upload-dropzone {\n          display: block;\n          cursor: pointer;\n          transition: all 0.2s;\n        }\n\n        .upload-dropzone:hover {\n          border-color: #3b82f6;\n          background: #f8fafc;\n        }\n\n        .upload-dropzone.disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n\n        .upload-dropzone h4 {\n          margin: 1rem 0 0.5rem 0;\n          color: #374151;\n        }\n\n        .upload-dropzone p {\n          margin: 0;\n          color: #6b7280;\n        }\n\n        .selected-file {\n          margin-top: 1rem;\n          padding: 0.5rem;\n          background: #dcfce7;\n          border-radius: 4px;\n          color: #166534;\n          font-weight: 500;\n        }\n\n        .validation-progress, .import-progress {\n          margin: 2rem 0;\n        }\n\n        .progress-bar {\n          width: 100%;\n          height: 8px;\n          background: #e5e7eb;\n          border-radius: 4px;\n          overflow: hidden;\n          margin-bottom: 0.5rem;\n        }\n\n        .progress-fill {\n          height: 100%;\n          background: #3b82f6;\n          transition: width 0.3s ease;\n        }\n\n        .progress-text {\n          text-align: center;\n          font-size: 0.875rem;\n          color: #6b7280;\n        }\n\n        .validation-stats {\n          display: flex;\n          gap: 2rem;\n          margin: 1rem 0;\n        }\n\n        .stat-item {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          font-weight: 500;\n        }\n\n        .stat-item.stat-success {\n          color: #22c55e;\n        }\n\n        .stat-item.stat-error {\n          color: #ef4444;\n        }\n\n        .validation-summary, .import-summary {\n          margin-bottom: 2rem;\n        }\n\n        .summary-stats {\n          display: flex;\n          gap: 2rem;\n          justify-content: center;\n        }\n\n        .summary-stat {\n          display: flex;\n          align-items: center;\n          gap: 1rem;\n          padding: 1rem 2rem;\n          border-radius: 8px;\n          background: #f9fafb;\n          border: 1px solid #e5e7eb;\n        }\n\n        .summary-stat.stat-success {\n          background: #dcfce7;\n          border-color: #22c55e;\n          color: #166534;\n        }\n\n        .summary-stat.stat-error {\n          background: #fee2e2;\n          border-color: #ef4444;\n          color: #b91c1c;\n        }\n\n        .stat-number {\n          font-size: 1.5rem;\n          font-weight: 700;\n        }\n\n        .stat-label {\n          font-size: 0.875rem;\n        }\n\n        .validation-results-list {\n          max-height: 300px;\n          overflow-y: auto;\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          margin-bottom: 1rem;\n        }\n\n        .validation-result {\n          padding: 1rem;\n          border-bottom: 1px solid #f3f4f6;\n        }\n\n        .validation-result:last-child {\n          border-bottom: none;\n        }\n\n        .validation-result.valid {\n          background: #f0fdf4;\n          border-left: 4px solid #22c55e;\n        }\n\n        .validation-result.invalid {\n          background: #fef2f2;\n          border-left: 4px solid #ef4444;\n        }\n\n        .result-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 0.5rem;\n        }\n\n        .result-status {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          font-weight: 500;\n        }\n\n        .result-user {\n          font-size: 0.875rem;\n          color: #6b7280;\n        }\n\n        .result-errors, .result-warnings {\n          margin-top: 0.5rem;\n        }\n\n        .error-item, .warning-item {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          font-size: 0.875rem;\n          margin-bottom: 0.25rem;\n        }\n\n        .error-item {\n          color: #ef4444;\n        }\n\n        .warning-item {\n          color: #f59e0b;\n        }\n\n        .results-more {\n          text-align: center;\n          padding: 1rem;\n          color: #6b7280;\n          font-style: italic;\n        }\n\n        .review-actions, .import-actions {\n          display: flex;\n          gap: 1rem;\n          justify-content: flex-end;\n          margin-top: 2rem;\n          padding-top: 1rem;\n          border-top: 1px solid #e5e7eb;\n        }\n\n        .import-errors {\n          margin-top: 1rem;\n          padding: 1rem;\n          background: #fef2f2;\n          border: 1px solid #fecaca;\n          border-radius: 8px;\n        }\n\n        .import-errors h5 {\n          margin: 0 0 0.5rem 0;\n          color: #b91c1c;\n          font-size: 0.875rem;\n          font-weight: 600;\n        }\n\n        .error-list {\n          display: flex;\n          flex-direction: column;\n          gap: 0.25rem;\n        }\n\n        @media (max-width: 768px) {\n          .import-progress-steps {\n            flex-direction: column;\n            gap: 1rem;\n          }\n\n          .progress-step:not(:last-child)::after {\n            display: none;\n          }\n\n          .summary-stats {\n            flex-direction: column;\n            gap: 1rem;\n          }\n\n          .review-actions, .import-actions {\n            flex-direction: column;\n          }\n        }\n      ")):null}},2605:(e,a,t)=>{var r=t(6540),n=t(5338),s=t(2307),l=t(7235),c=t(7623),m=t(2492),i=t(8686),o=t(2321);const d=e=>{let{message:a,type:t,onClose:n}=e;return r.createElement("div",{className:"fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ".concat("success"===t?"bg-green-500 text-white":"bg-red-500 text-white")},r.createElement("div",{className:"flex items-center justify-between"},r.createElement("span",null,a),r.createElement("button",{onClick:n,className:"ml-4 text-white hover:text-gray-200"},"×")))};var u=t(7892),p=t(2898),v=t(5143),g=t(9681),y=t(3029);function E(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?E(Object(t),!0).forEach((function(a){b(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function b(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const h=()=>{const[e,a]=(0,r.useState)(null),[t,n]=(0,r.useState)(!0),[s,l]=(0,r.useState)(null),[c,m]=(0,r.useState)(0);(0,r.useEffect)((()=>{i()}),[]);const i=async function(){n(!0),l(null);try{var e;console.log("🔍 Fetching current user...");let t=await(0,o.invoke)("getCurrentUser");if(t.success||"NETWORK_ERROR"!==(null===(e=t.error)||void 0===e?void 0:e.type)||(console.log("🔄 Main method failed, trying fallback..."),t=await(0,o.invoke)("getCurrentUserFallback")),!t.success)throw new Error(t.message||"Failed to fetch current user");{console.log("👤 User data received:",t.data);let e=!1;try{const a=await(0,o.invoke)("checkUserAdminStatus",{accountId:t.data.accountId});e=!!a.success&&a.data.isAdmin}catch(e){console.warn("⚠️ Could not check admin status:",e)}const r=f(f({},t.data),{},{isAdmin:e});console.log("✅ Current user loaded:",r.displayName,"isAdmin:",r.isAdmin),a(r),m(0)}}catch(e){if(console.error("❌ Error fetching current user:",e),l(e.message),e.message.includes("timeout")||e.message.includes("fetch failed")){if(c<3)return console.log("🔄 Auto-retrying in 5 seconds... (attempt ".concat(c+1,"/3)")),void setTimeout((()=>{m((e=>e+1)),i(!0)}),5e3);l("Network connection failed after multiple attempts. Please check your internet connection and refresh the page.")}}finally{n(!1)}};return{currentUser:e,loading:t,error:s,refreshUser:async()=>{m(0),await i()},testConnectivity:async()=>{try{return await(0,o.invoke)("testConnectivity")}catch(e){return{success:!1,message:"Connectivity test failed: "+e.message}}},isAdmin:(null==e?void 0:e.isAdmin)||!1,retryCount:c}};function N(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function w(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?N(Object(t),!0).forEach((function(a){k(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):N(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function k(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const _=e=>{const[a,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!0),[l,c]=(0,r.useState)(null),m=(0,r.useCallback)((async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e){s(!0),c(null);try{console.log("📋 Fetching PTO requests with filters:",a);const e=await(0,o.invoke)("getPTORequests",a);if(!e.success)throw new Error(e.message||"Failed to fetch PTO requests");var r;t(e.data||[]),console.log("✅ Loaded ".concat((null===(r=e.data)||void 0===r?void 0:r.length)||0," PTO requests"))}catch(e){c(e.message),console.error("❌ Error fetching PTO requests:",e)}finally{s(!1)}}}),[e]),i=(0,r.useCallback)((async e=>{s(!0),c(null);try{console.log("📝 Submitting PTO request:",e);const a=await(0,o.invoke)("storePTORequest",e);if(a.success)return await m(),{success:!0,data:a.data};throw new Error(a.message||"Failed to submit PTO request")}catch(e){return c(e.message),console.error("❌ Error submitting PTO request:",e),{success:!1,message:e.message}}finally{s(!1)}}),[m]),d=(0,r.useCallback)((async function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";s(!0),c(null);try{console.log("✅ Updating PTO request ".concat(e," to ").concat(a));const n=await(0,o.invoke)("updatePTORequest",{requestId:e,status:a,comment:r});if(n.success)return t((t=>t.map((t=>t.id===e?w(w({},t),{},{status:a,reviewer_comments:r,reviewed_at:(new Date).toISOString()}):t)))),{success:!0};throw new Error(n.message||"Failed to update PTO request")}catch(e){return c(e.message),console.error("❌ Error updating PTO request:",e),{success:!1,message:e.message}}finally{s(!1)}}),[]),u=(0,r.useCallback)((async e=>{s(!0),c(null);try{console.log("🗑️ Cancelling PTO request ".concat(e));const a=await(0,o.invoke)("updatePTORequest",{requestId:e,status:"cancelled",comment:"Cancelled by user"});if(a.success)return t((a=>a.filter((a=>a.id!==e)))),{success:!0};throw new Error(a.message||"Failed to cancel PTO request")}catch(e){return c(e.message),console.error("❌ Error cancelling PTO request:",e),{success:!1,message:e.message}}finally{s(!1)}}),[]),p=(0,r.useCallback)((e=>a.filter((a=>a.requester_id===e))),[a]),v=(0,r.useCallback)((()=>a.filter((e=>"pending"===e.status))),[a]),g=(0,r.useCallback)((e=>a.filter((a=>a.status===e))),[a]),y=(0,r.useCallback)(((e,t)=>a.filter((a=>{const r=new Date(a.start_date),n=new Date(a.end_date),s=new Date(e),l=new Date(t);return r>=s&&r<=l||n>=s&&n<=l||r<=s&&n>=l}))),[a]),E=(0,r.useCallback)((async()=>{if(null==e||!e.emailAddress)return[];try{console.log("📋 Fetching pending requests for manager:",e.emailAddress);const a=await(0,o.invoke)("getPendingRequests",{managerEmail:e.emailAddress});return a.success?a.data||[]:(console.error("Failed to fetch pending requests:",a.message),[])}catch(e){return console.error("❌ Error fetching pending requests for manager:",e),[]}}),[e]);return(0,r.useEffect)((()=>{e&&m()}),[e,m]),{requests:a,loading:n,error:l,fetchRequests:m,submitRequest:i,updateRequestStatus:d,cancelRequest:u,getUserRequests:p,getPendingRequests:v,getRequestsByStatus:g,getRequestsByDateRange:y,getPendingRequestsForManager:E}},D=()=>{var e;const[a,t]=(0,r.useState)("calendar"),[n,E]=(0,r.useState)([]),[f,b]=(0,r.useState)(null),[N,w]=(0,r.useState)(!0),[k,D]=(0,r.useState)([]),[S,T]=(0,r.useState)([]),[A,O]=(0,r.useState)([]),[C,P]=(0,r.useState)(!1),[j,x]=(0,r.useState)(null),[U,q]=(0,r.useState)(!1),{currentUser:I,loading:L,error:R,isAdmin:z}=h(),{requests:F,loading:M,error:W,submitRequest:V,updateRequestStatus:B,cancelRequest:Y,fetchRequests:J,getUserRequests:H,getPendingRequests:G}=_(I),[K,Q]=(0,r.useState)(!1);(0,r.useEffect)((()=>{(async()=>{if(I)try{const e=await(0,o.invoke)("getUserTeams",{userId:C?j.jira_account_id:I.accountId});e.success&&D(e.data||[]);const[a,t]=await Promise.all([(0,o.invoke)("getUsers"),(0,o.invoke)("getTeams")]);if(a.success&&T(a.data||[]),t.success){const e=t.data||[];O(e);const a=C?j.jira_account_id||j.id:I.jira_account_id||I.id,r=e.filter((e=>{var t,r;return(null===(t=e.manager)||void 0===t?void 0:t.jira_account_id)===a||(null===(r=e.manager)||void 0===r?void 0:r.id)===a}));Q(r.length>0||z&&!C)}}catch(e){console.error("Error loading additional data:",e)}})()}),[I,z,C,j]),(0,r.useEffect)((()=>{(async()=>{w(!0);try{console.log("🔧 Initializing PTO App with Admin Setup...");const e=await(0,o.invoke)("initializePTODatabaseWithTeamManagement");if(e.success)console.log("✅ PTO App and Admin initialized:",e.data);else{console.warn("Admin setup failed, trying regular init:",e.message);const a=await(0,o.invoke)("initializePTODatabase");if(!a.success)throw new Error(a.message)}try{await(0,o.invoke)("clearImportValidationData"),console.log("✅ Cleared any stale import validation data on app start")}catch(e){console.warn("⚠️ Could not clear import validation data:",e)}console.log("✅ PTO App initialization complete")}catch(e){console.error("❌ App initialization failed:",e),X("Failed to initialize app: "+e.message,"error")}finally{w(!1)}})()}),[]);const X=function(e){b({message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"}),setTimeout((()=>b(null)),5e3)},Z=[{id:"calendar",label:"Calendar",icon:s.A,description:"View and create PTO requests"},{id:"requests",label:"My Requests",icon:l.A,description:"View your PTO request history"},...K?[{id:"manager",label:"Manager",icon:c.A,description:"Manage team PTO requests"}]:[],...(C?U:z)?[{id:"admin",label:"Admin",icon:m.A,description:"Administrative functions"}]:[]],$=C?null==j?void 0:j.accountId:null==I?void 0:I.accountId,ee=H($),ae=G().filter((e=>e.requester_id!==$));return N||L?r.createElement("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center"},r.createElement("div",{className:"text-center"},r.createElement("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),r.createElement("h2",{className:"text-xl font-semibold text-gray-900 mb-2"},"Initializing PTO Management"),r.createElement("p",{className:"text-gray-600"},"Setting up database and admin users..."))):R?r.createElement("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center"},r.createElement("div",{className:"text-center p-8 bg-white rounded-lg shadow-md"},r.createElement("div",{className:"text-red-500 mb-4"},r.createElement("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"}))),r.createElement("h2",{className:"text-xl font-semibold text-gray-900 mb-2"},"Authentication Error"),r.createElement("p",{className:"text-gray-600 mb-4"},"Failed to load user information: ",R),r.createElement("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600"},"Retry"))):I?r.createElement("div",{className:"pto-management-app"},I&&r.createElement("div",{className:"app-header"},r.createElement("div",{className:"app-header-left"},r.createElement("h1",null,"PTO Management")),r.createElement("div",{className:"app-header-right"},z&&!C&&r.createElement("div",{className:"view-as-controls"},r.createElement(v.A,{selectedUser:j,onSelect:async e=>{if(!e)return P(!1),x(null),void q(!1);try{const a=await(0,o.invoke)("getUserTeams",{userId:e.jira_account_id||e.id});if(a.success){x(e),D(a.data||[]),P(!0);const t=await(0,o.invoke)("checkUserAdminStatus",{accountId:e.jira_account_id||e.accountId||e.id});q(!!t.success&&t.data.isAdmin)}}catch(e){console.error("Error setting view as user:",e),q(!1)}},placeholder:"View as user...",useBackendSearch:!0})),C&&r.createElement("div",{className:"view-as-banner"},r.createElement("span",null,"Viewing as: ",(null==j?void 0:j.display_name)||(null==j?void 0:j.displayName)),r.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>{P(!1),x(null),q(!1),loadAllData()}},"Exit View As")),r.createElement("div",{className:"user-info"},r.createElement("span",null,I.displayName),z&&!C&&r.createElement("span",{className:"badge badge-admin"},"Admin"),K&&!C&&r.createElement("span",{className:"badge badge-manager"},"Manager")))),r.createElement("div",{className:"min-h-screen bg-gray-50"},r.createElement("div",{className:"app-topbar"},r.createElement("div",{className:"app-logo"},r.createElement("div",{className:"app-logo-icon"},r.createElement(s.A,{size:20})),r.createElement("span",{style:{fontWeight:600,fontSize:"1.125rem",color:"#1f2937"}},"PTO Request")),r.createElement("div",{className:"nav-tabs condensed"},Z.map((e=>{const n=e.icon,s=a===e.id;return r.createElement("button",{key:e.id,onClick:async()=>{try{await(0,o.invoke)("clearImportValidationData")}catch(e){console.warn("⚠️ Could not clear validation data:",e)}t(e.id)},className:"nav-tab".concat(s?" active":"").concat("admin"===e.id?" admin":"").concat("manager"!==e.id||z?"":" manager"),title:e.description},r.createElement(n,{size:18}),r.createElement("span",null,e.label),"manager"===e.id&&ae.length>0&&r.createElement("span",{className:"nav-tab-badge"},ae.length),"admin"===e.id&&r.createElement("span",{className:"nav-tab-label admin"},"Admin"),"manager"===e.id&&!z&&r.createElement("span",{className:"nav-tab-label manager"},"Manager"))}))),r.createElement("div",{className:"app-user-profile"},r.createElement("div",{className:"user-avatar-header"},(null===(e=I.displayName)||void 0===e?void 0:e.charAt(0))||r.createElement(i.A,{size:16}),z&&r.createElement("span",{className:"user-badge admin"},r.createElement(m.A,{size:8})),K&&!z&&r.createElement("span",{className:"user-badge manager"},r.createElement(c.A,{size:8}))),r.createElement("div",{className:"user-info-header"},r.createElement("div",{className:"user-name-header"},r.createElement("span",null,I.displayName),z&&r.createElement(m.A,{size:12,style:{color:"#8b5cf6"}}),K&&!z&&r.createElement(c.A,{size:12,style:{color:"#f97316"}})),r.createElement("div",{className:"user-email-header"},I.emailAddress)))),r.createElement("main",{style:{maxWidth:"80rem",margin:"0 auto",padding:"2rem 1rem"}},"calendar"===a&&r.createElement(g.A,{events:F,onDateSelect:e=>{const a=e.toISOString().split("T")[0];E((e=>e.includes(a)?e.filter((e=>e!==a)):[...e,a].sort()))},selectedDates:n,onSubmitPTO:async e=>{try{var a;const t=S.find((e=>e.jira_account_id===(null==I?void 0:I.accountId)||e.email_address===(null==I?void 0:I.emailAddress)));let r=null;if(null!=t&&t.team_id){const e=A.find((e=>e.id===t.team_id));null!=e&&e.manager&&(r=e.manager)}const s={reporter:e.targetUser||I,manager:e.manager||r||{accountId:"manager-default",displayName:"Manager",emailAddress:"manager@company.com"},startDate:e.startDate||n[0],endDate:e.endDate||n[n.length-1],leaveType:e.leaveType||(null===(a=e.dailySchedules)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.leaveType)||"vacation",reason:e.reason||"",dailySchedules:e.dailySchedules||n.map((e=>({date:e,type:"FULL_DAY",leaveType:"vacation"})))},l=await V(s);return l.success?(E([]),X("PTO request submitted successfully!"),{success:!0}):(X(l.message||"Failed to submit PTO request","error"),{success:!1})}catch(e){return console.error("Error submitting PTO request:",e),X("Failed to submit PTO request","error"),{success:!1}}},currentUser:C?j:I,allUsers:S,allTeams:A,isAdmin:C?U:z}),"requests"===a&&r.createElement(y.A,{requests:ee,currentUser:C?j:I,onEditRequest:async e=>{try{const a=await(0,o.invoke)("editPTORequest",{requestId:e.id,editedBy:I.accountId,updatedData:{startDate:e.startDate,endDate:e.endDate,leaveType:e.leaveType,reason:e.reason,dailySchedules:e.dailySchedules}});a.success?(X("PTO request updated successfully and resubmitted for approval"),C?loadUserRequests(j):loadAllRequests()):X(a.message||"Failed to update PTO request","error")}catch(e){console.error("Error updating PTO request:",e),X("Failed to update PTO request","error")}},onCancelRequest:async e=>{if(window.confirm("Are you sure you want to cancel this PTO request?"))try{const a=await Y(e.id);a.success?X("PTO request cancelled successfully!"):X(a.message||"Failed to cancel PTO request","error")}catch(e){console.error("Error cancelling PTO request:",e),X("Failed to cancel PTO request","error")}}}),"manager"===a&&K&&r.createElement(p.A,{currentUser:I,isAdmin:z,showNotification:X}),"admin"===a&&z&&r.createElement(u.A,{currentUser:I,showNotification:X})),(M||N)&&r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content",style:{maxWidth:320,padding:24,textAlign:"center"}},r.createElement("div",{className:"loading-spinner",style:{margin:"0 auto 1rem"}}),r.createElement("span",null,"Processing..."))),f&&r.createElement(d,{message:f.message,type:f.type,onClose:()=>b(null)}))):r.createElement("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center"},r.createElement("div",{className:"text-center"},r.createElement("div",{className:"w-16 h-16 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),r.createElement("p",{className:"text-gray-600"},"Loading user information...")))};console.log("PTO app initializing...");const S=async()=>{const e=document.getElementById("root");if(!e)return void console.error('Root element not found! Make sure there is a div with id="root" in your HTML.');(0,n.H)(e).render(r.createElement(r.StrictMode,null,r.createElement(D,null))),console.log("App rendered successfully");try{await o.view.resize(),console.log("Forge iframe resized")}catch(e){console.warn("Unable to resize Forge iframe:",e)}};"complete"===document.readyState||"interactive"===document.readyState?S():document.addEventListener("DOMContentLoaded",S)},3245:(e,a,t)=>{t.d(a,{A:()=>c});var r=t(6540),n=t(7946),s=t(4471),l=t(180);const c=e=>{let{status:a}=e;const t=(e=>{const a={pending:{bg:"bg-yellow-100",text:"text-yellow-800",icon:n.A,label:"Pending"},approved:{bg:"bg-green-100",text:"text-green-800",icon:s.A,label:"Approved"},declined:{bg:"bg-red-100",text:"text-red-800",icon:l.A,label:"Declined"}};return a[e.toLowerCase()]||a.pending})(a),c=t.icon;return r.createElement("span",{className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ".concat(t.bg," ").concat(t.text)},r.createElement(c,{size:12}),r.createElement("span",null,t.label))}},4143:(e,a,t)=>{t.d(a,{A:()=>y});var r=t(6540),n=t(2307),s=t(4471),l=t(7235),c=t(4934),m=t(2708),i=t(7946),o=t(2321),d=t(5143),u=t(9618);function p(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?p(Object(t),!0).forEach((function(a){g(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function g(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const y=e=>{let{currentUser:a,showNotification:t,isAdmin:p}=e;const[g,y]=(0,r.useState)(null),[E,f]=(0,r.useState)({startDate:new Date((new Date).getFullYear(),0,1).toISOString().split("T")[0],endDate:new Date((new Date).getFullYear(),11,31).toISOString().split("T")[0]}),[b,h]=(0,r.useState)([]),[N,w]=(0,r.useState)(!1),[k,_]=(0,r.useState)(null);(0,r.useEffect)((()=>{g&&D()}),[g,E]);const D=async()=>{w(!0);try{const e=await(0,o.invoke)("getPTORequests",{requester_id:g.accountId,startDate:E.startDate,endDate:E.endDate});e.success&&h(e.data||[])}catch(e){t("Failed to load PTO requests","error")}finally{w(!1)}},S={totalDays:b.reduce(((e,a)=>e+(a.total_days||0)),0),approved:b.filter((e=>"approved"===e.status)).length,pending:b.filter((e=>"pending"===e.status)).length,declined:b.filter((e=>"declined"===e.status)).length};return r.createElement("div",{className:"user-pto-management"},r.createElement("div",{className:"user-pto-header"},r.createElement("h2",null,"User PTO Management"),r.createElement("div",{className:"user-pto-controls"},r.createElement(d.A,{selectedUser:g,onSelect:y,placeholder:"Search and select user",useBackendSearch:!0}),r.createElement("div",{className:"date-range-filter"},r.createElement("input",{type:"date",value:E.startDate,onChange:e=>f((a=>v(v({},a),{},{startDate:e.target.value}))),className:"form-control"}),r.createElement("span",null,"to"),r.createElement("input",{type:"date",value:E.endDate,onChange:e=>f((a=>v(v({},a),{},{endDate:e.target.value}))),className:"form-control"})))),g&&r.createElement(r.Fragment,null,r.createElement("div",{className:"summary-cards"},r.createElement("div",{className:"summary-card"},r.createElement("div",{className:"card-icon"},r.createElement(n.A,{size:24})),r.createElement("div",{className:"card-content"},r.createElement("div",{className:"card-value"},S.totalDays),r.createElement("div",{className:"card-label"},"Total PTO Days"))),r.createElement("div",{className:"summary-card approved"},r.createElement("div",{className:"card-icon"},r.createElement(s.A,{size:24})),r.createElement("div",{className:"card-content"},r.createElement("div",{className:"card-value"},S.approved),r.createElement("div",{className:"card-label"},"Approved"))),r.createElement("div",{className:"summary-card pending"},r.createElement("div",{className:"card-icon"},r.createElement(l.A,{size:24})),r.createElement("div",{className:"card-content"},r.createElement("div",{className:"card-value"},S.pending),r.createElement("div",{className:"card-label"},"Pending")))),r.createElement("div",{className:"requests-table-container"},r.createElement("table",{className:"requests-table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"PTO Date"),r.createElement("th",null,"Leave Type"),r.createElement("th",null,"Period"),r.createElement("th",null,"Days"),r.createElement("th",null,"Reason"),r.createElement("th",null,"Status"),p&&r.createElement("th",null,"Actions"))),r.createElement("tbody",null,b.map((e=>r.createElement("tr",{key:e.id},r.createElement("td",null,new Date(e.start_date).toLocaleDateString()),r.createElement("td",null,r.createElement("span",{className:"leave-type ".concat(e.leave_type)},e.leave_type)),r.createElement("td",null,e.start_date===e.end_date?new Date(e.start_date).toLocaleDateString():"".concat(new Date(e.start_date).toLocaleDateString()," - ").concat(new Date(e.end_date).toLocaleDateString())),r.createElement("td",null,e.total_days),r.createElement("td",null,e.reason),r.createElement("td",null,r.createElement("span",{className:"status-badge status-".concat(e.status)},e.status)),p&&r.createElement("td",{className:"actions"},r.createElement("button",{onClick:()=>(e=>{_(e)})(e),className:"action-btn edit",title:"Edit request"},r.createElement(c.A,{size:16})),r.createElement("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this PTO request?"))try{const r=await(0,o.invoke)("adminDeletePTORequest",{requestId:e.id,adminId:a.accountId,reason:"Admin deletion"});r.success?(t("PTO request deleted successfully"),D()):t(r.message||"Failed to delete request","error")}catch(e){t("Failed to delete PTO request","error")}})(e),className:"action-btn delete",title:"Delete request"},r.createElement(m.A,{size:16})))))),0===b.length&&r.createElement("tr",null,r.createElement("td",{colSpan:p?7:6,className:"empty-state"},r.createElement("div",{className:"empty-content"},r.createElement(n.A,{size:24}),r.createElement("p",null,"No PTO requests found for this period")))))))),!g&&r.createElement("div",{className:"empty-state"},r.createElement("div",{className:"empty-content"},r.createElement(i.A,{size:32}),r.createElement("p",null,"Select a user to view their PTO requests"))),k&&r.createElement(u.A,{request:k,onClose:()=>_(null),onSave:async e=>{t("PTO request updated successfully"),D()},currentUser:a}))}},4506:(e,a,t)=>{t.d(a,{A:()=>b});var r=t(6540),n=t(2307),s=t(8697),l=t(418),c=t(8686),m=t(3893),i=t(4471),o=t(2708),d=t(7235),u=t(6069),p=t(5143),v=t(808),g=t(2321);function y(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function E(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?y(Object(t),!0).forEach((function(a){f(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function f(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const b=e=>{var a,t,y,f,b;let{selectedDates:h=[],onClose:N,onSubmit:w,currentUser:k,currentUserData:_,userManager:D,allUsers:S=[],allTeams:T=[],allRequests:A=[],isAdmin:O=!1,isAdminMode:C=!1}=e;const[P,j]=(0,r.useState)({targetUser:k,manager:D,startDate:h[0]||"",endDate:h[h.length-1]||"",reason:"",dailySchedules:[]}),[x,U]=(0,r.useState)({}),[q,I]=(0,r.useState)(!1);(0,r.useEffect)((()=>{I(!O&&!_)}),[O,_]);const L=e=>{if(!e)return null;const a=S.find((a=>a.jira_account_id===e.accountId||a.email_address===e.emailAddress));if(null==a||!a.team_id)return null;const t=T.find((e=>e.id===a.team_id));return(null==t?void 0:t.manager)||null};(0,r.useEffect)((()=>{(()=>{let e=[];if(h.length>0)e=h;else if(P.startDate&&P.endDate){const a=new Date(P.startDate),t=new Date(P.endDate);e=[];for(let r=new Date(a);r<=t;r.setDate(r.getDate()+1))e.push(r.toISOString().split("T")[0])}const a=e.map((e=>({date:e,type:"FULL_DAY",leaveType:"vacation"})));j((t=>E(E({},t),{},{targetUser:O?t.targetUser:k,manager:L(O?t.targetUser:k)||D||t.manager,startDate:e[0]||"",endDate:e[e.length-1]||"",dailySchedules:a})))})()}),[h,k,D,O,S,T]),(0,r.useEffect)((()=>{if(P.startDate&&P.endDate){const e=new Date(P.startDate),a=new Date(P.endDate),t=[];for(let r=new Date(e);r<=a;r.setDate(r.getDate()+1))t.push(r.toISOString().split("T")[0]);const r=P.dailySchedules.filter((e=>t.includes(e.date))),n=t.filter((e=>!r.find((a=>a.date===e)))).map((e=>({date:e,type:"FULL_DAY",leaveType:"vacation"})));j((e=>E(E({},e),{},{dailySchedules:[...r,...n].sort(((e,a)=>new Date(e.date)-new Date(a.date)))})))}}),[P.startDate,P.endDate]);const R=(e,a,t)=>{j((r=>E(E({},r),{},{dailySchedules:r.dailySchedules.map(((r,n)=>n===e?E(E({},r),{},{[a]:t}):r))})))},z=[{value:"FULL_DAY",label:"Full Day (8h)"},{value:"HALF_DAY_MORNING",label:"Morning Half (4h)"},{value:"HALF_DAY_AFTERNOON",label:"Afternoon Half (4h)"}],F=[{value:"vacation",label:"🏖️ Vacation",emoji:"🏖️"},{value:"sick",label:"🤒 Sick Leave",emoji:"🤒"},{value:"personal",label:"👤 Personal Day",emoji:"👤"},{value:"holiday",label:"🎉 Holiday",emoji:"🎉"},{value:"other leave type",label:"📝 Other Leave Type",emoji:"📝"}],M={totalDays:P.dailySchedules.reduce(((e,a)=>e+("FULL_DAY"===a.type?1:.5)),0),totalHours:P.dailySchedules.reduce(((e,a)=>e+("FULL_DAY"===a.type?8:4)),0),leaveTypeBreakdown:P.dailySchedules.reduce(((e,a)=>(e[a.leaveType]=(e[a.leaveType]||0)+("FULL_DAY"===a.type?1:.5),e)),{}),workingDays:P.dailySchedules.length,dateRange:P.startDate&&P.endDate?"".concat(new Date(P.startDate).toLocaleDateString()," - ").concat(new Date(P.endDate).toLocaleDateString()):""};return r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content pto-submission-modal"},r.createElement("div",{className:"modal-header"},r.createElement("h3",{className:"modal-title"},r.createElement(n.A,{size:20}),O?"Create PTO Request (Admin)":"Submit PTO Request"),r.createElement("button",{onClick:N,className:"modal-close"},r.createElement(s.A,{size:20}))),r.createElement("div",{className:"modal-body"},q&&r.createElement("div",{className:"alert alert-warning"},r.createElement(l.A,{size:20}),r.createElement("div",null,r.createElement("strong",null,"User Not in System"),r.createElement("p",null,"Your user profile is not set up in the team management system. Please contact HR to complete your setup."))),r.createElement("div",{className:"form-section"},r.createElement("label",{className:"form-label"},"Employee ",O?"*":""),O?r.createElement(p.A,{selectedUser:P.targetUser,onSelect:async e=>{if(e)try{const a=await(0,g.invoke)("getUsers"),t=(a.success&&a.data||[]).find((a=>a.jira_account_id===e.accountId||a.email_address===e.emailAddress));j(t?e=>E(E({},e),{},{targetUser:t}):a=>E(E({},a),{},{targetUser:e}))}catch(a){console.error("Failed to get user details:",a),j((a=>E(E({},a),{},{targetUser:e})))}else j((e=>E(E({},e),{},{targetUser:null})))},placeholder:"Search and select employee",required:!0,error:x.targetUser,useBackendSearch:!0}):r.createElement("div",{className:"user-display-card"},r.createElement("div",{className:"user-avatar-large"},null!=k&&k.avatarUrl?r.createElement("img",{src:k.avatarUrl,alt:k.displayName}):r.createElement("div",{className:"avatar-placeholder-large"},(null==k||null===(a=k.displayName)||void 0===a?void 0:a.charAt(0))||r.createElement(c.A,{size:20}))),r.createElement("div",{className:"user-info-detailed"},r.createElement("div",{className:"user-name-large"},null==k?void 0:k.displayName),r.createElement("div",{className:"user-email-large"},null==k?void 0:k.emailAddress),(null==_?void 0:_.team_id)&&r.createElement("div",{className:"user-team"},r.createElement(m.A,{size:14}),(null===(t=T.find((e=>e.id===_.team_id)))||void 0===t?void 0:t.name)||"Team Member"))),x.targetUser&&r.createElement("div",{className:"error-text"},x.targetUser)),r.createElement("div",{className:"form-section"},r.createElement("label",{className:"form-label"},"Manager *"),P.manager?r.createElement("div",{className:"user-display-card manager-display"},r.createElement("div",{className:"user-avatar-large"},P.manager.avatarUrl?r.createElement("img",{src:P.manager.avatarUrl,alt:P.manager.displayName}):r.createElement("div",{className:"avatar-placeholder-large"},(null===(y=P.manager.displayName)||void 0===y?void 0:y.charAt(0))||r.createElement(c.A,{size:20}))),r.createElement("div",{className:"user-info-detailed"},r.createElement("div",{className:"user-name-large"},P.manager.displayName),r.createElement("div",{className:"user-email-large"},P.manager.emailAddress),r.createElement("div",{className:"manager-badge"},r.createElement(i.A,{size:14}),"Approving Manager")),O&&r.createElement("button",{type:"button",onClick:()=>j((e=>E(E({},e),{},{manager:null}))),className:"btn btn-sm btn-secondary",title:"Change Manager"},"Change")):r.createElement(p.A,{selectedUser:P.manager,onSelect:e=>j((a=>E(E({},a),{},{manager:e}))),placeholder:"Search and select approving manager",required:!0,error:x.manager,useBackendSearch:!0}),x.manager&&r.createElement("div",{className:"error-text"},x.manager)),r.createElement("div",{className:"form-section"},r.createElement("div",{className:"form-row"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"form-label"},"Start Date *"),r.createElement("input",{type:"date",value:P.startDate,onChange:e=>j((a=>E(E({},a),{},{startDate:e.target.value}))),className:"form-control ".concat(x.startDate?"error":""),min:(new Date).toISOString().split("T")[0]}),x.startDate&&r.createElement("div",{className:"error-text"},x.startDate)),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"form-label"},"End Date *"),r.createElement("input",{type:"date",value:P.endDate,onChange:e=>j((a=>E(E({},a),{},{endDate:e.target.value}))),className:"form-control ".concat(x.endDate?"error":""),min:P.startDate||(new Date).toISOString().split("T")[0]}),x.endDate&&r.createElement("div",{className:"error-text"},x.endDate)))),r.createElement("div",{className:"form-section"},r.createElement("label",{className:"form-label"},"Reason (Optional)"),r.createElement("textarea",{value:P.reason,onChange:e=>j((a=>E(E({},a),{},{reason:e.target.value}))),className:"form-control",rows:"3",placeholder:"Please provide additional details about your PTO request..."})),P.dailySchedules.length>0&&r.createElement("div",{className:"form-section"},r.createElement("div",{className:"schedule-header"},r.createElement("label",{className:"form-label"},"Schedule Details"),r.createElement("div",{className:"quick-actions"},r.createElement("span",{className:"quick-actions-label"},"Apply to all:"),F.map((e=>r.createElement("button",{key:e.value,type:"button",onClick:()=>{return a=e.value,void j((e=>E(E({},e),{},{dailySchedules:e.dailySchedules.map((e=>E(E({},e),{},{leaveType:a})))})));var a},className:"btn btn-sm btn-secondary quick-action-btn",title:"Mark all days as ".concat(e.label)},r.createElement("span",null,e.emoji),r.createElement("span",null,e.value)))))),r.createElement("div",{className:"schedule-list"},P.dailySchedules.map(((e,a)=>r.createElement("div",{key:e.date,className:"schedule-day-row"},r.createElement("div",{className:"schedule-day-info"},r.createElement("div",{className:"day-date"},new Date(e.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}))),r.createElement("div",{className:"schedule-controls"},r.createElement("select",{value:e.leaveType,onChange:e=>R(a,"leaveType",e.target.value),className:"form-control schedule-select"},F.map((e=>r.createElement("option",{key:e.value,value:e.value},e.label)))),r.createElement("select",{value:e.type,onChange:e=>R(a,"type",e.target.value),className:"form-control schedule-select"},z.map((e=>r.createElement("option",{key:e.value,value:e.value},e.label)))),r.createElement("button",{type:"button",onClick:()=>(e=>{j((a=>E(E({},a),{},{dailySchedules:a.dailySchedules.filter(((a,t)=>t!==e))})));const a=P.dailySchedules.filter(((a,t)=>t!==e));if(a.length>0){const e=a.map((e=>e.date)).sort();j((a=>E(E({},a),{},{startDate:e[0],endDate:e[e.length-1]})))}})(a),className:"btn btn-sm btn-danger",title:"Remove this day"},r.createElement(o.A,{size:14}))))))),x.dailySchedules&&r.createElement("div",{className:"error-text"},x.dailySchedules)),P.dailySchedules.length>0&&r.createElement("div",{className:"form-section"},r.createElement("div",{className:"request-summary-card"},r.createElement("div",{className:"summary-header"},r.createElement("h4",null,"Request Summary"),r.createElement("div",{className:"summary-status"},r.createElement(d.A,{size:16}),"Ready to Submit")),r.createElement("div",{className:"summary-content"},r.createElement("div",{className:"summary-metrics"},r.createElement("div",{className:"metric-item"},r.createElement("div",{className:"metric-value"},M.totalDays),r.createElement("div",{className:"metric-label"},"Days Off")),r.createElement("div",{className:"metric-item"},r.createElement("div",{className:"metric-value"},M.totalHours,"h"),r.createElement("div",{className:"metric-label"},"Total Hours")),r.createElement("div",{className:"metric-item"},r.createElement("div",{className:"metric-value"},M.workingDays),r.createElement("div",{className:"metric-label"},"Scheduled Days"))),r.createElement("div",{className:"summary-details"},r.createElement("div",{className:"detail-row"},r.createElement("span",{className:"detail-label"},r.createElement(u.A,{size:16}),"Date Range:"),r.createElement("span",{className:"detail-value"},M.dateRange)),r.createElement("div",{className:"detail-row"},r.createElement("span",{className:"detail-label"},r.createElement(c.A,{size:16}),O?"Employee:":"Approver:"),r.createElement("span",{className:"detail-value"},O?(null===(f=P.targetUser)||void 0===f?void 0:f.displayName)||"Not selected":(null===(b=P.manager)||void 0===b?void 0:b.displayName)||"Not selected")),Object.keys(M.leaveTypeBreakdown).length>0&&r.createElement("div",{className:"detail-row"},r.createElement("span",{className:"detail-label"},r.createElement(n.A,{size:16}),"Leave Types:"),r.createElement("div",{className:"leave-type-tags"},Object.entries(M.leaveTypeBreakdown).map((e=>{let[a,t]=e;return r.createElement("span",{key:a,className:"leave-type-tag"},(0,v.S0)(a)," ",a,": ",t," day",1!==t?"s":"")})))))))),x.duplicate&&r.createElement("div",{className:"alert alert-error"},r.createElement(l.A,{size:20}),r.createElement("div",null,r.createElement("strong",null,"Scheduling Conflict"),r.createElement("p",null,x.duplicate))),r.createElement("div",{className:"form-actions"},r.createElement("button",{type:"button",onClick:N,className:"btn btn-secondary"},"Cancel"),r.createElement("button",{type:"button",onClick:()=>{var e;if(!(()=>{var e,a;const t={};P.targetUser||(t.targetUser="User is required"),P.manager||(t.manager="Manager is required"),P.startDate||(t.startDate="Start date is required"),P.endDate||(t.endDate="End date is required"),P.startDate&&P.endDate&&new Date(P.startDate)>new Date(P.endDate)&&(t.endDate="End date must be after start date"),0===P.dailySchedules.length&&(t.dailySchedules="Please select at least one day");const r=(null===(e=P.targetUser)||void 0===e?void 0:e.accountId)||(null===(a=P.targetUser)||void 0===a?void 0:a.jira_account_id);if(r){const e=P.dailySchedules.filter((e=>A.some((a=>{var t;return(a.requester_id===r||a.requester_email===(null===(t=P.targetUser)||void 0===t?void 0:t.emailAddress))&&"declined"!==a.status&&a.start_date<=e.date&&a.end_date>=e.date}))));e.length>0&&(t.duplicate="This user already has PTO requests for: ".concat(e.map((e=>new Date(e.date).toLocaleDateString())).join(", ")))}return U(t),0===Object.keys(t).length})())return;const a=(t=P.targetUser)?E(E({},t),{},{accountId:t.accountId||t.jira_account_id||t.id,displayName:t.displayName||t.display_name||t.name,emailAddress:t.emailAddress||t.email_address,avatarUrl:t.avatarUrl||t.avatar_url}):null;var t;if(!(a&&a.accountId&&a.displayName&&a.emailAddress))return void U((e=>E(E({},e),{},{targetUser:"Please select a valid user."})));const r=P.dailySchedules.reduce(((e,a)=>e+("FULL_DAY"===a.type?1:.5)),0),n=P.dailySchedules.reduce(((e,a)=>e+("FULL_DAY"===a.type?8:4)),0),s=E({reporter:a,manager:(l=P.manager,l?E(E({},l),{},{accountId:l.accountId||l.jira_account_id||l.id,displayName:l.displayName||l.display_name||l.name,emailAddress:l.emailAddress||l.email_address,avatarUrl:l.avatarUrl||l.avatar_url}):null),startDate:P.startDate,endDate:P.endDate,leaveType:(null===(e=P.dailySchedules[0])||void 0===e?void 0:e.leaveType)||"vacation",reason:P.reason,dailySchedules:P.dailySchedules,totalDays:r,totalHours:n},O&&{targetUser:a});var l;w(s)},disabled:!P.targetUser||!P.manager||!P.startDate||!P.endDate||0===P.dailySchedules.length||!!x.duplicate||q,className:"btn btn-primary"},O?"Create PTO Request":"Submit Request")),O&&r.createElement("div",{className:"admin-notice"},r.createElement("strong",null,"Admin Mode:")," This PTO request will be created with admin privileges and may be automatically approved."),0===P.dailySchedules.length&&r.createElement("div",{className:"instructions"},r.createElement("strong",null,"Next Step:")," Select start and end dates to configure your PTO schedule, or return to the calendar to select specific dates."))))}},5143:(e,a,t)=>{t.d(a,{A:()=>m});var r=t(6540),n=t(8686),s=t(8697),l=t(8445);function c(e,a){let t;return function(){for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];clearTimeout(t),t=setTimeout((()=>{clearTimeout(t),e(...n)}),a)}}const m=e=>{var a;let{selectedUser:m,onSelect:i,placeholder:o="Search for a user",disabled:d=!1,required:u=!1,error:p=null,allUsers:v=[],filterBy:g="all",useBackendSearch:y=!1}=e;const[E,f]=(0,r.useState)(!1),[b,h]=(0,r.useState)(""),[N,w]=(0,r.useState)([]),[k,_]=(0,r.useState)(!1),[D,S]=(0,r.useState)(null),T=(0,r.useRef)(null),A=(0,r.useRef)(null),O=(0,r.useCallback)(c((async e=>{if(e.length<1)w([]);else{_(!0),S(null);try{const{invoke:a}=await Promise.resolve().then(t.t.bind(t,2321,23)),r=await a("searchDatabaseUsers",{query:e,filterBy:g,startAt:0,maxResults:50});if(!r.success||!r.data)throw new Error(r.message||"Failed to search users");w(r.data.users||[])}catch(e){console.error("❌ Error searching users:",e),S(e.message),w([])}finally{_(!1)}}}),300),[g]),C=(0,r.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=[...v];if("withTeam"===g?a=a.filter((e=>(e.team_ids||[]).length>0)):"withoutTeam"===g&&(a=a.filter((e=>!(e.team_ids&&e.team_ids.length>0)))),e.length>=1){const t=e.toLowerCase();a=a.filter((e=>{const a=(e.display_name||e.displayName||"").toLowerCase(),r=(e.email_address||e.emailAddress||"").toLowerCase(),n=(e.first_name||e.firstName||"").toLowerCase(),s=(e.last_name||e.lastName||"").toLowerCase();return a.includes(t)||r.includes(t)||n.includes(t)||s.includes(t)}))}a.sort(((e,a)=>{const t=(e.display_name||e.displayName||"").toLowerCase(),r=(a.display_name||a.displayName||"").toLowerCase();return t.localeCompare(r)})),w(a.slice(0,50))}),[v,g]);(0,r.useEffect)((()=>{y||C(b)}),[C,b,y]);(0,r.useEffect)((()=>{const e=e=>{T.current&&!T.current.contains(e.target)&&(f(!1),h(""),y||w([]))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[y]),(0,r.useEffect)((()=>{const e=e=>{"Escape"===e.key&&E&&(f(!1),h(""),y||w([]))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[E,y]);const P=e=>e.team_name||"",j=(0,r.useCallback)(c((async e=>{if(e)try{let a;a=y?await invoke("searchDatabaseUsers",{query:e,filterBy:g,startAt:0,maxResults:50}):await invoke("getInternalJiraUsers",{startAt:0,maxResults:50}),a.success?w(a.data.users||[]):w([])}catch(e){console.error("Error searching users:",e),w([])}else w([])}),300),[y,g]);return(0,r.useEffect)((()=>{b?j(b):w([])}),[b,j]),r.createElement("div",{className:"user-picker-container",ref:T},r.createElement("div",{onClick:()=>{d||(f(!0),setTimeout((()=>{var e;null===(e=A.current)||void 0===e||e.focus()}),100))},className:"user-picker-input ".concat(d?"user-picker-input-disabled":""," ").concat(E?"user-picker-input-focused":""," ").concat(p?"user-picker-input-error":"")},m?r.createElement("div",{className:"user-picker-selected"},r.createElement("div",{className:"user-picker-avatar"},m.avatarUrl||m.avatar_url?r.createElement("img",{src:m.avatarUrl||m.avatar_url,alt:m.displayName||m.display_name,className:"user-picker-avatar-img"}):r.createElement("span",{className:"user-picker-avatar-text"},(null===(a=m.displayName||m.display_name)||void 0===a?void 0:a.charAt(0))||r.createElement(n.A,{size:16}))),r.createElement("div",{className:"user-picker-user-info"},r.createElement("div",{className:"user-picker-user-name"},m.displayName||m.display_name),r.createElement("div",{className:"user-picker-user-email"},m.emailAddress||m.email_address)),!d&&r.createElement("button",{onClick:e=>{e.stopPropagation(),i(null)},className:"user-picker-clear-btn",type:"button"},r.createElement(s.A,{size:16}))):r.createElement("div",{className:"user-picker-placeholder"},r.createElement(l.A,{size:16}),r.createElement("span",null,o),u&&r.createElement("span",{className:"user-picker-required"},"*"))),p&&r.createElement("div",{className:"user-picker-error"},p),E&&r.createElement("div",{className:"user-picker-dropdown"},r.createElement("div",{className:"user-picker-search-container"},r.createElement("div",{className:"user-picker-search-input-wrapper"},r.createElement(l.A,{size:16,className:"user-picker-search-icon"}),r.createElement("input",{ref:A,type:"text",value:b,onChange:e=>{const a=e.target.value;h(a),y?O(a):C(a)},placeholder:"Type to search users...",className:"user-picker-search-input"}))),r.createElement("div",{className:"user-picker-results"},k?r.createElement("div",{className:"user-picker-loading"},r.createElement("div",{className:"user-picker-loading-spinner"}),r.createElement("div",{className:"user-picker-loading-text"},"Searching...")):D?r.createElement("div",{className:"user-picker-empty"},r.createElement("div",{className:"user-picker-empty-text"},"Error: ",D)):0!==v.length||y?b.length>=1&&0===N.length?r.createElement("div",{className:"user-picker-empty"},r.createElement("div",{className:"user-picker-empty-text"},"No users found")):b.length<1?r.createElement("div",{className:"user-picker-empty"},r.createElement("div",{className:"user-picker-empty-text"},"Type to search users...")):r.createElement("div",{className:"user-picker-user-list"},N.map((e=>{var a;return r.createElement("div",{key:e.id,onClick:()=>(e=>{i(e),f(!1),h(""),w([])})(e),className:"user-picker-user-option"},r.createElement("div",{className:"user-picker-avatar"},e.avatarUrl||e.avatar_url?r.createElement("img",{src:e.avatarUrl||e.avatar_url,alt:e.displayName||e.display_name,className:"user-picker-avatar-img"}):r.createElement("span",{className:"user-picker-avatar-text"},(null===(a=e.displayName||e.display_name)||void 0===a?void 0:a.charAt(0))||r.createElement(n.A,{size:16}))),r.createElement("div",{className:"user-picker-option-info"},r.createElement("div",{className:"user-picker-option-name"},e.displayName||e.display_name),r.createElement("div",{className:"user-picker-option-email"},e.emailAddress||e.email_address),P(e)&&r.createElement("div",{className:"user-picker-option-team"},"Team: ",P(e))))})),50===N.length&&r.createElement("div",{className:"user-picker-more-results"},"Showing first 50 results. Narrow your search for more specific results.")):r.createElement("div",{className:"user-picker-empty"},r.createElement("div",{className:"user-picker-empty-text"},"No users available")))))}},5839:(e,a,t)=>{t.d(a,{A:()=>y});var r=t(6540),n=t(2321),s=t(5143),l=t(8309),c=t(1999),m=t(5977),i=t(8686),o=t(7677),d=t(4809),u=t.n(d);function p(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?p(Object(t),!0).forEach((function(a){g(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function g(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const y=function(e){let{isOpen:a,onClose:t,teams:d,users:p,onSaveTeam:g,onDeleteTeam:y,onSaveUser:E,onDeleteUser:f,showNotification:b,onRefresh:h}=e;const[N,w]=(0,r.useState)("teams"),[k,_]=(0,r.useState)("list"),[D,S]=(0,r.useState)(null),[T,A]=(0,r.useState)(null),[O,C]=(0,r.useState)(!1),[P,j]=(0,r.useState)([]),[x,U]=(0,r.useState)(!1),[q,I]=(0,r.useState)({startAt:0,maxResults:50,total:0,isLast:!0}),[L,R]=(0,r.useState)([]),[z,F]=(0,r.useState)(!1),[M,W]=(0,r.useState)({name:"",description:"",manager:null,department:"",color:"#667eea"}),[V,B]=(0,r.useState)({firstName:"",lastName:"",displayName:"",emailAddress:"",jiraAccountId:"",employmentType:"full-time",hireDate:"",teamMemberships:[],capacity:40}),[Y,J]=(0,r.useState)([{dayOfWeek:1,dayName:"Monday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:2,dayName:"Tuesday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:3,dayName:"Wednesday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:4,dayName:"Thursday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:5,dayName:"Friday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:6,dayName:"Saturday",isWorkingDay:!1,startTime:"",endTime:"",hoursPerDay:0},{dayOfWeek:7,dayName:"Sunday",isWorkingDay:!1,startTime:"",endTime:"",hoursPerDay:0}]),[H,G]=(0,r.useState)({}),[K,Q]=(0,r.useState)("Member");(0,r.useEffect)((()=>{"users"===N&&"import"===k&&X(0)}),[N,k]);const X=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;0===e&&(U(!0),j([]));try{const a=await(0,n.invoke)("getInternalJiraUsers",{startAt:e,maxResults:50});if(!a.success||!a.data)throw new Error(a.message||"Failed to load Jira users");{const{users:t,total:r,isLast:n}=a.data;if(j((e=>[...e,...t||[]])),I({startAt:e,maxResults:50,total:r||0,isLast:!1!==n}),!n){const a=e+50;await X(a)}}}catch(a){0===e&&(b("Failed to load Jira users: "+a.message,"error"),j([]))}finally{(0===e||x)&&U(!1)}},Z=()=>{W({name:"",description:"",manager:null,department:"",color:"#667eea"}),G({}),S(null)},$=()=>{B({firstName:"",lastName:"",displayName:"",emailAddress:"",jiraAccountId:"",employmentType:"full-time",hireDate:"",teamMemberships:[],capacity:40}),J([{dayOfWeek:1,dayName:"Monday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:2,dayName:"Tuesday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:3,dayName:"Wednesday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:4,dayName:"Thursday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:5,dayName:"Friday",isWorkingDay:!0,startTime:"09:00",endTime:"17:00",hoursPerDay:8},{dayOfWeek:6,dayName:"Saturday",isWorkingDay:!1,startTime:"",endTime:"",hoursPerDay:0},{dayOfWeek:7,dayName:"Sunday",isWorkingDay:!1,startTime:"",endTime:"",hoursPerDay:0}]),G({}),A(null)};(0,r.useEffect)((()=>{(V.firstName||V.lastName)&&B((e=>v(v({},e),{},{displayName:"".concat(V.firstName," ").concat(V.lastName).trim()})))}),[V.firstName,V.lastName]),(0,r.useEffect)((()=>{const e=Y.reduce(((e,a)=>e+(a.isWorkingDay?a.hoursPerDay:0)),0);B((a=>v(v({},a),{},{capacity:e})))}),[Y]);const ee=(e,a)=>{W((t=>v(v({},t),{},{[e]:a}))),H[e]&&G((a=>v(v({},a),{},{[e]:null})))},ae=(e,a)=>{B((t=>v(v({},t),{},{[e]:a}))),H[e]&&G((a=>v(v({},a),{},{[e]:null})))},te=(e,a,t)=>{J((r=>{const n=[...r];if(n[e]=v(v({},n[e]),{},{[a]:t}),"startTime"===a||"endTime"===a){const a=n[e];if(a.startTime&&a.endTime&&a.isWorkingDay){const t=new Date("2000-01-01T".concat(a.startTime)),r=(new Date("2000-01-01T".concat(a.endTime))-t)/36e5;n[e].hoursPerDay=Math.max(0,r)}}return"isWorkingDay"!==a||t||(n[e].startTime="",n[e].endTime="",n[e].hoursPerDay=0),n}))},[re,ne]=(0,r.useState)([]),[se,le]=(0,r.useState)(!1),[ce,me]=(0,r.useState)(""),ie=e=>p.some((a=>(a.team_memberships||[]).some((a=>a.team_id===e&&"Manager"===a.role)))),oe=["type","id","name","jira_account_id","first_name","last_name","display_name","email","employment_type","hire_date","team_memberships","capacity","department","description","color","manager","isAdmin"];if(!a)return null;const de=(()=>{const e=new Set;return p.forEach((a=>{a.jira_account_id&&e.add(a.jira_account_id),a.accountId&&e.add(a.accountId),a.email_address&&e.add(a.email_address.toLowerCase()),a.emailAddress&&e.add(a.emailAddress.toLowerCase())})),P.filter((a=>{var t;if(!1===a.active)return!1;const r=a.accountId,n=null===(t=a.emailAddress)||void 0===t?void 0:t.toLowerCase();return!(e.has(r)||n&&e.has(n))}))})();return r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content team-management-modal"},r.createElement("div",{className:"modal-header"},r.createElement("h3",null,"Team & User Management"),r.createElement("div",{className:"header-actions"},r.createElement("button",{className:"btn btn-secondary",onClick:()=>{const e=[...d.map((e=>({type:"team",id:e.id,name:e.name,jira_account_id:"",first_name:"",last_name:"",display_name:"",email:"",employment_type:"",hire_date:"",team_memberships:"",capacity:"",department:e.department||"",description:e.description||"",color:e.color||"",manager:e.manager||"",isAdmin:""}))),...p.map((e=>({type:"user",id:e.id,name:e.name||e.display_name||"",jira_account_id:e.jira_account_id||"",first_name:e.first_name||"",last_name:e.last_name||"",display_name:e.display_name||"",email:e.email_address||"",employment_type:e.employment_type||"",hire_date:e.hire_date||"",team_memberships:(e.team_memberships||[]).map((e=>{var a;return"".concat((null===(a=d.find((a=>a.id===e.team_id)))||void 0===a?void 0:a.name)||e.team_id,":").concat(e.role)})).join(","),capacity:e.capacity||"",department:e.department||"",description:"",color:"",manager:"",isAdmin:!0===e.isAdmin?"TRUE":"FALSE"})))],a=u().unparse(e,{columns:oe}),t=new Blob([a],{type:"text/csv"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download="teams-and-users-".concat((new Date).toISOString().split("T")[0],".csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)},disabled:O},r.createElement(l.A,{size:16})," Export CSV"),r.createElement("label",{className:"btn btn-secondary",style:{marginLeft:8}},r.createElement("input",{type:"file",accept:".csv",onChange:async e=>{const a=e.target.files[0];a&&u().parse(a,{header:!0,skipEmptyLines:!0,complete:async a=>{C(!0);try{const e=[],t=[];for(const r of a.data)if("team"===r.type)e.push({id:r.id||(window.crypto&&window.crypto.randomUUID?window.crypto.randomUUID():"team-"+Date.now()+"-"+Math.floor(1e4*Math.random())),name:r.name,department:r.department,description:r.description,color:r.color,manager:r.manager});else if("user"===r.type){let e=[];r.team_memberships&&(e=r.team_memberships.split(",").map((e=>{const[a,t]=e.split(":"),r=d.find((e=>e.name===a.trim()));return{team_id:r?r.id:a.trim(),role:(t||"Member").trim()}}))),t.push({id:r.id,name:r.name,jira_account_id:r.jira_account_id,displayName:r.display_name,first_name:r.first_name,last_name:r.last_name,emailAddress:r.email,department:r.department,hireDate:r.hire_date,employmentType:r.employment_type,team_memberships:e,capacity:r.capacity,isAdmin:"TRUE"===r.isAdmin||"true"===r.isAdmin})}const r=await(0,n.invoke)("getTeams"),s=r.success?r.data:[];for(const a of e){s.find((e=>e.id===a.id))?await(0,n.invoke)("updateTeam",a):await(0,n.invoke)("createTeam",a)}for(const e of t)await E(e);b("CSV import completed successfully"),h&&h()}catch(e){b("Failed to import CSV: "+e.message,"error")}finally{C(!1),e.target.value=""}}})},style:{display:"none"},disabled:O}),r.createElement(c.A,{size:16})," Import CSV"),r.createElement("button",{className:"modal-close",onClick:t},"×"))),r.createElement("div",{className:"modal-body"},r.createElement("div",{className:"team-management-main-tabs"},r.createElement("button",{className:"team-management-main-tab ".concat("teams"===N?"team-management-main-tab-active":""),onClick:()=>{w("teams"),_("list"),Z(),$()}},"👥 Teams (",d.length,")"),r.createElement("button",{className:"team-management-main-tab ".concat("users"===N?"team-management-main-tab-active":""),onClick:()=>{w("users"),_("list"),Z(),$()}},"👤 Users (",p.length,")")),"teams"===N&&r.createElement(r.Fragment,null,r.createElement("div",{className:"team-management-sub-tabs"},r.createElement("button",{className:"team-management-sub-tab ".concat("list"===k?"team-management-sub-tab-active":""),onClick:()=>_("list")},"Teams List"),r.createElement("button",{className:"team-management-sub-tab ".concat("form"===k?"team-management-sub-tab-active":""),onClick:()=>{_("form"),Z()}},D?"Edit Team":"Add New Team")),"list"===k&&r.createElement("div",{className:"team-management-teams-section"},0===d.length?r.createElement("div",{className:"team-management-empty-state"},r.createElement("div",{className:"team-management-empty-icon"},"👥"),r.createElement("h4",null,"No Teams Created"),r.createElement("p",null,"Create your first team to organize your resources"),r.createElement("button",{className:"btn btn-primary",onClick:()=>{Z(),_("form")}},"Create First Team")):r.createElement("div",{className:"team-management-teams-grid"},d.map((e=>{var a,t;const n=(s=e.id,p.filter((e=>(e.team_memberships||[]).some((e=>e.team_id===s)))));var s;return r.createElement("div",{key:e.id,className:"team-management-team-card",style:{borderLeftColor:e.color}},r.createElement("div",{className:"team-management-team-header"},r.createElement("h4",null,e.name),r.createElement("div",{className:"team-management-team-actions"},r.createElement("button",{className:"btn btn-sm btn-secondary",onClick:()=>(e=>{S(e);let a=null;e.manager&&("string"==typeof e.manager?a=p.find((a=>a.display_name===e.manager||a.displayName===e.manager||a.name===e.manager))||null:"object"==typeof e.manager&&(a=e.manager)),W({name:e.name||"",description:e.description||"",manager:a,department:e.department||"",color:e.color||"#667eea"}),_("form")})(e),disabled:O},"Edit"),r.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>(async(e,a)=>{if(window.confirm('Are you sure you want to delete the team "'.concat(a,'"? This action cannot be undone.'))){C(!0);try{await y(e),b("Team deleted successfully"),h&&h()}catch(e){b("Failed to delete team","error")}finally{C(!1)}}})(e.id,e.name),disabled:O},"Delete"))),e.description&&r.createElement("p",{className:"team-management-team-description"},e.description),r.createElement("div",{className:"team-management-team-meta"},e.department&&r.createElement("span",{className:"team-management-team-department"},"📁 ",e.department),(e.manager||(null===(a=e.manager)||void 0===a?void 0:a.displayName))&&r.createElement("span",{className:"team-management-team-lead"},"👤 ",null===(t=e.manager)||void 0===t?void 0:t.displayName),r.createElement("span",{className:"team-management-member-count"},n.length," members")),n.length>0&&r.createElement("div",{className:"team-management-team-members-preview"},r.createElement("h5",null,"Members:"),r.createElement("div",{className:"team-management-members-list"},n.slice(0,3).map((e=>{var a;return r.createElement("div",{key:e.id,className:"team-management-member-preview"},r.createElement("div",{className:"team-management-member-avatar-small"},e.avatar_url||e.avatarUrl?r.createElement("img",{src:e.avatar_url||e.avatarUrl,alt:e.display_name||e.displayName}):r.createElement("div",{className:"team-management-avatar-placeholder-small"},(null===(a=e.display_name||e.displayName||e.name)||void 0===a?void 0:a.charAt(0))||"?")),r.createElement("span",{className:"team-management-member-name-small"},e.display_name||e.displayName||e.name))})),n.length>3&&r.createElement("div",{className:"team-management-more-members"},"+",n.length-3," more"))))})))),"form"===k&&r.createElement("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return M.name.trim()||(e.name="Team name is required"),G(e),0===Object.keys(e).length})()){C(!0);try{const e={id:null==D?void 0:D.id,name:M.name,description:M.description,manager:M.manager,department:M.department,color:M.color,members:(null==D?void 0:D.members)||[]};console.log("Submitting team:",e),await g(e),b(D?"Team updated successfully":"Team created successfully"),Z(),_("list"),h&&h()}catch(e){b("Failed to save team","error")}finally{C(!1)}}},className:"team-management-team-form"},r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"team-name"},"Team Name *"),r.createElement("input",{type:"text",id:"team-name",className:"form-control ".concat(H.name?"form-control-error":""),value:M.name,onChange:e=>ee("name",e.target.value),placeholder:"Enter team name",disabled:O}),H.name&&r.createElement("span",{className:"form-error-text"},H.name)),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"team-description"},"Description"),r.createElement("textarea",{id:"team-description",className:"form-control",value:M.description,onChange:e=>ee("description",e.target.value),placeholder:"Brief description of the team's purpose",rows:"3",disabled:O})),r.createElement("div",{className:"form-row"},r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"team-manager"},"Manager"),r.createElement(s.A,{selectedUser:M.manager,onSelect:async e=>{W((a=>v(v({},a),{},{manager:e})))},placeholder:"Search and select manager",disabled:O,error:H.manager,useBackendSearch:!0}),H.manager&&r.createElement("span",{className:"form-error-text"},H.manager)),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"department"},"Department"),r.createElement("select",{id:"department",className:"form-control",value:M.department,onChange:e=>ee("department",e.target.value),disabled:O},r.createElement("option",{value:""},"Select Department"),["Product","Devops","RebelCare","Strategy","Service Delivery","Client Services","Sales","Marketing","Operations","Finance","HR"].map((e=>r.createElement("option",{key:e,value:e},e)))))),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Team Color"),r.createElement("div",{className:"team-management-color-options"},["#667eea","#764ba2","#f093fb","#f5576c","#4facfe","#00f2fe","#43e97b","#38f9d7","#ffecd2","#fcb69f"].map((e=>r.createElement("div",{key:e,className:"team-management-color-option ".concat(M.color===e?"team-management-color-option-selected":""),style:{backgroundColor:e},onClick:()=>!O&&ee("color",e)}))))),r.createElement("div",{className:"form-actions"},r.createElement("button",{type:"submit",className:"btn btn-primary",disabled:O},O?"Saving...":D?"Update Team":"Create Team"),r.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>{Z(),_("list")},disabled:O},"Cancel")))),"users"===N&&r.createElement(r.Fragment,null,r.createElement("div",{className:"team-management-sub-tabs"},r.createElement("button",{className:"team-management-sub-tab ".concat("list"===k?"team-management-sub-tab-active":""),onClick:()=>_("list")},"Users List"),r.createElement("button",{className:"team-management-sub-tab ".concat("form"===k?"team-management-sub-tab-active":""),onClick:()=>{_("form"),$()}},T?"Edit User":"Add New User"),r.createElement("button",{className:"team-management-sub-tab ".concat("import"===k?"team-management-sub-tab-active":""),onClick:()=>_("import")},"Import from Jira (",de.length,")")),"list"===k&&r.createElement("div",{className:"team-management-users-section"},r.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}},r.createElement("h4",null,"Users"),r.createElement("button",{className:"btn btn-primary",disabled:re.length===p.length&&p.length>0,onClick:()=>le(!0)},"Bulk Add to Team")),re.length>0&&r.createElement("button",{className:"btn btn-danger",onClick:async()=>{if(window.confirm("Are you sure you want to delete ".concat(re.length," users? This action cannot be undone."))){C(!0);try{for(const e of re)await f(e);b("".concat(re.length," users deleted successfully")),ne([]),h&&h()}catch(e){b("Failed to delete users: "+e.message,"error")}finally{C(!1)}}},disabled:O,style:{marginBottom:16}},"Delete Selected Users (",re.length,")"),r.createElement("table",{className:"user-table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,r.createElement("input",{type:"checkbox",checked:re.length===p.length&&p.length>0,onChange:e=>ne(e.target.checked?p.map((e=>e.id)):[])})),r.createElement("th",null,"Name"),r.createElement("th",null,"Email"),r.createElement("th",null,"Teams"),r.createElement("th",null,"Actions"))),r.createElement("tbody",null,p.map((e=>r.createElement("tr",{key:e.id},r.createElement("td",null,r.createElement("input",{type:"checkbox",checked:re.includes(e.id),onChange:a=>ne(a.target.checked?[...re,e.id]:re.filter((a=>a!==e.id)))})),r.createElement("td",null,e.display_name||e.displayName||e.name),r.createElement("td",null,e.email_address||e.emailAddress||"-"),r.createElement("td",null,(e.team_memberships||[]).map((e=>{const a=d.find((a=>a.id===e.team_id));return a?"".concat(a.name," (").concat(e.role,")"):e.team_id})).join(", ")),r.createElement("td",null,r.createElement("button",{className:"btn btn-sm btn-secondary",onClick:()=>(e=>{A(e),B({firstName:e.first_name||e.firstName||"",lastName:e.last_name||e.lastName||"",displayName:e.display_name||e.displayName||"",emailAddress:e.email_address||e.emailAddress||"",jiraAccountId:e.jira_account_id||e.accountId||"",employmentType:e.employment_type||e.employmentType||"full-time",hireDate:e.hire_date||e.hireDate||"",teamMemberships:e.team_memberships||[],capacity:e.capacity||40,isAdmin:!0===e.isAdmin}),e.availability&&Array.isArray(e.availability)&&J(e.availability),w("users"),_("form")})(e),disabled:O},"Edit"),r.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>(async(e,a)=>{if(window.confirm('Are you sure you want to delete the user "'.concat(a,'"? This action cannot be undone.'))){C(!0);try{await f(e),b("User deleted successfully"),h&&h()}catch(e){b("Failed to delete user","error")}finally{C(!1)}}})(e.id,e.display_name||e.displayName||e.name),disabled:O},"Delete"))))))),se&&r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content",style:{maxWidth:400,margin:"auto",padding:24}},r.createElement("h4",null,"Add Selected Users to Team"),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Team"),r.createElement("select",{className:"form-control",value:ce,onChange:e=>{me(e.target.value),ie(e.target.value)&&Q("Member")}},r.createElement("option",{value:""},"Select a team"),d.map((e=>r.createElement("option",{key:e.id,value:e.id},e.name))))),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Role"),r.createElement("select",{className:"form-control",value:K,onChange:e=>Q(e.target.value),disabled:ce&&ie(ce)},r.createElement("option",{value:"Member"},"Member"),r.createElement("option",{value:"Manager",disabled:ce&&ie(ce)},"Manager ",ce&&ie(ce)?"(Team already has a manager)":""))),r.createElement("div",{className:"form-actions",style:{marginTop:24}},r.createElement("button",{className:"btn btn-secondary",onClick:()=>le(!1)},"Cancel"),r.createElement("button",{className:"btn btn-primary",disabled:!ce,onClick:async()=>{C(!0);for(const e of re){const a=p.find((a=>a.id===e));a&&!(a.team_memberships||[]).some((e=>e.team_id===ce))&&await E(v(v({},a),{},{team_memberships:[...a.team_memberships||[],{team_id:ce,role:K}]}))}C(!1),le(!1),ne([]),me(""),Q("Member"),h&&h()}},"Add to Team"))))),"form"===k&&r.createElement("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return V.firstName.trim()||(e.firstName="First name is required"),V.lastName.trim()||(e.lastName="Last name is required"),G(e),0===Object.keys(e).length})()){C(!0);try{const e=!0===(null==T?void 0:T.isAdmin),r=!0===V.isAdmin,s={id:null==T?void 0:T.id,first_name:V.firstName,last_name:V.lastName,display_name:V.displayName,email_address:V.emailAddress,jira_account_id:V.jiraAccountId,employment_type:V.employmentType,hire_date:V.hireDate,team_memberships:V.teamMemberships,capacity:V.capacity,availability:Y,isAdmin:r};var a;if(console.log("Submitting user:",s),await E(s),r&&!e)await(0,n.invoke)("addAdminUser",{accountId:s.jira_account_id||s.id||s.accountId,addedBy:null===(a=currentUser)||void 0===a?void 0:a.accountId});else if(!r&&e){var t;await(0,n.invoke)("removeAdminUser",{accountId:s.jira_account_id||s.id||s.accountId,removedBy:null===(t=currentUser)||void 0===t?void 0:t.accountId})}b(T?"User updated successfully":"User created successfully"),$(),_("list"),h&&h()}catch(e){b("Failed to save user","error")}finally{C(!1)}}},className:"team-management-user-form"},r.createElement("div",{className:"form-row"},r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"firstName"},"First Name *"),r.createElement("input",{type:"text",id:"firstName",className:"form-control ".concat(H.firstName?"form-control-error":""),value:V.firstName,onChange:e=>ae("firstName",e.target.value),placeholder:"Enter first name",disabled:O}),H.firstName&&r.createElement("span",{className:"form-error-text"},H.firstName)),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"lastName"},"Last Name *"),r.createElement("input",{type:"text",id:"lastName",className:"form-control ".concat(H.lastName?"form-control-error":""),value:V.lastName,onChange:e=>ae("lastName",e.target.value),placeholder:"Enter last name",disabled:O}),H.lastName&&r.createElement("span",{className:"form-error-text"},H.lastName))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"emailAddress"},"Email Address"),r.createElement("input",{type:"email",id:"emailAddress",className:"form-control ".concat(H.emailAddress?"form-control-error":""),value:V.emailAddress,onChange:e=>ae("emailAddress",e.target.value),placeholder:"Enter email address",disabled:O}),H.emailAddress&&r.createElement("span",{className:"form-error-text"},H.emailAddress)),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"displayName"},"Display Name"),r.createElement("input",{type:"text",id:"displayName",className:"form-control",value:V.displayName,onChange:e=>ae("displayName",e.target.value),placeholder:"Display name (auto-generated from first/last name)",disabled:O})),r.createElement("div",{className:"form-row"},r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"employmentType"},"Employment Type"),r.createElement("select",{id:"employmentType",className:"form-control",value:V.employmentType,onChange:e=>ae("employmentType",e.target.value),disabled:O},r.createElement("option",{value:"full-time"},"Full-time"),r.createElement("option",{value:"part-time"},"Part-time"),r.createElement("option",{value:"contractor"},"Contractor"))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"hireDate"},"Hire Date"),r.createElement("input",{type:"date",id:"hireDate",className:"form-control",value:V.hireDate,onChange:e=>ae("hireDate",e.target.value),disabled:O}))),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Teams & Roles"),d.map((e=>{const a=V.teamMemberships.find((a=>a.team_id===e.id)),t=ie(e.id);return r.createElement("div",{key:e.id,style:{display:"flex",alignItems:"center",marginBottom:8}},r.createElement("input",{type:"checkbox",checked:!!a,onChange:a=>{a.target.checked?B((a=>v(v({},a),{},{teamMemberships:[...a.teamMemberships,{team_id:e.id,role:t?"Member":"Manager"}]}))):B((a=>v(v({},a),{},{teamMemberships:a.teamMemberships.filter((a=>a.team_id!==e.id))})))},disabled:O}),r.createElement("span",{style:{marginLeft:8,marginRight:8}},e.name),a&&r.createElement("select",{value:a.role,onChange:a=>{"Manager"===a.target.value&&t?b("This team already has a manager","error"):B((t=>v(v({},t),{},{teamMemberships:t.teamMemberships.map((t=>t.team_id===e.id?v(v({},t),{},{role:a.target.value}):t))})))},style:{marginLeft:8},disabled:O||t&&"Manager"!==a.role},r.createElement("option",{value:"Member"},"Member"),r.createElement("option",{value:"Manager",disabled:t},"Manager ",t?"(Team already has a manager)":"")))}))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"jiraAccountId"},"Jira Account ID"),r.createElement("input",{type:"text",id:"jiraAccountId",className:"form-control",value:V.jiraAccountId,onChange:e=>ae("jiraAccountId",e.target.value),placeholder:"Optional: Link to Jira account",disabled:O})),r.createElement("div",{className:"form-group"},r.createElement("label",null,r.createElement("input",{type:"checkbox",checked:!0===V.isAdmin,onChange:e=>B((a=>v(v({},a),{},{isAdmin:e.target.checked}))),disabled:O})," ","Admin User")),r.createElement("div",{className:"team-management-availability-section"},r.createElement("h4",null,"Working Schedule"),r.createElement("p",{className:"team-management-help-text"},"Set the default working hours for this team member."),r.createElement("div",{className:"team-management-availability-grid"},Y.map(((e,a)=>r.createElement("div",{key:e.dayOfWeek,className:"team-management-availability-day"},r.createElement("div",{className:"team-management-day-header"},r.createElement("label",{className:"team-management-checkbox-label"},r.createElement("input",{type:"checkbox",checked:e.isWorkingDay,onChange:e=>te(a,"isWorkingDay",e.target.checked),disabled:O}),r.createElement("span",{className:"team-management-day-name"},e.dayName))),e.isWorkingDay&&r.createElement("div",{className:"team-management-day-details"},r.createElement("div",{className:"team-management-time-inputs"},r.createElement("input",{type:"time",value:e.startTime,onChange:e=>te(a,"startTime",e.target.value),className:"form-control team-management-input-small",disabled:O}),r.createElement("span",null,"to"),r.createElement("input",{type:"time",value:e.endTime,onChange:e=>te(a,"endTime",e.target.value),className:"form-control team-management-input-small",disabled:O})),r.createElement("div",{className:"team-management-hours-display"},e.hoursPerDay.toFixed(1)," hours")))))),r.createElement("div",{className:"team-management-availability-summary"},r.createElement("strong",null,"Total weekly capacity: "),Y.reduce(((e,a)=>e+(a.isWorkingDay?a.hoursPerDay:0)),0).toFixed(1)," hours")),r.createElement("div",{className:"form-actions"},r.createElement("button",{type:"submit",className:"btn btn-primary",disabled:O},O?"Saving...":T?"Update User":"Create User"),r.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>{$(),_("list")},disabled:O},"Cancel"))),"import"===k&&r.createElement("div",{className:"team-management-import-section"},r.createElement("div",{className:"team-management-import-header"},r.createElement("div",{className:"team-management-import-title"},r.createElement("h4",null,"Import Users from Jira"),r.createElement("p",null,"Select Jira users to import into the PTO system. Users already in the system will not be shown.")),r.createElement("div",{className:"team-management-import-actions"},r.createElement("button",{onClick:()=>X(0),disabled:x,className:"btn btn-secondary"},r.createElement(m.A,{size:16,className:x?"team-management-spin":""}),"Refresh"),L.length>0&&r.createElement("button",{onClick:async()=>{if(0!==L.length){F(!0);try{const e=p.map((e=>e.jira_account_id||e.email_address)).filter(Boolean),a=L.filter((a=>!e.includes(a.accountId)&&!e.includes(a.emailAddress))),t=await(0,n.invoke)("bulkImportUsersFromJira",{selectedUserIds:a.map((e=>e.accountId)),defaultTeamId:null,defaultDepartment:""});if(!t.success)throw new Error(t.message||"Failed to import users");{const{importedCount:e,skippedCount:a}=t.data;b("Successfully imported ".concat(e," users. ").concat(a>0?"".concat(a," users were already in the system."):""),"success"),R([]),h&&h(),X(0)}}catch(e){b("Failed to import users: "+e.message,"error")}finally{F(!1)}}else b("Please select users to import","error")},disabled:z,className:"btn btn-primary"},r.createElement(c.A,{size:16}),"Import ",L.length," Selected",z&&" (Importing...)"))),x&&0===P.length?r.createElement("div",{className:"team-management-loading-state"},r.createElement("div",{className:"team-management-loading-spinner"}),r.createElement("p",null,"Loading Jira users...")):0===de.length?r.createElement("div",{className:"team-management-empty-state"},r.createElement("div",{className:"team-management-empty-icon"},"✅"),r.createElement("h4",null,"All Jira Users Imported"),r.createElement("p",null,"All available Jira users from your organization are already in the system.")):r.createElement(r.Fragment,null,r.createElement("div",{className:"team-management-import-stats"},r.createElement("div",{className:"team-management-import-stat"},r.createElement("span",{className:"team-management-import-stat-label"},"Total Jira Users:"),r.createElement("span",{className:"team-management-import-stat-value"},q.total)),r.createElement("div",{className:"team-management-import-stat"},r.createElement("span",{className:"team-management-import-stat-label"},"Available to Import:"),r.createElement("span",{className:"team-management-import-stat-value"},de.length)),r.createElement("div",{className:"team-management-import-stat"},r.createElement("span",{className:"team-management-import-stat-label"},"Selected:"),r.createElement("span",{className:"team-management-import-stat-value"},L.length))),r.createElement("div",{className:"team-management-jira-users-grid"},de.map((e=>{var a;const t=L.some((a=>a.accountId===e.accountId));return r.createElement("div",{key:e.accountId,className:"team-management-jira-user-card"},r.createElement("div",{className:"team-management-jira-user-header"},r.createElement("label",{className:"team-management-jira-user-checkbox"},r.createElement("input",{type:"checkbox",checked:t,onChange:a=>((e,a)=>{R((t=>a?[...t,e]:t.filter((a=>a.accountId!==e.accountId))))})(e,a.target.checked),disabled:z}),r.createElement("span",{className:"team-management-checkbox-custom"})),r.createElement("div",{className:"team-management-jira-user-avatar"},e.avatarUrl?r.createElement("img",{src:e.avatarUrl,alt:e.displayName}):r.createElement("div",{className:"team-management-avatar-placeholder"},(null===(a=e.displayName)||void 0===a?void 0:a.charAt(0))||"?"))),r.createElement("div",{className:"team-management-jira-user-info"},r.createElement("h5",{className:"team-management-jira-user-name"},e.displayName),r.createElement("div",{className:"team-management-jira-user-email"},e.emailAddress),r.createElement("div",{className:"team-management-jira-user-active"},e.active?"✅ Active":"❌ Inactive")),r.createElement("div",{className:"team-management-jira-user-actions"},r.createElement("button",{onClick:()=>(e=>{var a,t;B({firstName:(null===(a=e.displayName)||void 0===a?void 0:a.split(" ")[0])||"",lastName:(null===(t=e.displayName)||void 0===t?void 0:t.split(" ").slice(1).join(" "))||"",displayName:e.displayName||"",emailAddress:e.emailAddress||"",jiraAccountId:e.accountId||"",employmentType:"full-time",hireDate:"",teamMemberships:[],capacity:40}),A(null),_("form")})(e),className:"btn btn-sm btn-secondary",disabled:z},r.createElement(i.A,{size:14}),"Create User")))}))),!q.isLast&&r.createElement("div",{className:"team-management-pagination"},r.createElement("button",{onClick:()=>X(q.startAt+q.maxResults),disabled:x,className:"btn btn-secondary"},r.createElement(o.A,{size:16}),"Load More Users",x&&" (Loading...)"),r.createElement("div",{className:"team-management-pagination-info"},"Showing ",P.length," of ",q.total," Jira users"))))))))}},9618:(e,a,t)=>{t.d(a,{A:()=>i});var r=t(6540),n=t(8697),s=t(2321);function l(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function c(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?l(Object(t),!0).forEach((function(a){m(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function m(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const i=e=>{let{request:a,onClose:t,onSave:l,currentUser:m}=e;const[i,o]=(0,r.useState)({startDate:"",endDate:"",leaveType:"",reason:"",dailySchedules:[]}),[d,u]=(0,r.useState)("");(0,r.useEffect)((()=>{a&&o({startDate:a.start_date,endDate:a.end_date,leaveType:a.leave_type,reason:a.reason||"",dailySchedules:a.daily_schedules||[]})}),[a]);return r.createElement("div",{className:"modal-overlay"},r.createElement("div",{className:"modal-content"},r.createElement("div",{className:"modal-header"},r.createElement("h3",null,"Edit PTO Request"),r.createElement("button",{onClick:t,className:"modal-close"},r.createElement(n.A,{size:20}))),d&&r.createElement("div",{className:"alert alert-danger"},d),r.createElement("form",{onSubmit:async e=>{e.preventDefault(),u("");try{if("approved"===a.status){const e=new Date;e.setHours(0,0,0,0);if(new Date(a.start_date)<e)return void u("Cannot edit approved requests with past dates. Please contact an admin for assistance.")}const e=await(0,s.invoke)("editPTORequest",{requestId:a.id,editedBy:m.accountId,updatedData:{startDate:i.startDate,endDate:i.endDate,leaveType:i.leaveType,reason:i.reason,dailySchedules:i.dailySchedules}});e.success?(l(e.data),t()):u(e.message||"Failed to update PTO request")}catch(e){u("Failed to update PTO request: "+e.message)}}},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Start Date"),r.createElement("input",{type:"date",value:i.startDate,onChange:e=>o((a=>c(c({},a),{},{startDate:e.target.value}))),className:"form-control",required:!0})),r.createElement("div",{className:"form-group"},r.createElement("label",null,"End Date"),r.createElement("input",{type:"date",value:i.endDate,onChange:e=>o((a=>c(c({},a),{},{endDate:e.target.value}))),className:"form-control",required:!0})),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Leave Type"),r.createElement("select",{value:i.leaveType,onChange:e=>o((a=>c(c({},a),{},{leaveType:e.target.value}))),className:"form-control",required:!0},r.createElement("option",{value:"vacation"},"Vacation"),r.createElement("option",{value:"sick"},"Sick Leave"),r.createElement("option",{value:"personal"},"Personal Leave"),r.createElement("option",{value:"other"},"Other"))),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Reason"),r.createElement("textarea",{value:i.reason,onChange:e=>o((a=>c(c({},a),{},{reason:e.target.value}))),className:"form-control",rows:"3"})),r.createElement("div",{className:"modal-footer"},r.createElement("button",{type:"button",onClick:t,className:"btn btn-secondary"},"Cancel"),r.createElement("button",{type:"submit",className:"btn btn-primary"},"Save Changes")))))}}}]);